"""add_campus_schedule_overrides_to_tournament_configuration

Revision ID: 46d608f3ea4e
Revises: 41b554a1284c
Create Date: 2026-02-12 11:49:17.424841

"""
from alembic import op
import sqlalchemy as sa
from sqlalchemy.dialects import postgresql

# revision identifiers, used by Alembic.
revision = '46d608f3ea4e'
down_revision = '41b554a1284c'
branch_labels = None
depends_on = None


def upgrade() -> None:
    # ### commands auto generated by Alembic - please adjust! ###
    op.alter_column('attendance', 'xp_earned',
               existing_type=sa.INTEGER(),
               comment='XP earned for this attendance',
               existing_nullable=True)
    op.alter_column('coupon_usages', 'credits_awarded',
               existing_type=sa.INTEGER(),
               comment='Amount of credits awarded from this coupon',
               existing_nullable=False)
    op.alter_column('coupons', 'requires_purchase',
               existing_type=sa.BOOLEAN(),
               comment='True if coupon can only be used during credit purchase',
               existing_nullable=False)
    op.alter_column('coupons', 'requires_admin_approval',
               existing_type=sa.BOOLEAN(),
               comment='True if coupon requires admin approval after purchase',
               existing_nullable=False)
    op.alter_column('game_configurations', 'semester_id',
               existing_type=sa.INTEGER(),
               comment='Tournament this game configuration belongs to (1:1 relationship)',
               existing_nullable=False)
    op.alter_column('game_configurations', 'game_preset_id',
               existing_type=sa.INTEGER(),
               comment='Reference to pre-configured game type (e.g., GanFootvolley, Stole My Goal). Preset defines default skills, weights, and match rules.',
               existing_nullable=True)
    op.alter_column('game_configurations', 'game_config',
               existing_type=postgresql.JSONB(astext_type=sa.Text()),
               comment='Merged game configuration (preset + overrides). Final configuration used for tournament simulation. Includes match probabilities, ranking rules, skill weights, and simulation options.',
               existing_nullable=True)
    op.alter_column('game_configurations', 'game_config_overrides',
               existing_type=postgresql.JSONB(astext_type=sa.Text()),
               comment='Custom overrides applied to preset configuration. Tracks what was customized from the base preset. NULL if using preset defaults.',
               existing_nullable=True)
    op.alter_column('game_configurations', 'created_at',
               existing_type=postgresql.TIMESTAMP(),
               comment='When this game configuration was created',
               existing_nullable=False)
    op.alter_column('game_configurations', 'updated_at',
               existing_type=postgresql.TIMESTAMP(),
               comment='When this game configuration was last updated',
               existing_nullable=False)
    op.alter_column('game_presets', 'code',
               existing_type=sa.VARCHAR(length=50),
               comment="Unique code identifier (e.g., 'gan_footvolley', 'stole_my_goal')",
               existing_nullable=False)
    op.alter_column('game_presets', 'name',
               existing_type=sa.VARCHAR(length=100),
               comment="Display name (e.g., 'GanFootvolley', 'Stole My Goal')",
               existing_nullable=False)
    op.alter_column('game_presets', 'description',
               existing_type=sa.TEXT(),
               comment='Description of the game type and its characteristics',
               existing_nullable=True)
    op.alter_column('game_presets', 'game_config',
               existing_type=postgresql.JSONB(astext_type=sa.Text()),
               comment='Complete game configuration including: format_config (match simulation, ranking rules), skill_config (skills tested, weights), simulation_config (variation, distribution), metadata (category, player count, difficulty)',
               existing_nullable=False)
    op.alter_column('game_presets', 'is_active',
               existing_type=sa.BOOLEAN(),
               comment='Whether this preset is available for selection',
               existing_nullable=False)
    op.alter_column('game_presets', 'is_recommended',
               existing_type=sa.BOOLEAN(),
               comment='Whether this preset is recommended as default choice',
               existing_nullable=False)
    op.alter_column('game_presets', 'is_locked',
               existing_type=sa.BOOLEAN(),
               comment="Whether this preset's configuration is locked (cannot be overridden)",
               existing_nullable=False)
    op.alter_column('game_presets', 'created_at',
               existing_type=postgresql.TIMESTAMP(timezone=True),
               comment='When this preset was created',
               existing_nullable=False,
               existing_server_default=sa.text('now()'))
    op.alter_column('game_presets', 'updated_at',
               existing_type=postgresql.TIMESTAMP(timezone=True),
               comment='When this preset was last updated',
               existing_nullable=False,
               existing_server_default=sa.text('now()'))
    op.alter_column('game_presets', 'created_by',
               existing_type=sa.INTEGER(),
               comment='Admin user who created this preset',
               existing_nullable=True)
    op.alter_column('instructor_assignment_requests', 'semester_id',
               existing_type=sa.INTEGER(),
               comment='Semester needing an instructor',
               existing_nullable=False)
    op.alter_column('instructor_assignment_requests', 'instructor_id',
               existing_type=sa.INTEGER(),
               comment='Instructor receiving the request',
               existing_nullable=False)
    op.alter_column('instructor_assignment_requests', 'requested_by',
               existing_type=sa.INTEGER(),
               comment='Admin who sent the request',
               existing_nullable=True)
    op.alter_column('instructor_assignment_requests', 'location_id',
               existing_type=sa.INTEGER(),
               comment='Location for the assignment',
               existing_nullable=True)
    op.alter_column('instructor_assignment_requests', 'status',
               existing_type=postgresql.ENUM('PENDING', 'ACCEPTED', 'DECLINED', 'CANCELLED', 'EXPIRED', name='assignmentrequeststatus'),
               comment='PENDING, ACCEPTED, DECLINED, CANCELLED, EXPIRED',
               existing_nullable=False)
    op.alter_column('instructor_assignment_requests', 'responded_at',
               existing_type=postgresql.TIMESTAMP(timezone=True),
               comment='When instructor responded',
               existing_nullable=True)
    op.alter_column('instructor_assignment_requests', 'expires_at',
               existing_type=postgresql.TIMESTAMP(timezone=True),
               comment='Request expiration (optional)',
               existing_nullable=True)
    op.alter_column('instructor_assignment_requests', 'request_message',
               existing_type=sa.TEXT(),
               comment='Message from admin to instructor',
               existing_nullable=True)
    op.alter_column('instructor_assignment_requests', 'response_message',
               existing_type=sa.TEXT(),
               comment='Message from instructor (if declined, reason)',
               existing_nullable=True)
    op.alter_column('instructor_assignment_requests', 'priority',
               existing_type=sa.INTEGER(),
               comment='Higher number = higher priority (0-10)',
               existing_nullable=False)
    op.alter_column('instructor_assignments', 'location_id',
               existing_type=sa.INTEGER(),
               comment='Assignment location',
               existing_nullable=False)
    op.alter_column('instructor_assignments', 'instructor_id',
               existing_type=sa.INTEGER(),
               comment='Assigned instructor',
               existing_nullable=False)
    op.alter_column('instructor_assignments', 'specialization_type',
               existing_type=sa.VARCHAR(length=50),
               comment='LFA_PLAYER, INTERNSHIP, etc.',
               existing_nullable=False)
    op.alter_column('instructor_assignments', 'age_group',
               existing_type=sa.VARCHAR(length=20),
               comment='PRE, YOUTH, AMATEUR, PRO',
               existing_nullable=False)
    op.alter_column('instructor_assignments', 'year',
               existing_type=sa.INTEGER(),
               comment='Year (e.g., 2026)',
               existing_nullable=False)
    op.alter_column('instructor_assignments', 'time_period_start',
               existing_type=sa.VARCHAR(length=10),
               comment='Start period code (M01, Q1, etc.)',
               existing_nullable=False)
    op.alter_column('instructor_assignments', 'time_period_end',
               existing_type=sa.VARCHAR(length=10),
               comment='End period code (M06, Q2, etc.)',
               existing_nullable=False)
    op.alter_column('instructor_assignments', 'is_master',
               existing_type=sa.BOOLEAN(),
               comment='True if this is the master instructor',
               existing_nullable=False)
    op.alter_column('instructor_assignments', 'assigned_by',
               existing_type=sa.INTEGER(),
               comment='Master instructor who made assignment',
               existing_nullable=True)
    op.alter_column('instructor_assignments', 'is_active',
               existing_type=sa.BOOLEAN(),
               comment='Active assignment',
               existing_nullable=False)
    op.alter_column('instructor_assignments', 'deactivated_at',
               existing_type=postgresql.TIMESTAMP(timezone=True),
               comment='When assignment was deactivated',
               existing_nullable=True)
    op.alter_column('instructor_availability_windows', 'instructor_id',
               existing_type=sa.INTEGER(),
               comment='Instructor setting availability',
               existing_nullable=False)
    op.alter_column('instructor_availability_windows', 'year',
               existing_type=sa.INTEGER(),
               comment='Year (e.g., 2026)',
               existing_nullable=False)
    op.alter_column('instructor_availability_windows', 'time_period',
               existing_type=sa.VARCHAR(length=10),
               comment='Q1, Q2, Q3, Q4 or M01-M12',
               existing_nullable=False)
    op.alter_column('instructor_availability_windows', 'is_available',
               existing_type=sa.BOOLEAN(),
               comment='True if instructor is available for this window',
               existing_nullable=False)
    op.alter_column('instructor_availability_windows', 'notes',
               existing_type=sa.TEXT(),
               comment='Optional notes from instructor',
               existing_nullable=True)
    op.alter_column('instructor_positions', 'location_id',
               existing_type=sa.INTEGER(),
               comment='Location for position',
               existing_nullable=False)
    op.alter_column('instructor_positions', 'posted_by',
               existing_type=sa.INTEGER(),
               comment='Admin or master instructor who posted',
               existing_nullable=False)
    op.alter_column('instructor_positions', 'is_master_position',
               existing_type=sa.BOOLEAN(),
               comment='True if this is a master instructor opening, False for assistant positions',
               existing_nullable=False)
    op.alter_column('instructor_positions', 'specialization_type',
               existing_type=sa.VARCHAR(length=50),
               comment='LFA_PLAYER, INTERNSHIP, etc.',
               existing_nullable=False)
    op.alter_column('instructor_positions', 'age_group',
               existing_type=sa.VARCHAR(length=20),
               comment='PRE, YOUTH, AMATEUR, PRO',
               existing_nullable=False)
    op.alter_column('instructor_positions', 'year',
               existing_type=sa.INTEGER(),
               comment='Year (e.g., 2026)',
               existing_nullable=False)
    op.alter_column('instructor_positions', 'time_period_start',
               existing_type=sa.VARCHAR(length=10),
               comment='Start period code (M01, Q1, etc.)',
               existing_nullable=False)
    op.alter_column('instructor_positions', 'time_period_end',
               existing_type=sa.VARCHAR(length=10),
               comment='End period code (M06, Q2, etc.)',
               existing_nullable=False)
    op.alter_column('instructor_positions', 'description',
               existing_type=sa.TEXT(),
               comment='Job description and requirements',
               existing_nullable=False)
    op.alter_column('instructor_positions', 'priority',
               existing_type=sa.INTEGER(),
               comment='1=low, 5=medium, 10=high',
               existing_nullable=False)
    op.alter_column('instructor_positions', 'status',
               existing_type=postgresql.ENUM('OPEN', 'FILLED', 'CLOSED', 'CANCELLED', name='positionstatus'),
               comment='OPEN, FILLED, CLOSED, CANCELLED',
               existing_nullable=False)
    op.alter_column('instructor_positions', 'application_deadline',
               existing_type=postgresql.TIMESTAMP(timezone=True),
               comment='Application deadline',
               existing_nullable=False)
    op.alter_column('instructor_specialization_availability', 'instructor_id',
               existing_type=sa.INTEGER(),
               comment='Instructor who sets this availability preference',
               existing_nullable=False)
    op.alter_column('instructor_specialization_availability', 'specialization_type',
               existing_type=sa.VARCHAR(length=50),
               comment='LFA_PLAYER_PRE, LFA_PLAYER_YOUTH, LFA_PLAYER_AMATEUR, LFA_PLAYER_PRO',
               existing_nullable=False)
    op.alter_column('instructor_specialization_availability', 'time_period_code',
               existing_type=sa.VARCHAR(length=10),
               comment='Q1-Q4 for quarterly, M01-M12 for monthly',
               existing_nullable=False)
    op.alter_column('instructor_specialization_availability', 'year',
               existing_type=sa.INTEGER(),
               comment='Year for which this availability applies (e.g., 2025)',
               existing_nullable=False)
    op.alter_column('instructor_specialization_availability', 'location_city',
               existing_type=sa.VARCHAR(length=100),
               comment='City where this availability applies (e.g., Budapest, Buda√∂rs)',
               existing_nullable=True)
    op.alter_column('instructor_specialization_availability', 'is_available',
               existing_type=sa.BOOLEAN(),
               comment='True if instructor is available for this specialization in this time period',
               existing_nullable=False)
    op.alter_column('instructor_specialization_availability', 'notes',
               existing_type=sa.VARCHAR(length=500),
               comment='Optional notes from instructor about this availability',
               existing_nullable=True)
    op.alter_column('invitation_codes', 'code',
               existing_type=sa.VARCHAR(length=50),
               comment='Unique invitation code',
               existing_nullable=False)
    op.alter_column('invitation_codes', 'invited_name',
               existing_type=sa.VARCHAR(length=200),
               comment='Name of the person/organization receiving the code',
               existing_nullable=False)
    op.alter_column('invitation_codes', 'invited_email',
               existing_type=sa.VARCHAR(length=200),
               comment='Optional: Email restriction - only this email can use the code',
               existing_nullable=True)
    op.alter_column('invitation_codes', 'bonus_credits',
               existing_type=sa.INTEGER(),
               comment='Bonus credits to grant when code is used',
               existing_nullable=False)
    op.alter_column('invitation_codes', 'is_used',
               existing_type=sa.BOOLEAN(),
               comment='Whether the code has been used',
               existing_nullable=False)
    op.alter_column('invitation_codes', 'used_by_user_id',
               existing_type=sa.INTEGER(),
               comment='User who redeemed this code',
               existing_nullable=True)
    op.alter_column('invitation_codes', 'used_at',
               existing_type=postgresql.TIMESTAMP(timezone=True),
               comment='When the code was redeemed',
               existing_nullable=True)
    op.alter_column('invitation_codes', 'created_by_admin_id',
               existing_type=sa.INTEGER(),
               comment='Admin who created this code',
               existing_nullable=True)
    op.alter_column('invitation_codes', 'expires_at',
               existing_type=postgresql.TIMESTAMP(timezone=True),
               comment='Optional expiration date',
               existing_nullable=True)
    op.alter_column('invitation_codes', 'notes',
               existing_type=sa.TEXT(),
               comment='Admin notes about this invitation code',
               existing_nullable=True)
    op.alter_column('invoice_requests', 'payment_reference',
               existing_type=sa.VARCHAR(length=50),
               comment='Unique payment reference: LFA-YYYYMMDD-HHMMSS-ID-HASH (max 30 chars, SWIFT compatible)',
               existing_nullable=False)
    op.alter_column('invoice_requests', 'amount_eur',
               existing_type=sa.DOUBLE_PRECISION(precision=53),
               comment='Amount in EUR',
               existing_nullable=False)
    op.alter_column('invoice_requests', 'credit_amount',
               existing_type=sa.INTEGER(),
               comment='Credit amount',
               existing_nullable=False)
    op.alter_column('invoice_requests', 'specialization',
               existing_type=sa.VARCHAR(length=50),
               comment='Specialization type',
               existing_nullable=True)
    op.alter_column('invoice_requests', 'coupon_code',
               existing_type=sa.VARCHAR(length=50),
               comment='Applied coupon code (if any)',
               existing_nullable=True)
    op.alter_column('invoice_requests', 'paid_at',
               existing_type=postgresql.TIMESTAMP(timezone=True),
               comment='When payment was made',
               existing_nullable=True)
    op.alter_column('invoice_requests', 'verified_at',
               existing_type=postgresql.TIMESTAMP(timezone=True),
               comment='When admin verified payment',
               existing_nullable=True)
    op.alter_column('location_master_instructors', 'location_id',
               existing_type=sa.INTEGER(),
               comment='Location for master instructor',
               existing_nullable=False)
    op.alter_column('location_master_instructors', 'instructor_id',
               existing_type=sa.INTEGER(),
               comment='Master instructor user',
               existing_nullable=False)
    op.alter_column('location_master_instructors', 'contract_start',
               existing_type=postgresql.TIMESTAMP(timezone=True),
               comment='Contract start date',
               existing_nullable=False)
    op.alter_column('location_master_instructors', 'contract_end',
               existing_type=postgresql.TIMESTAMP(timezone=True),
               comment='Contract end date',
               existing_nullable=False)
    op.alter_column('location_master_instructors', 'is_active',
               existing_type=sa.BOOLEAN(),
               comment='Only one active master per location',
               existing_nullable=False)
    op.alter_column('location_master_instructors', 'offer_status',
               existing_type=postgresql.ENUM('OFFERED', 'ACCEPTED', 'DECLINED', 'EXPIRED', name='masterofferstatus'),
               comment='Offer workflow status: NULL=legacy, OFFERED=pending, ACCEPTED=active, DECLINED/EXPIRED=rejected',
               existing_nullable=True)
    op.alter_column('location_master_instructors', 'offered_at',
               existing_type=postgresql.TIMESTAMP(timezone=True),
               comment='When offer was sent to instructor',
               existing_nullable=True)
    op.alter_column('location_master_instructors', 'offer_deadline',
               existing_type=postgresql.TIMESTAMP(timezone=True),
               comment='Deadline for instructor to accept/decline offer',
               existing_nullable=True)
    op.alter_column('location_master_instructors', 'accepted_at',
               existing_type=postgresql.TIMESTAMP(timezone=True),
               comment='When instructor accepted the offer',
               existing_nullable=True)
    op.alter_column('location_master_instructors', 'declined_at',
               existing_type=postgresql.TIMESTAMP(timezone=True),
               comment='When instructor declined or offer expired',
               existing_nullable=True)
    op.alter_column('location_master_instructors', 'hiring_pathway',
               existing_type=sa.VARCHAR(length=20),
               comment='Hiring method: DIRECT or JOB_POSTING',
               existing_nullable=False)
    op.alter_column('location_master_instructors', 'source_position_id',
               existing_type=sa.INTEGER(),
               comment='Links to job posting if hired via JOB_POSTING pathway',
               existing_nullable=True)
    op.alter_column('location_master_instructors', 'availability_override',
               existing_type=sa.BOOLEAN(),
               comment='True if admin sent offer despite availability mismatch',
               existing_nullable=False)
    op.alter_column('location_master_instructors', 'terminated_at',
               existing_type=postgresql.TIMESTAMP(timezone=True),
               comment='When contract was terminated',
               existing_nullable=True)
    op.alter_column('locations', 'location_type',
               existing_type=postgresql.ENUM('PARTNER', 'CENTER', name='locationtype'),
               comment='Location capability: PARTNER (Tournament+Mini only) or CENTER (all types)',
               existing_nullable=False)
    op.alter_column('position_applications', 'position_id',
               existing_type=sa.INTEGER(),
               comment='Position being applied to',
               existing_nullable=False)
    op.alter_column('position_applications', 'applicant_id',
               existing_type=sa.INTEGER(),
               comment='Instructor applying',
               existing_nullable=False)
    op.alter_column('position_applications', 'application_message',
               existing_type=sa.TEXT(),
               comment='Cover letter / application message',
               existing_nullable=False)
    op.alter_column('position_applications', 'status',
               existing_type=postgresql.ENUM('PENDING', 'ACCEPTED', 'DECLINED', name='applicationstatus'),
               comment='PENDING, ACCEPTED, DECLINED',
               existing_nullable=False)
    op.alter_column('position_applications', 'reviewed_at',
               existing_type=postgresql.TIMESTAMP(timezone=True),
               comment='When master reviewed application',
               existing_nullable=True)
    op.alter_column('projects', 'target_specialization',
               existing_type=postgresql.ENUM('GANCUJU_PLAYER', 'LFA_FOOTBALL_PLAYER', 'LFA_COACH', 'INTERNSHIP', 'LFA_PLAYER_PRE', 'LFA_PLAYER_YOUTH', 'LFA_PLAYER_AMATEUR', 'LFA_PLAYER_PRO', 'LFA_PLAYER_PRE_ACADEMY', 'LFA_PLAYER_YOUTH_ACADEMY', 'LFA_PLAYER_AMATEUR_ACADEMY', 'LFA_PLAYER_PRO_ACADEMY', name='specializationtype'),
               comment='Target specialization for this project (null = all specializations)',
               existing_nullable=True)
    op.alter_column('projects', 'mixed_specialization',
               existing_type=sa.BOOLEAN(),
               comment='Whether this project encourages collaboration between Player and Coach specializations',
               existing_nullable=True)
    op.alter_column('semester_enrollments', 'user_id',
               existing_type=sa.INTEGER(),
               comment='Student who is enrolled',
               existing_nullable=False)
    op.alter_column('semester_enrollments', 'semester_id',
               existing_type=sa.INTEGER(),
               comment='Semester for this enrollment',
               existing_nullable=False)
    op.alter_column('semester_enrollments', 'user_license_id',
               existing_type=sa.INTEGER(),
               comment='Link to UserLicense (tracks progress/levels)',
               existing_nullable=False)
    op.alter_column('semester_enrollments', 'request_status',
               existing_type=postgresql.ENUM('PENDING', 'APPROVED', 'REJECTED', 'WITHDRAWN', name='enrollmentstatus'),
               comment='Enrollment request status: PENDING/APPROVED/REJECTED/WITHDRAWN',
               existing_nullable=False)
    op.alter_column('semester_enrollments', 'requested_at',
               existing_type=postgresql.TIMESTAMP(timezone=True),
               comment='When student requested enrollment',
               existing_nullable=False)
    op.alter_column('semester_enrollments', 'approved_at',
               existing_type=postgresql.TIMESTAMP(timezone=True),
               comment='When admin approved/rejected the request',
               existing_nullable=True)
    op.alter_column('semester_enrollments', 'approved_by',
               existing_type=sa.INTEGER(),
               comment='Admin who approved/rejected',
               existing_nullable=True)
    op.alter_column('semester_enrollments', 'rejection_reason',
               existing_type=sa.VARCHAR(),
               comment='Reason for rejection (if rejected)',
               existing_nullable=True)
    op.alter_column('semester_enrollments', 'payment_reference_code',
               existing_type=sa.VARCHAR(length=50),
               comment='Unique payment reference code for bank transfer (e.g., LFA-INT-2024S1-042-A7B9)',
               existing_nullable=True)
    op.alter_column('semester_enrollments', 'payment_verified',
               existing_type=sa.BOOLEAN(),
               comment='Whether student paid for THIS specialization in THIS semester',
               existing_nullable=False)
    op.alter_column('semester_enrollments', 'payment_verified_at',
               existing_type=postgresql.TIMESTAMP(timezone=True),
               comment='When payment was verified',
               existing_nullable=True)
    op.alter_column('semester_enrollments', 'payment_verified_by',
               existing_type=sa.INTEGER(),
               comment='Admin user who verified payment',
               existing_nullable=True)
    op.alter_column('semester_enrollments', 'is_active',
               existing_type=sa.BOOLEAN(),
               comment='Whether this enrollment is currently active (auto-set when approved)',
               existing_nullable=False)
    op.alter_column('semester_enrollments', 'enrolled_at',
               existing_type=postgresql.TIMESTAMP(timezone=True),
               comment='When student enrolled in this spec for this semester',
               existing_nullable=False)
    op.alter_column('semester_enrollments', 'deactivated_at',
               existing_type=postgresql.TIMESTAMP(timezone=True),
               comment='When enrollment was deactivated (if applicable)',
               existing_nullable=True)
    op.alter_column('semester_enrollments', 'age_category',
               existing_type=sa.VARCHAR(length=20),
               comment='Age category at enrollment (PRE/YOUTH/AMATEUR/PRO)',
               existing_nullable=True)
    op.alter_column('semester_enrollments', 'age_category_overridden',
               existing_type=sa.BOOLEAN(),
               comment='True if instructor manually changed category',
               existing_nullable=False)
    op.alter_column('semester_enrollments', 'age_category_overridden_at',
               existing_type=postgresql.TIMESTAMP(timezone=True),
               comment='When age category was overridden by instructor',
               existing_nullable=True)
    op.alter_column('semester_enrollments', 'age_category_overridden_by',
               existing_type=sa.INTEGER(),
               comment='Instructor who overrode the age category',
               existing_nullable=True)
    op.alter_column('semesters', 'status',
               existing_type=postgresql.ENUM('DRAFT', 'SEEKING_INSTRUCTOR', 'INSTRUCTOR_ASSIGNED', 'READY_FOR_ENROLLMENT', 'ONGOING', 'COMPLETED', 'CANCELLED', name='semester_status'),
               comment='Current lifecycle phase of the semester',
               existing_nullable=False)
    op.alter_column('semesters', 'tournament_status',
               existing_type=sa.VARCHAR(length=50),
               comment='Tournament-specific status: DRAFT, SEEKING_INSTRUCTOR, READY_FOR_ENROLLMENT, etc.',
               existing_nullable=True)
    op.alter_column('semesters', 'winner_count',
               existing_type=sa.INTEGER(),
               comment='Number of winners for INDIVIDUAL_RANKING tournaments (E2E testing)',
               existing_nullable=True)
    op.alter_column('semesters', 'is_active',
               existing_type=sa.BOOLEAN(),
               comment='DEPRECATED: Use status field instead. Kept for backward compatibility.',
               existing_nullable=True)
    op.alter_column('semesters', 'enrollment_cost',
               existing_type=sa.INTEGER(),
               comment='Credit cost to enroll in this semester (admin adjustable)',
               existing_nullable=False)
    op.alter_column('semesters', 'master_instructor_id',
               existing_type=sa.INTEGER(),
               comment='Master instructor who approves enrollment requests for this semester',
               existing_nullable=True)
    op.alter_column('semesters', 'specialization_type',
               existing_type=sa.VARCHAR(length=50),
               comment='Specialization type (SEASON types: LFA_PLAYER_PRE/YOUTH/AMATEUR/PRO, GANCUJU_PLAYER, LFA_COACH, INTERNSHIP, OR user license for tournaments: LFA_FOOTBALL_PLAYER)',
               existing_nullable=True)
    op.alter_column('semesters', 'age_group',
               existing_type=sa.VARCHAR(length=20),
               comment='Age group (PRE, YOUTH, AMATEUR, PRO)',
               existing_nullable=True)
    op.alter_column('semesters', 'theme',
               existing_type=sa.VARCHAR(length=200),
               comment="Marketing theme (e.g., 'New Year Challenge', 'Q1', 'Fall')",
               existing_nullable=True)
    op.alter_column('semesters', 'focus_description',
               existing_type=sa.VARCHAR(length=500),
               comment="Focus description (e.g., '√öj√©vi fogadalmak, friss kezd√©s')",
               existing_nullable=True)
    op.alter_column('semesters', 'campus_id',
               existing_type=sa.INTEGER(),
               comment='FK to campuses table (most specific location - preferred)',
               existing_nullable=True)
    op.alter_column('semesters', 'location_id',
               existing_type=sa.INTEGER(),
               comment='FK to locations table (less specific than campus_id, preferred over legacy location_city/venue/address)',
               existing_nullable=True)
    op.alter_column('session_group_assignments', 'session_id',
               existing_type=sa.INTEGER(),
               comment='Session these groups belong to',
               existing_nullable=False)
    op.alter_column('session_group_assignments', 'group_number',
               existing_type=sa.INTEGER(),
               comment='Group number within session (1, 2, 3, 4...)',
               existing_nullable=False)
    op.alter_column('session_group_assignments', 'instructor_id',
               existing_type=sa.INTEGER(),
               comment='Instructor leading this group',
               existing_nullable=False)
    op.alter_column('session_group_assignments', 'created_by',
               existing_type=sa.INTEGER(),
               comment='Head coach who created this assignment',
               existing_nullable=True)
    op.alter_column('session_group_students', 'session_group_id',
               existing_type=sa.INTEGER(),
               comment='Which group this student is in',
               existing_nullable=False)
    op.alter_column('session_group_students', 'student_id',
               existing_type=sa.INTEGER(),
               comment='Student assigned to this group',
               existing_nullable=False)
    op.alter_column('sessions', 'target_specialization',
               existing_type=postgresql.ENUM('GANCUJU_PLAYER', 'LFA_FOOTBALL_PLAYER', 'LFA_COACH', 'INTERNSHIP', 'LFA_PLAYER_PRE', 'LFA_PLAYER_YOUTH', 'LFA_PLAYER_AMATEUR', 'LFA_PLAYER_PRO', 'LFA_PLAYER_PRE_ACADEMY', 'LFA_PLAYER_YOUTH_ACADEMY', 'LFA_PLAYER_AMATEUR_ACADEMY', 'LFA_PLAYER_PRO_ACADEMY', name='specializationtype'),
               comment='Target specialization for this session (null = all specializations)',
               existing_nullable=True)
    op.alter_column('sessions', 'mixed_specialization',
               existing_type=sa.BOOLEAN(),
               comment='Whether this session is open to all specializations',
               existing_nullable=True)
    op.alter_column('sessions', 'actual_start_time',
               existing_type=postgresql.TIMESTAMP(),
               comment='Actual start time when instructor starts the session',
               existing_nullable=True)
    op.alter_column('sessions', 'actual_end_time',
               existing_type=postgresql.TIMESTAMP(),
               comment='Actual end time when instructor stops the session',
               existing_nullable=True)
    op.alter_column('sessions', 'session_status',
               existing_type=sa.VARCHAR(length=20),
               comment='Session status: scheduled, in_progress, completed',
               existing_nullable=True)
    op.alter_column('sessions', 'quiz_unlocked',
               existing_type=sa.BOOLEAN(),
               comment='Whether the quiz is unlocked for students (HYBRID sessions)',
               existing_nullable=True)
    op.alter_column('sessions', 'base_xp',
               existing_type=sa.INTEGER(),
               comment='Base XP awarded for completing this session (HYBRID=100, ON-SITE=75, VIRTUAL=50)',
               existing_nullable=True)
    op.alter_column('sessions', 'credit_cost',
               existing_type=sa.INTEGER(),
               comment='Number of credits required to book this session (default: 1, workshops may cost more)',
               existing_nullable=False)
    op.alter_column('sessions', 'is_tournament_game',
               existing_type=sa.BOOLEAN(),
               comment='True if this session is a tournament game',
               existing_nullable=True)
    op.alter_column('sessions', 'game_type',
               existing_type=sa.VARCHAR(length=100),
               comment="Type/name of tournament game (user-defined, e.g., 'Skills Challenge')",
               existing_nullable=True)
    op.alter_column('sessions', 'game_results',
               existing_type=sa.TEXT(),
               comment='JSON array of game results: [{user_id: 1, score: 95, rank: 1}, ...]',
               existing_nullable=True)
    op.alter_column('sessions', 'auto_generated',
               existing_type=sa.BOOLEAN(),
               comment='True if this session was auto-generated from tournament type config',
               existing_nullable=False)
    op.alter_column('sessions', 'tournament_phase',
               existing_type=postgresql.ENUM('GROUP_STAGE', 'KNOCKOUT', 'FINALS', 'PLACEMENT', 'INDIVIDUAL_RANKING', 'SWISS', name='tournament_phase_enum'),
               comment='Tournament phase: canonical TournamentPhase enum values (GROUP_STAGE, KNOCKOUT, etc.)',
               existing_nullable=True)
    op.alter_column('sessions', 'tournament_round',
               existing_type=sa.INTEGER(),
               comment='Round number within the tournament (1, 2, 3, ...)',
               existing_nullable=True)
    op.alter_column('sessions', 'tournament_match_number',
               existing_type=sa.INTEGER(),
               comment='Match number within the round (1, 2, 3, ...)',
               existing_nullable=True)
    op.alter_column('sessions', 'ranking_mode',
               existing_type=sa.VARCHAR(length=50),
               comment='Ranking mode: ALL_PARTICIPANTS, GROUP_ISOLATED, TIERED, QUALIFIED_ONLY, PERFORMANCE_POD',
               existing_nullable=True)
    op.alter_column('sessions', 'group_identifier',
               existing_type=sa.VARCHAR(length=10),
               comment='Group identifier for group stage sessions (A, B, C, D)',
               existing_nullable=True)
    op.alter_column('sessions', 'round_number',
               existing_type=sa.INTEGER(),
               comment='Round number within the group/phase (1, 2, 3, ...)',
               existing_nullable=True)
    op.alter_column('sessions', 'expected_participants',
               existing_type=sa.INTEGER(),
               comment='Expected number of participants for this session (used for validation)',
               existing_nullable=True)
    op.alter_column('sessions', 'participant_filter',
               existing_type=sa.VARCHAR(length=50),
               comment='Participant filter logic: group_membership, top_group_qualifiers, dynamic_swiss_pairing',
               existing_nullable=True)
    op.alter_column('sessions', 'pod_tier',
               existing_type=sa.INTEGER(),
               comment='Performance tier for Swiss System pods (1=top performers, 2=middle, etc.)',
               existing_nullable=True)
    op.alter_column('sessions', 'match_format',
               existing_type=sa.VARCHAR(length=50),
               comment='Match format: INDIVIDUAL_RANKING, HEAD_TO_HEAD, TEAM_MATCH, TIME_BASED, SKILL_RATING',
               existing_nullable=True)
    op.alter_column('sessions', 'scoring_type',
               existing_type=sa.VARCHAR(length=50),
               comment='Scoring type: PLACEMENT, WIN_LOSS, SCORE_BASED, TIME_BASED, SKILL_RATING',
               existing_nullable=True)
    op.alter_column('sessions', 'structure_config',
               existing_type=postgresql.JSONB(astext_type=sa.Text()),
               comment='Match structure configuration (pairings, teams, performance criteria, etc.)',
               existing_nullable=True)
    op.alter_column('sessions', 'rounds_data',
               existing_type=postgresql.JSONB(astext_type=sa.Text()),
               comment="Round-by-round results for INDIVIDUAL_RANKING tournaments. Structure: {'total_rounds': 3, 'completed_rounds': 1, 'round_results': {'1': {'user_123': '12.5s', 'user_456': '13.2s'}}}",
               existing_nullable=False,
               existing_server_default=sa.text("'{}'::jsonb"))
    op.alter_column('sessions', 'participant_user_ids',
               existing_type=postgresql.ARRAY(sa.INTEGER()),
               comment='Explicit list of user_ids participating in THIS MATCH (not tournament-wide). This fixes the architectural issue where participants were determined at runtime.',
               existing_nullable=True)
    op.alter_column('specializations', 'id',
               existing_type=sa.VARCHAR(length=50),
               comment='Matches SpecializationType enum values',
               existing_nullable=False)
    op.alter_column('specializations', 'is_active',
               existing_type=sa.BOOLEAN(),
               comment='Controls availability without code changes',
               existing_nullable=False)
    op.alter_column('specializations', 'created_at',
               existing_type=postgresql.TIMESTAMP(),
               comment='Audit trail for when specialization was created',
               existing_nullable=False)
    op.add_column('tournament_configurations', sa.Column('campus_schedule_overrides', postgresql.JSONB(astext_type=sa.Text()), nullable=True, comment='Per-campus schedule overrides for multi-venue tournaments. Schema: {campus_id: {match_duration_minutes: int, break_duration_minutes: int, parallel_fields: int}}. Each campus can independently configure its own schedule parameters.'))
    op.alter_column('tournament_configurations', 'semester_id',
               existing_type=sa.INTEGER(),
               comment='Tournament this configuration belongs to (1:1 relationship)',
               existing_nullable=False)
    op.alter_column('tournament_configurations', 'tournament_type_id',
               existing_type=sa.INTEGER(),
               comment='FK to tournament_types table (defines format: HEAD_TO_HEAD or INDIVIDUAL_RANKING)',
               existing_nullable=True)
    op.alter_column('tournament_configurations', 'participant_type',
               existing_type=sa.VARCHAR(length=50),
               comment='Participant type: INDIVIDUAL, TEAM, MIXED',
               existing_nullable=False)
    op.alter_column('tournament_configurations', 'is_multi_day',
               existing_type=sa.BOOLEAN(),
               comment='True if tournament spans multiple days',
               existing_nullable=False)
    op.alter_column('tournament_configurations', 'max_players',
               existing_type=sa.INTEGER(),
               comment='Maximum tournament participants (explicit capacity, independent of session capacity sum)',
               existing_nullable=True)
    op.alter_column('tournament_configurations', 'match_duration_minutes',
               existing_type=sa.INTEGER(),
               comment='Duration of each match in minutes (overrides tournament_type default)',
               existing_nullable=True)
    op.alter_column('tournament_configurations', 'break_duration_minutes',
               existing_type=sa.INTEGER(),
               comment='Break time between matches in minutes (overrides tournament_type default)',
               existing_nullable=True)
    op.alter_column('tournament_configurations', 'parallel_fields',
               existing_type=sa.INTEGER(),
               comment='Number of parallel fields/pitches available (1-4) for simultaneous matches',
               existing_nullable=False)
    op.alter_column('tournament_configurations', 'scoring_type',
               existing_type=sa.VARCHAR(length=50),
               comment='Scoring type for INDIVIDUAL_RANKING: TIME_BASED, DISTANCE_BASED, SCORE_BASED, PLACEMENT. Ignored for HEAD_TO_HEAD.',
               existing_nullable=False)
    op.alter_column('tournament_configurations', 'measurement_unit',
               existing_type=sa.VARCHAR(length=50),
               comment='Unit of measurement for INDIVIDUAL_RANKING results: seconds/minutes (TIME_BASED), meters/centimeters (DISTANCE_BASED), points/repetitions (SCORE_BASED). NULL for PLACEMENT or HEAD_TO_HEAD.',
               existing_nullable=True)
    op.alter_column('tournament_configurations', 'ranking_direction',
               existing_type=sa.VARCHAR(length=10),
               comment='Ranking direction for INDIVIDUAL_RANKING: ASC (lowest wins, e.g. 100m sprint), DESC (highest wins, e.g. plank). HEAD_TO_HEAD always DESC. NULL for PLACEMENT.',
               existing_nullable=True)
    op.alter_column('tournament_configurations', 'number_of_rounds',
               existing_type=sa.INTEGER(),
               comment='Number of rounds for INDIVIDUAL_RANKING tournaments (1-10). Each round is a separate session. HEAD_TO_HEAD ignores this.',
               existing_nullable=False)
    op.alter_column('tournament_configurations', 'assignment_type',
               existing_type=sa.VARCHAR(length=30),
               comment='Tournament instructor assignment strategy: OPEN_ASSIGNMENT (admin assigns directly) or APPLICATION_BASED (instructors apply)',
               existing_nullable=True)
    op.alter_column('tournament_configurations', 'sessions_generated',
               existing_type=sa.BOOLEAN(),
               comment='True if tournament sessions have been auto-generated (prevents duplicate generation)',
               existing_nullable=False)
    op.alter_column('tournament_configurations', 'sessions_generated_at',
               existing_type=postgresql.TIMESTAMP(),
               comment='Timestamp when sessions were auto-generated',
               existing_nullable=True)
    op.alter_column('tournament_configurations', 'enrollment_snapshot',
               existing_type=postgresql.JSONB(astext_type=sa.Text()),
               comment='üì∏ Snapshot of enrollment state before session generation (for regeneration if needed)',
               existing_nullable=True)
    op.alter_column('tournament_configurations', 'created_at',
               existing_type=postgresql.TIMESTAMP(),
               comment='When this configuration was created',
               existing_nullable=False)
    op.alter_column('tournament_configurations', 'updated_at',
               existing_type=postgresql.TIMESTAMP(),
               comment='When this configuration was last updated',
               existing_nullable=False)
    op.alter_column('tournament_reward_configs', 'semester_id',
               existing_type=sa.INTEGER(),
               comment='Tournament this reward config belongs to (1:1 relationship)',
               existing_nullable=False)
    op.alter_column('tournament_reward_configs', 'reward_policy_name',
               existing_type=sa.VARCHAR(length=100),
               comment='Name of the reward policy (Standard, Championship, Friendly, Custom)',
               existing_nullable=False)
    op.alter_column('tournament_reward_configs', 'reward_policy_snapshot',
               existing_type=postgresql.JSONB(astext_type=sa.Text()),
               comment='Immutable snapshot of the reward policy at tournament creation time',
               existing_nullable=True)
    op.alter_column('tournament_reward_configs', 'reward_config',
               existing_type=postgresql.JSONB(astext_type=sa.Text()),
               comment='Detailed reward configuration:\n        - skill_mappings: List of skills with weights, categories, enabled flags\n        - first_place, second_place, third_place: Placement-based rewards (badges, credits, XP)\n        - top_25_percent: Dynamic rewards for top performers\n        - participation: Participation rewards (badges, credits, XP)\n        - template_name: Template name if using preset\n        - custom_config: Whether this is a custom configuration\n        ',
               existing_nullable=True)
    op.alter_column('tournament_reward_configs', 'created_at',
               existing_type=postgresql.TIMESTAMP(),
               comment='When this reward config was created',
               existing_nullable=False)
    op.alter_column('tournament_reward_configs', 'updated_at',
               existing_type=postgresql.TIMESTAMP(),
               comment='When this reward config was last updated',
               existing_nullable=False)
    op.alter_column('tournament_types', 'format',
               existing_type=sa.VARCHAR(length=50),
               comment='Match format: INDIVIDUAL_RANKING (multi-player ranking) or HEAD_TO_HEAD (1v1 or team vs team score-based)',
               existing_nullable=False,
               existing_server_default=sa.text("'INDIVIDUAL_RANKING'::character varying"))
    op.alter_column('user_licenses', 'payment_reference_code',
               existing_type=sa.VARCHAR(length=50),
               comment='Unique payment reference for bank transfer (e.g., INT-2025-002-X7K9)',
               existing_nullable=True)
    op.alter_column('user_licenses', 'payment_verified',
               existing_type=sa.BOOLEAN(),
               comment='Whether admin verified payment received for this license',
               existing_nullable=False)
    op.alter_column('user_licenses', 'payment_verified_at',
               existing_type=postgresql.TIMESTAMP(),
               comment='When admin verified the payment',
               existing_nullable=True)
    op.alter_column('user_licenses', 'onboarding_completed',
               existing_type=sa.BOOLEAN(),
               comment='Whether student completed basic onboarding for this specialization',
               existing_nullable=False)
    op.alter_column('user_licenses', 'onboarding_completed_at',
               existing_type=postgresql.TIMESTAMP(),
               comment='When student completed onboarding',
               existing_nullable=True)
    op.alter_column('user_licenses', 'is_active',
               existing_type=sa.BOOLEAN(),
               comment='Whether this license is currently active (can be used for teaching/enrollment)',
               existing_nullable=False)
    op.alter_column('user_licenses', 'issued_at',
               existing_type=postgresql.TIMESTAMP(),
               comment='Official license issuance date (e.g., 2014-01-01 for Grand Master)',
               existing_nullable=True)
    op.alter_column('user_licenses', 'expires_at',
               existing_type=postgresql.TIMESTAMP(),
               comment='License expiration date (null = no expiration yet, perpetual until first renewal)',
               existing_nullable=True)
    op.alter_column('user_licenses', 'last_renewed_at',
               existing_type=postgresql.TIMESTAMP(),
               comment='When license was last renewed',
               existing_nullable=True)
    op.alter_column('user_licenses', 'renewal_cost',
               existing_type=sa.INTEGER(),
               comment='Credit cost to renew this license (default: 1000 credits)',
               existing_nullable=False)
    op.alter_column('user_licenses', 'motivation_scores',
               existing_type=postgresql.JSON(astext_type=sa.Text()),
               comment='Motivation assessment scores (1-5 scale) - filled by admin/instructor',
               existing_nullable=True)
    op.alter_column('user_licenses', 'average_motivation_score',
               existing_type=sa.DOUBLE_PRECISION(precision=53),
               comment='Calculated average motivation score (1.0-5.0)',
               existing_nullable=True)
    op.alter_column('user_licenses', 'motivation_last_assessed_at',
               existing_type=postgresql.TIMESTAMP(),
               comment='When motivation was last assessed',
               existing_nullable=True)
    op.alter_column('user_licenses', 'motivation_assessed_by',
               existing_type=sa.INTEGER(),
               comment='Admin/instructor who assessed motivation',
               existing_nullable=True)
    op.alter_column('user_licenses', 'football_skills',
               existing_type=postgresql.JSON(astext_type=sa.Text()),
               comment='6 football skill percentages for LFA Player specializations (heading, shooting, crossing, passing, dribbling, ball_control)',
               existing_nullable=True)
    op.alter_column('user_licenses', 'skills_last_updated_at',
               existing_type=postgresql.TIMESTAMP(),
               comment='When skills were last updated',
               existing_nullable=True)
    op.alter_column('user_licenses', 'skills_updated_by',
               existing_type=sa.INTEGER(),
               comment='Instructor who last updated skills',
               existing_nullable=True)
    op.alter_column('user_licenses', 'credit_balance',
               existing_type=sa.INTEGER(),
               comment='Current credit balance available for enrollments',
               existing_nullable=False)
    op.alter_column('user_licenses', 'credit_purchased',
               existing_type=sa.INTEGER(),
               comment='Total credits purchased (lifetime)',
               existing_nullable=False)
    op.alter_column('user_licenses', 'credit_expires_at',
               existing_type=postgresql.TIMESTAMP(),
               comment='Credit expiration date (2 years from purchase)',
               existing_nullable=True)
    op.alter_column('users', 'first_name',
               existing_type=sa.VARCHAR(),
               comment='User first name (given name)',
               existing_nullable=True)
    op.alter_column('users', 'last_name',
               existing_type=sa.VARCHAR(),
               comment='User last name (family name)',
               existing_nullable=True)
    op.alter_column('users', 'onboarding_completed',
               existing_type=sa.BOOLEAN(),
               comment='Set to True when student completes FIRST license onboarding (motivation questionnaire). Note: UserLicense.onboarding_completed tracks EACH specialization separately.',
               existing_nullable=True)
    op.alter_column('users', 'nationality',
               existing_type=sa.VARCHAR(),
               comment="User's nationality (e.g., Hungarian, American)",
               existing_nullable=True)
    op.alter_column('users', 'gender',
               existing_type=sa.VARCHAR(),
               comment="User's gender (Male, Female, Other, Prefer not to say)",
               existing_nullable=True)
    op.alter_column('users', 'current_location',
               existing_type=sa.VARCHAR(),
               comment="User's current location (e.g., Budapest, Hungary)",
               existing_nullable=True)
    op.alter_column('users', 'street_address',
               existing_type=sa.VARCHAR(),
               comment='Street address (e.g., Main Street 123)',
               existing_nullable=True)
    op.alter_column('users', 'city',
               existing_type=sa.VARCHAR(),
               comment='City name',
               existing_nullable=True)
    op.alter_column('users', 'postal_code',
               existing_type=sa.VARCHAR(),
               comment='Postal/ZIP code',
               existing_nullable=True)
    op.alter_column('users', 'country',
               existing_type=sa.VARCHAR(),
               comment='Country name',
               existing_nullable=True)
    op.alter_column('users', 'specialization',
               existing_type=postgresql.ENUM('GANCUJU_PLAYER', 'LFA_FOOTBALL_PLAYER', 'LFA_COACH', 'INTERNSHIP', 'LFA_PLAYER_PRE', 'LFA_PLAYER_YOUTH', 'LFA_PLAYER_AMATEUR', 'LFA_PLAYER_PRO', 'LFA_PLAYER_PRE_ACADEMY', 'LFA_PLAYER_YOUTH_ACADEMY', 'LFA_PLAYER_AMATEUR_ACADEMY', 'LFA_PLAYER_PRO_ACADEMY', name='specializationtype'),
               comment="User's chosen specialization track (Player/Coach)",
               existing_nullable=True)
    op.alter_column('users', 'payment_verified',
               existing_type=sa.BOOLEAN(),
               comment='Whether student has paid semester fees',
               existing_nullable=False)
    op.alter_column('users', 'payment_verified_at',
               existing_type=postgresql.TIMESTAMP(),
               comment='Timestamp when payment was verified',
               existing_nullable=True)
    op.alter_column('users', 'payment_verified_by',
               existing_type=sa.INTEGER(),
               comment='Admin who verified the payment',
               existing_nullable=True)
    op.alter_column('users', 'credit_balance',
               existing_type=sa.INTEGER(),
               comment='Current available credits (can be used across all specializations)',
               existing_nullable=False)
    op.alter_column('users', 'credit_purchased',
               existing_type=sa.INTEGER(),
               comment='Total credits purchased by this user (for transaction history)',
               existing_nullable=False)
    op.alter_column('users', 'credit_payment_reference',
               existing_type=sa.VARCHAR(length=50),
               comment='Unique payment reference code for credit purchases (k√∂zlem√©ny)',
               existing_nullable=True)
    op.alter_column('users', 'xp_balance',
               existing_type=sa.INTEGER(),
               comment='Current XP (Experience Points) - earned through training and tournaments',
               existing_nullable=False)
    op.alter_column('users', 'nda_accepted',
               existing_type=sa.BOOLEAN(),
               comment='Whether student has accepted the NDA',
               existing_nullable=False)
    op.alter_column('users', 'nda_accepted_at',
               existing_type=postgresql.TIMESTAMP(),
               comment='Timestamp when NDA was accepted',
               existing_nullable=True)
    op.alter_column('users', 'nda_ip_address',
               existing_type=sa.VARCHAR(),
               comment='IP address from which NDA was accepted',
               existing_nullable=True)
    op.alter_column('users', 'parental_consent',
               existing_type=sa.BOOLEAN(),
               comment='Whether parental consent has been given (required for users under 18 in LFA_COACH)',
               existing_nullable=False)
    op.alter_column('users', 'parental_consent_at',
               existing_type=postgresql.TIMESTAMP(),
               comment='Timestamp when parental consent was given',
               existing_nullable=True)
    op.alter_column('users', 'parental_consent_by',
               existing_type=sa.VARCHAR(),
               comment='Name of parent/guardian who gave consent',
               existing_nullable=True)
    # ### end Alembic commands ###


def downgrade() -> None:
    # ### commands auto generated by Alembic - please adjust! ###
    op.alter_column('users', 'parental_consent_by',
               existing_type=sa.VARCHAR(),
               comment=None,
               existing_comment='Name of parent/guardian who gave consent',
               existing_nullable=True)
    op.alter_column('users', 'parental_consent_at',
               existing_type=postgresql.TIMESTAMP(),
               comment=None,
               existing_comment='Timestamp when parental consent was given',
               existing_nullable=True)
    op.alter_column('users', 'parental_consent',
               existing_type=sa.BOOLEAN(),
               comment=None,
               existing_comment='Whether parental consent has been given (required for users under 18 in LFA_COACH)',
               existing_nullable=False)
    op.alter_column('users', 'nda_ip_address',
               existing_type=sa.VARCHAR(),
               comment=None,
               existing_comment='IP address from which NDA was accepted',
               existing_nullable=True)
    op.alter_column('users', 'nda_accepted_at',
               existing_type=postgresql.TIMESTAMP(),
               comment=None,
               existing_comment='Timestamp when NDA was accepted',
               existing_nullable=True)
    op.alter_column('users', 'nda_accepted',
               existing_type=sa.BOOLEAN(),
               comment=None,
               existing_comment='Whether student has accepted the NDA',
               existing_nullable=False)
    op.alter_column('users', 'xp_balance',
               existing_type=sa.INTEGER(),
               comment=None,
               existing_comment='Current XP (Experience Points) - earned through training and tournaments',
               existing_nullable=False)
    op.alter_column('users', 'credit_payment_reference',
               existing_type=sa.VARCHAR(length=50),
               comment=None,
               existing_comment='Unique payment reference code for credit purchases (k√∂zlem√©ny)',
               existing_nullable=True)
    op.alter_column('users', 'credit_purchased',
               existing_type=sa.INTEGER(),
               comment=None,
               existing_comment='Total credits purchased by this user (for transaction history)',
               existing_nullable=False)
    op.alter_column('users', 'credit_balance',
               existing_type=sa.INTEGER(),
               comment=None,
               existing_comment='Current available credits (can be used across all specializations)',
               existing_nullable=False)
    op.alter_column('users', 'payment_verified_by',
               existing_type=sa.INTEGER(),
               comment=None,
               existing_comment='Admin who verified the payment',
               existing_nullable=True)
    op.alter_column('users', 'payment_verified_at',
               existing_type=postgresql.TIMESTAMP(),
               comment=None,
               existing_comment='Timestamp when payment was verified',
               existing_nullable=True)
    op.alter_column('users', 'payment_verified',
               existing_type=sa.BOOLEAN(),
               comment=None,
               existing_comment='Whether student has paid semester fees',
               existing_nullable=False)
    op.alter_column('users', 'specialization',
               existing_type=postgresql.ENUM('GANCUJU_PLAYER', 'LFA_FOOTBALL_PLAYER', 'LFA_COACH', 'INTERNSHIP', 'LFA_PLAYER_PRE', 'LFA_PLAYER_YOUTH', 'LFA_PLAYER_AMATEUR', 'LFA_PLAYER_PRO', 'LFA_PLAYER_PRE_ACADEMY', 'LFA_PLAYER_YOUTH_ACADEMY', 'LFA_PLAYER_AMATEUR_ACADEMY', 'LFA_PLAYER_PRO_ACADEMY', name='specializationtype'),
               comment=None,
               existing_comment="User's chosen specialization track (Player/Coach)",
               existing_nullable=True)
    op.alter_column('users', 'country',
               existing_type=sa.VARCHAR(),
               comment=None,
               existing_comment='Country name',
               existing_nullable=True)
    op.alter_column('users', 'postal_code',
               existing_type=sa.VARCHAR(),
               comment=None,
               existing_comment='Postal/ZIP code',
               existing_nullable=True)
    op.alter_column('users', 'city',
               existing_type=sa.VARCHAR(),
               comment=None,
               existing_comment='City name',
               existing_nullable=True)
    op.alter_column('users', 'street_address',
               existing_type=sa.VARCHAR(),
               comment=None,
               existing_comment='Street address (e.g., Main Street 123)',
               existing_nullable=True)
    op.alter_column('users', 'current_location',
               existing_type=sa.VARCHAR(),
               comment=None,
               existing_comment="User's current location (e.g., Budapest, Hungary)",
               existing_nullable=True)
    op.alter_column('users', 'gender',
               existing_type=sa.VARCHAR(),
               comment=None,
               existing_comment="User's gender (Male, Female, Other, Prefer not to say)",
               existing_nullable=True)
    op.alter_column('users', 'nationality',
               existing_type=sa.VARCHAR(),
               comment=None,
               existing_comment="User's nationality (e.g., Hungarian, American)",
               existing_nullable=True)
    op.alter_column('users', 'onboarding_completed',
               existing_type=sa.BOOLEAN(),
               comment=None,
               existing_comment='Set to True when student completes FIRST license onboarding (motivation questionnaire). Note: UserLicense.onboarding_completed tracks EACH specialization separately.',
               existing_nullable=True)
    op.alter_column('users', 'last_name',
               existing_type=sa.VARCHAR(),
               comment=None,
               existing_comment='User last name (family name)',
               existing_nullable=True)
    op.alter_column('users', 'first_name',
               existing_type=sa.VARCHAR(),
               comment=None,
               existing_comment='User first name (given name)',
               existing_nullable=True)
    op.alter_column('user_licenses', 'credit_expires_at',
               existing_type=postgresql.TIMESTAMP(),
               comment=None,
               existing_comment='Credit expiration date (2 years from purchase)',
               existing_nullable=True)
    op.alter_column('user_licenses', 'credit_purchased',
               existing_type=sa.INTEGER(),
               comment=None,
               existing_comment='Total credits purchased (lifetime)',
               existing_nullable=False)
    op.alter_column('user_licenses', 'credit_balance',
               existing_type=sa.INTEGER(),
               comment=None,
               existing_comment='Current credit balance available for enrollments',
               existing_nullable=False)
    op.alter_column('user_licenses', 'skills_updated_by',
               existing_type=sa.INTEGER(),
               comment=None,
               existing_comment='Instructor who last updated skills',
               existing_nullable=True)
    op.alter_column('user_licenses', 'skills_last_updated_at',
               existing_type=postgresql.TIMESTAMP(),
               comment=None,
               existing_comment='When skills were last updated',
               existing_nullable=True)
    op.alter_column('user_licenses', 'football_skills',
               existing_type=postgresql.JSON(astext_type=sa.Text()),
               comment=None,
               existing_comment='6 football skill percentages for LFA Player specializations (heading, shooting, crossing, passing, dribbling, ball_control)',
               existing_nullable=True)
    op.alter_column('user_licenses', 'motivation_assessed_by',
               existing_type=sa.INTEGER(),
               comment=None,
               existing_comment='Admin/instructor who assessed motivation',
               existing_nullable=True)
    op.alter_column('user_licenses', 'motivation_last_assessed_at',
               existing_type=postgresql.TIMESTAMP(),
               comment=None,
               existing_comment='When motivation was last assessed',
               existing_nullable=True)
    op.alter_column('user_licenses', 'average_motivation_score',
               existing_type=sa.DOUBLE_PRECISION(precision=53),
               comment=None,
               existing_comment='Calculated average motivation score (1.0-5.0)',
               existing_nullable=True)
    op.alter_column('user_licenses', 'motivation_scores',
               existing_type=postgresql.JSON(astext_type=sa.Text()),
               comment=None,
               existing_comment='Motivation assessment scores (1-5 scale) - filled by admin/instructor',
               existing_nullable=True)
    op.alter_column('user_licenses', 'renewal_cost',
               existing_type=sa.INTEGER(),
               comment=None,
               existing_comment='Credit cost to renew this license (default: 1000 credits)',
               existing_nullable=False)
    op.alter_column('user_licenses', 'last_renewed_at',
               existing_type=postgresql.TIMESTAMP(),
               comment=None,
               existing_comment='When license was last renewed',
               existing_nullable=True)
    op.alter_column('user_licenses', 'expires_at',
               existing_type=postgresql.TIMESTAMP(),
               comment=None,
               existing_comment='License expiration date (null = no expiration yet, perpetual until first renewal)',
               existing_nullable=True)
    op.alter_column('user_licenses', 'issued_at',
               existing_type=postgresql.TIMESTAMP(),
               comment=None,
               existing_comment='Official license issuance date (e.g., 2014-01-01 for Grand Master)',
               existing_nullable=True)
    op.alter_column('user_licenses', 'is_active',
               existing_type=sa.BOOLEAN(),
               comment=None,
               existing_comment='Whether this license is currently active (can be used for teaching/enrollment)',
               existing_nullable=False)
    op.alter_column('user_licenses', 'onboarding_completed_at',
               existing_type=postgresql.TIMESTAMP(),
               comment=None,
               existing_comment='When student completed onboarding',
               existing_nullable=True)
    op.alter_column('user_licenses', 'onboarding_completed',
               existing_type=sa.BOOLEAN(),
               comment=None,
               existing_comment='Whether student completed basic onboarding for this specialization',
               existing_nullable=False)
    op.alter_column('user_licenses', 'payment_verified_at',
               existing_type=postgresql.TIMESTAMP(),
               comment=None,
               existing_comment='When admin verified the payment',
               existing_nullable=True)
    op.alter_column('user_licenses', 'payment_verified',
               existing_type=sa.BOOLEAN(),
               comment=None,
               existing_comment='Whether admin verified payment received for this license',
               existing_nullable=False)
    op.alter_column('user_licenses', 'payment_reference_code',
               existing_type=sa.VARCHAR(length=50),
               comment=None,
               existing_comment='Unique payment reference for bank transfer (e.g., INT-2025-002-X7K9)',
               existing_nullable=True)
    op.alter_column('tournament_types', 'format',
               existing_type=sa.VARCHAR(length=50),
               comment=None,
               existing_comment='Match format: INDIVIDUAL_RANKING (multi-player ranking) or HEAD_TO_HEAD (1v1 or team vs team score-based)',
               existing_nullable=False,
               existing_server_default=sa.text("'INDIVIDUAL_RANKING'::character varying"))
    op.alter_column('tournament_reward_configs', 'updated_at',
               existing_type=postgresql.TIMESTAMP(),
               comment=None,
               existing_comment='When this reward config was last updated',
               existing_nullable=False)
    op.alter_column('tournament_reward_configs', 'created_at',
               existing_type=postgresql.TIMESTAMP(),
               comment=None,
               existing_comment='When this reward config was created',
               existing_nullable=False)
    op.alter_column('tournament_reward_configs', 'reward_config',
               existing_type=postgresql.JSONB(astext_type=sa.Text()),
               comment=None,
               existing_comment='Detailed reward configuration:\n        - skill_mappings: List of skills with weights, categories, enabled flags\n        - first_place, second_place, third_place: Placement-based rewards (badges, credits, XP)\n        - top_25_percent: Dynamic rewards for top performers\n        - participation: Participation rewards (badges, credits, XP)\n        - template_name: Template name if using preset\n        - custom_config: Whether this is a custom configuration\n        ',
               existing_nullable=True)
    op.alter_column('tournament_reward_configs', 'reward_policy_snapshot',
               existing_type=postgresql.JSONB(astext_type=sa.Text()),
               comment=None,
               existing_comment='Immutable snapshot of the reward policy at tournament creation time',
               existing_nullable=True)
    op.alter_column('tournament_reward_configs', 'reward_policy_name',
               existing_type=sa.VARCHAR(length=100),
               comment=None,
               existing_comment='Name of the reward policy (Standard, Championship, Friendly, Custom)',
               existing_nullable=False)
    op.alter_column('tournament_reward_configs', 'semester_id',
               existing_type=sa.INTEGER(),
               comment=None,
               existing_comment='Tournament this reward config belongs to (1:1 relationship)',
               existing_nullable=False)
    op.alter_column('tournament_configurations', 'updated_at',
               existing_type=postgresql.TIMESTAMP(),
               comment=None,
               existing_comment='When this configuration was last updated',
               existing_nullable=False)
    op.alter_column('tournament_configurations', 'created_at',
               existing_type=postgresql.TIMESTAMP(),
               comment=None,
               existing_comment='When this configuration was created',
               existing_nullable=False)
    op.alter_column('tournament_configurations', 'enrollment_snapshot',
               existing_type=postgresql.JSONB(astext_type=sa.Text()),
               comment=None,
               existing_comment='üì∏ Snapshot of enrollment state before session generation (for regeneration if needed)',
               existing_nullable=True)
    op.alter_column('tournament_configurations', 'sessions_generated_at',
               existing_type=postgresql.TIMESTAMP(),
               comment=None,
               existing_comment='Timestamp when sessions were auto-generated',
               existing_nullable=True)
    op.alter_column('tournament_configurations', 'sessions_generated',
               existing_type=sa.BOOLEAN(),
               comment=None,
               existing_comment='True if tournament sessions have been auto-generated (prevents duplicate generation)',
               existing_nullable=False)
    op.alter_column('tournament_configurations', 'assignment_type',
               existing_type=sa.VARCHAR(length=30),
               comment=None,
               existing_comment='Tournament instructor assignment strategy: OPEN_ASSIGNMENT (admin assigns directly) or APPLICATION_BASED (instructors apply)',
               existing_nullable=True)
    op.alter_column('tournament_configurations', 'number_of_rounds',
               existing_type=sa.INTEGER(),
               comment=None,
               existing_comment='Number of rounds for INDIVIDUAL_RANKING tournaments (1-10). Each round is a separate session. HEAD_TO_HEAD ignores this.',
               existing_nullable=False)
    op.alter_column('tournament_configurations', 'ranking_direction',
               existing_type=sa.VARCHAR(length=10),
               comment=None,
               existing_comment='Ranking direction for INDIVIDUAL_RANKING: ASC (lowest wins, e.g. 100m sprint), DESC (highest wins, e.g. plank). HEAD_TO_HEAD always DESC. NULL for PLACEMENT.',
               existing_nullable=True)
    op.alter_column('tournament_configurations', 'measurement_unit',
               existing_type=sa.VARCHAR(length=50),
               comment=None,
               existing_comment='Unit of measurement for INDIVIDUAL_RANKING results: seconds/minutes (TIME_BASED), meters/centimeters (DISTANCE_BASED), points/repetitions (SCORE_BASED). NULL for PLACEMENT or HEAD_TO_HEAD.',
               existing_nullable=True)
    op.alter_column('tournament_configurations', 'scoring_type',
               existing_type=sa.VARCHAR(length=50),
               comment=None,
               existing_comment='Scoring type for INDIVIDUAL_RANKING: TIME_BASED, DISTANCE_BASED, SCORE_BASED, PLACEMENT. Ignored for HEAD_TO_HEAD.',
               existing_nullable=False)
    op.alter_column('tournament_configurations', 'parallel_fields',
               existing_type=sa.INTEGER(),
               comment=None,
               existing_comment='Number of parallel fields/pitches available (1-4) for simultaneous matches',
               existing_nullable=False)
    op.alter_column('tournament_configurations', 'break_duration_minutes',
               existing_type=sa.INTEGER(),
               comment=None,
               existing_comment='Break time between matches in minutes (overrides tournament_type default)',
               existing_nullable=True)
    op.alter_column('tournament_configurations', 'match_duration_minutes',
               existing_type=sa.INTEGER(),
               comment=None,
               existing_comment='Duration of each match in minutes (overrides tournament_type default)',
               existing_nullable=True)
    op.alter_column('tournament_configurations', 'max_players',
               existing_type=sa.INTEGER(),
               comment=None,
               existing_comment='Maximum tournament participants (explicit capacity, independent of session capacity sum)',
               existing_nullable=True)
    op.alter_column('tournament_configurations', 'is_multi_day',
               existing_type=sa.BOOLEAN(),
               comment=None,
               existing_comment='True if tournament spans multiple days',
               existing_nullable=False)
    op.alter_column('tournament_configurations', 'participant_type',
               existing_type=sa.VARCHAR(length=50),
               comment=None,
               existing_comment='Participant type: INDIVIDUAL, TEAM, MIXED',
               existing_nullable=False)
    op.alter_column('tournament_configurations', 'tournament_type_id',
               existing_type=sa.INTEGER(),
               comment=None,
               existing_comment='FK to tournament_types table (defines format: HEAD_TO_HEAD or INDIVIDUAL_RANKING)',
               existing_nullable=True)
    op.alter_column('tournament_configurations', 'semester_id',
               existing_type=sa.INTEGER(),
               comment=None,
               existing_comment='Tournament this configuration belongs to (1:1 relationship)',
               existing_nullable=False)
    op.drop_column('tournament_configurations', 'campus_schedule_overrides')
    op.alter_column('specializations', 'created_at',
               existing_type=postgresql.TIMESTAMP(),
               comment=None,
               existing_comment='Audit trail for when specialization was created',
               existing_nullable=False)
    op.alter_column('specializations', 'is_active',
               existing_type=sa.BOOLEAN(),
               comment=None,
               existing_comment='Controls availability without code changes',
               existing_nullable=False)
    op.alter_column('specializations', 'id',
               existing_type=sa.VARCHAR(length=50),
               comment=None,
               existing_comment='Matches SpecializationType enum values',
               existing_nullable=False)
    op.alter_column('sessions', 'participant_user_ids',
               existing_type=postgresql.ARRAY(sa.INTEGER()),
               comment=None,
               existing_comment='Explicit list of user_ids participating in THIS MATCH (not tournament-wide). This fixes the architectural issue where participants were determined at runtime.',
               existing_nullable=True)
    op.alter_column('sessions', 'rounds_data',
               existing_type=postgresql.JSONB(astext_type=sa.Text()),
               comment=None,
               existing_comment="Round-by-round results for INDIVIDUAL_RANKING tournaments. Structure: {'total_rounds': 3, 'completed_rounds': 1, 'round_results': {'1': {'user_123': '12.5s', 'user_456': '13.2s'}}}",
               existing_nullable=False,
               existing_server_default=sa.text("'{}'::jsonb"))
    op.alter_column('sessions', 'structure_config',
               existing_type=postgresql.JSONB(astext_type=sa.Text()),
               comment=None,
               existing_comment='Match structure configuration (pairings, teams, performance criteria, etc.)',
               existing_nullable=True)
    op.alter_column('sessions', 'scoring_type',
               existing_type=sa.VARCHAR(length=50),
               comment=None,
               existing_comment='Scoring type: PLACEMENT, WIN_LOSS, SCORE_BASED, TIME_BASED, SKILL_RATING',
               existing_nullable=True)
    op.alter_column('sessions', 'match_format',
               existing_type=sa.VARCHAR(length=50),
               comment=None,
               existing_comment='Match format: INDIVIDUAL_RANKING, HEAD_TO_HEAD, TEAM_MATCH, TIME_BASED, SKILL_RATING',
               existing_nullable=True)
    op.alter_column('sessions', 'pod_tier',
               existing_type=sa.INTEGER(),
               comment=None,
               existing_comment='Performance tier for Swiss System pods (1=top performers, 2=middle, etc.)',
               existing_nullable=True)
    op.alter_column('sessions', 'participant_filter',
               existing_type=sa.VARCHAR(length=50),
               comment=None,
               existing_comment='Participant filter logic: group_membership, top_group_qualifiers, dynamic_swiss_pairing',
               existing_nullable=True)
    op.alter_column('sessions', 'expected_participants',
               existing_type=sa.INTEGER(),
               comment=None,
               existing_comment='Expected number of participants for this session (used for validation)',
               existing_nullable=True)
    op.alter_column('sessions', 'round_number',
               existing_type=sa.INTEGER(),
               comment=None,
               existing_comment='Round number within the group/phase (1, 2, 3, ...)',
               existing_nullable=True)
    op.alter_column('sessions', 'group_identifier',
               existing_type=sa.VARCHAR(length=10),
               comment=None,
               existing_comment='Group identifier for group stage sessions (A, B, C, D)',
               existing_nullable=True)
    op.alter_column('sessions', 'ranking_mode',
               existing_type=sa.VARCHAR(length=50),
               comment=None,
               existing_comment='Ranking mode: ALL_PARTICIPANTS, GROUP_ISOLATED, TIERED, QUALIFIED_ONLY, PERFORMANCE_POD',
               existing_nullable=True)
    op.alter_column('sessions', 'tournament_match_number',
               existing_type=sa.INTEGER(),
               comment=None,
               existing_comment='Match number within the round (1, 2, 3, ...)',
               existing_nullable=True)
    op.alter_column('sessions', 'tournament_round',
               existing_type=sa.INTEGER(),
               comment=None,
               existing_comment='Round number within the tournament (1, 2, 3, ...)',
               existing_nullable=True)
    op.alter_column('sessions', 'tournament_phase',
               existing_type=postgresql.ENUM('GROUP_STAGE', 'KNOCKOUT', 'FINALS', 'PLACEMENT', 'INDIVIDUAL_RANKING', 'SWISS', name='tournament_phase_enum'),
               comment=None,
               existing_comment='Tournament phase: canonical TournamentPhase enum values (GROUP_STAGE, KNOCKOUT, etc.)',
               existing_nullable=True)
    op.alter_column('sessions', 'auto_generated',
               existing_type=sa.BOOLEAN(),
               comment=None,
               existing_comment='True if this session was auto-generated from tournament type config',
               existing_nullable=False)
    op.alter_column('sessions', 'game_results',
               existing_type=sa.TEXT(),
               comment=None,
               existing_comment='JSON array of game results: [{user_id: 1, score: 95, rank: 1}, ...]',
               existing_nullable=True)
    op.alter_column('sessions', 'game_type',
               existing_type=sa.VARCHAR(length=100),
               comment=None,
               existing_comment="Type/name of tournament game (user-defined, e.g., 'Skills Challenge')",
               existing_nullable=True)
    op.alter_column('sessions', 'is_tournament_game',
               existing_type=sa.BOOLEAN(),
               comment=None,
               existing_comment='True if this session is a tournament game',
               existing_nullable=True)
    op.alter_column('sessions', 'credit_cost',
               existing_type=sa.INTEGER(),
               comment=None,
               existing_comment='Number of credits required to book this session (default: 1, workshops may cost more)',
               existing_nullable=False)
    op.alter_column('sessions', 'base_xp',
               existing_type=sa.INTEGER(),
               comment=None,
               existing_comment='Base XP awarded for completing this session (HYBRID=100, ON-SITE=75, VIRTUAL=50)',
               existing_nullable=True)
    op.alter_column('sessions', 'quiz_unlocked',
               existing_type=sa.BOOLEAN(),
               comment=None,
               existing_comment='Whether the quiz is unlocked for students (HYBRID sessions)',
               existing_nullable=True)
    op.alter_column('sessions', 'session_status',
               existing_type=sa.VARCHAR(length=20),
               comment=None,
               existing_comment='Session status: scheduled, in_progress, completed',
               existing_nullable=True)
    op.alter_column('sessions', 'actual_end_time',
               existing_type=postgresql.TIMESTAMP(),
               comment=None,
               existing_comment='Actual end time when instructor stops the session',
               existing_nullable=True)
    op.alter_column('sessions', 'actual_start_time',
               existing_type=postgresql.TIMESTAMP(),
               comment=None,
               existing_comment='Actual start time when instructor starts the session',
               existing_nullable=True)
    op.alter_column('sessions', 'mixed_specialization',
               existing_type=sa.BOOLEAN(),
               comment=None,
               existing_comment='Whether this session is open to all specializations',
               existing_nullable=True)
    op.alter_column('sessions', 'target_specialization',
               existing_type=postgresql.ENUM('GANCUJU_PLAYER', 'LFA_FOOTBALL_PLAYER', 'LFA_COACH', 'INTERNSHIP', 'LFA_PLAYER_PRE', 'LFA_PLAYER_YOUTH', 'LFA_PLAYER_AMATEUR', 'LFA_PLAYER_PRO', 'LFA_PLAYER_PRE_ACADEMY', 'LFA_PLAYER_YOUTH_ACADEMY', 'LFA_PLAYER_AMATEUR_ACADEMY', 'LFA_PLAYER_PRO_ACADEMY', name='specializationtype'),
               comment=None,
               existing_comment='Target specialization for this session (null = all specializations)',
               existing_nullable=True)
    op.alter_column('session_group_students', 'student_id',
               existing_type=sa.INTEGER(),
               comment=None,
               existing_comment='Student assigned to this group',
               existing_nullable=False)
    op.alter_column('session_group_students', 'session_group_id',
               existing_type=sa.INTEGER(),
               comment=None,
               existing_comment='Which group this student is in',
               existing_nullable=False)
    op.alter_column('session_group_assignments', 'created_by',
               existing_type=sa.INTEGER(),
               comment=None,
               existing_comment='Head coach who created this assignment',
               existing_nullable=True)
    op.alter_column('session_group_assignments', 'instructor_id',
               existing_type=sa.INTEGER(),
               comment=None,
               existing_comment='Instructor leading this group',
               existing_nullable=False)
    op.alter_column('session_group_assignments', 'group_number',
               existing_type=sa.INTEGER(),
               comment=None,
               existing_comment='Group number within session (1, 2, 3, 4...)',
               existing_nullable=False)
    op.alter_column('session_group_assignments', 'session_id',
               existing_type=sa.INTEGER(),
               comment=None,
               existing_comment='Session these groups belong to',
               existing_nullable=False)
    op.alter_column('semesters', 'location_id',
               existing_type=sa.INTEGER(),
               comment=None,
               existing_comment='FK to locations table (less specific than campus_id, preferred over legacy location_city/venue/address)',
               existing_nullable=True)
    op.alter_column('semesters', 'campus_id',
               existing_type=sa.INTEGER(),
               comment=None,
               existing_comment='FK to campuses table (most specific location - preferred)',
               existing_nullable=True)
    op.alter_column('semesters', 'focus_description',
               existing_type=sa.VARCHAR(length=500),
               comment=None,
               existing_comment="Focus description (e.g., '√öj√©vi fogadalmak, friss kezd√©s')",
               existing_nullable=True)
    op.alter_column('semesters', 'theme',
               existing_type=sa.VARCHAR(length=200),
               comment=None,
               existing_comment="Marketing theme (e.g., 'New Year Challenge', 'Q1', 'Fall')",
               existing_nullable=True)
    op.alter_column('semesters', 'age_group',
               existing_type=sa.VARCHAR(length=20),
               comment=None,
               existing_comment='Age group (PRE, YOUTH, AMATEUR, PRO)',
               existing_nullable=True)
    op.alter_column('semesters', 'specialization_type',
               existing_type=sa.VARCHAR(length=50),
               comment=None,
               existing_comment='Specialization type (SEASON types: LFA_PLAYER_PRE/YOUTH/AMATEUR/PRO, GANCUJU_PLAYER, LFA_COACH, INTERNSHIP, OR user license for tournaments: LFA_FOOTBALL_PLAYER)',
               existing_nullable=True)
    op.alter_column('semesters', 'master_instructor_id',
               existing_type=sa.INTEGER(),
               comment=None,
               existing_comment='Master instructor who approves enrollment requests for this semester',
               existing_nullable=True)
    op.alter_column('semesters', 'enrollment_cost',
               existing_type=sa.INTEGER(),
               comment=None,
               existing_comment='Credit cost to enroll in this semester (admin adjustable)',
               existing_nullable=False)
    op.alter_column('semesters', 'is_active',
               existing_type=sa.BOOLEAN(),
               comment=None,
               existing_comment='DEPRECATED: Use status field instead. Kept for backward compatibility.',
               existing_nullable=True)
    op.alter_column('semesters', 'winner_count',
               existing_type=sa.INTEGER(),
               comment=None,
               existing_comment='Number of winners for INDIVIDUAL_RANKING tournaments (E2E testing)',
               existing_nullable=True)
    op.alter_column('semesters', 'tournament_status',
               existing_type=sa.VARCHAR(length=50),
               comment=None,
               existing_comment='Tournament-specific status: DRAFT, SEEKING_INSTRUCTOR, READY_FOR_ENROLLMENT, etc.',
               existing_nullable=True)
    op.alter_column('semesters', 'status',
               existing_type=postgresql.ENUM('DRAFT', 'SEEKING_INSTRUCTOR', 'INSTRUCTOR_ASSIGNED', 'READY_FOR_ENROLLMENT', 'ONGOING', 'COMPLETED', 'CANCELLED', name='semester_status'),
               comment=None,
               existing_comment='Current lifecycle phase of the semester',
               existing_nullable=False)
    op.alter_column('semester_enrollments', 'age_category_overridden_by',
               existing_type=sa.INTEGER(),
               comment=None,
               existing_comment='Instructor who overrode the age category',
               existing_nullable=True)
    op.alter_column('semester_enrollments', 'age_category_overridden_at',
               existing_type=postgresql.TIMESTAMP(timezone=True),
               comment=None,
               existing_comment='When age category was overridden by instructor',
               existing_nullable=True)
    op.alter_column('semester_enrollments', 'age_category_overridden',
               existing_type=sa.BOOLEAN(),
               comment=None,
               existing_comment='True if instructor manually changed category',
               existing_nullable=False)
    op.alter_column('semester_enrollments', 'age_category',
               existing_type=sa.VARCHAR(length=20),
               comment=None,
               existing_comment='Age category at enrollment (PRE/YOUTH/AMATEUR/PRO)',
               existing_nullable=True)
    op.alter_column('semester_enrollments', 'deactivated_at',
               existing_type=postgresql.TIMESTAMP(timezone=True),
               comment=None,
               existing_comment='When enrollment was deactivated (if applicable)',
               existing_nullable=True)
    op.alter_column('semester_enrollments', 'enrolled_at',
               existing_type=postgresql.TIMESTAMP(timezone=True),
               comment=None,
               existing_comment='When student enrolled in this spec for this semester',
               existing_nullable=False)
    op.alter_column('semester_enrollments', 'is_active',
               existing_type=sa.BOOLEAN(),
               comment=None,
               existing_comment='Whether this enrollment is currently active (auto-set when approved)',
               existing_nullable=False)
    op.alter_column('semester_enrollments', 'payment_verified_by',
               existing_type=sa.INTEGER(),
               comment=None,
               existing_comment='Admin user who verified payment',
               existing_nullable=True)
    op.alter_column('semester_enrollments', 'payment_verified_at',
               existing_type=postgresql.TIMESTAMP(timezone=True),
               comment=None,
               existing_comment='When payment was verified',
               existing_nullable=True)
    op.alter_column('semester_enrollments', 'payment_verified',
               existing_type=sa.BOOLEAN(),
               comment=None,
               existing_comment='Whether student paid for THIS specialization in THIS semester',
               existing_nullable=False)
    op.alter_column('semester_enrollments', 'payment_reference_code',
               existing_type=sa.VARCHAR(length=50),
               comment=None,
               existing_comment='Unique payment reference code for bank transfer (e.g., LFA-INT-2024S1-042-A7B9)',
               existing_nullable=True)
    op.alter_column('semester_enrollments', 'rejection_reason',
               existing_type=sa.VARCHAR(),
               comment=None,
               existing_comment='Reason for rejection (if rejected)',
               existing_nullable=True)
    op.alter_column('semester_enrollments', 'approved_by',
               existing_type=sa.INTEGER(),
               comment=None,
               existing_comment='Admin who approved/rejected',
               existing_nullable=True)
    op.alter_column('semester_enrollments', 'approved_at',
               existing_type=postgresql.TIMESTAMP(timezone=True),
               comment=None,
               existing_comment='When admin approved/rejected the request',
               existing_nullable=True)
    op.alter_column('semester_enrollments', 'requested_at',
               existing_type=postgresql.TIMESTAMP(timezone=True),
               comment=None,
               existing_comment='When student requested enrollment',
               existing_nullable=False)
    op.alter_column('semester_enrollments', 'request_status',
               existing_type=postgresql.ENUM('PENDING', 'APPROVED', 'REJECTED', 'WITHDRAWN', name='enrollmentstatus'),
               comment=None,
               existing_comment='Enrollment request status: PENDING/APPROVED/REJECTED/WITHDRAWN',
               existing_nullable=False)
    op.alter_column('semester_enrollments', 'user_license_id',
               existing_type=sa.INTEGER(),
               comment=None,
               existing_comment='Link to UserLicense (tracks progress/levels)',
               existing_nullable=False)
    op.alter_column('semester_enrollments', 'semester_id',
               existing_type=sa.INTEGER(),
               comment=None,
               existing_comment='Semester for this enrollment',
               existing_nullable=False)
    op.alter_column('semester_enrollments', 'user_id',
               existing_type=sa.INTEGER(),
               comment=None,
               existing_comment='Student who is enrolled',
               existing_nullable=False)
    op.alter_column('projects', 'mixed_specialization',
               existing_type=sa.BOOLEAN(),
               comment=None,
               existing_comment='Whether this project encourages collaboration between Player and Coach specializations',
               existing_nullable=True)
    op.alter_column('projects', 'target_specialization',
               existing_type=postgresql.ENUM('GANCUJU_PLAYER', 'LFA_FOOTBALL_PLAYER', 'LFA_COACH', 'INTERNSHIP', 'LFA_PLAYER_PRE', 'LFA_PLAYER_YOUTH', 'LFA_PLAYER_AMATEUR', 'LFA_PLAYER_PRO', 'LFA_PLAYER_PRE_ACADEMY', 'LFA_PLAYER_YOUTH_ACADEMY', 'LFA_PLAYER_AMATEUR_ACADEMY', 'LFA_PLAYER_PRO_ACADEMY', name='specializationtype'),
               comment=None,
               existing_comment='Target specialization for this project (null = all specializations)',
               existing_nullable=True)
    op.alter_column('position_applications', 'reviewed_at',
               existing_type=postgresql.TIMESTAMP(timezone=True),
               comment=None,
               existing_comment='When master reviewed application',
               existing_nullable=True)
    op.alter_column('position_applications', 'status',
               existing_type=postgresql.ENUM('PENDING', 'ACCEPTED', 'DECLINED', name='applicationstatus'),
               comment=None,
               existing_comment='PENDING, ACCEPTED, DECLINED',
               existing_nullable=False)
    op.alter_column('position_applications', 'application_message',
               existing_type=sa.TEXT(),
               comment=None,
               existing_comment='Cover letter / application message',
               existing_nullable=False)
    op.alter_column('position_applications', 'applicant_id',
               existing_type=sa.INTEGER(),
               comment=None,
               existing_comment='Instructor applying',
               existing_nullable=False)
    op.alter_column('position_applications', 'position_id',
               existing_type=sa.INTEGER(),
               comment=None,
               existing_comment='Position being applied to',
               existing_nullable=False)
    op.alter_column('locations', 'location_type',
               existing_type=postgresql.ENUM('PARTNER', 'CENTER', name='locationtype'),
               comment=None,
               existing_comment='Location capability: PARTNER (Tournament+Mini only) or CENTER (all types)',
               existing_nullable=False)
    op.alter_column('location_master_instructors', 'terminated_at',
               existing_type=postgresql.TIMESTAMP(timezone=True),
               comment=None,
               existing_comment='When contract was terminated',
               existing_nullable=True)
    op.alter_column('location_master_instructors', 'availability_override',
               existing_type=sa.BOOLEAN(),
               comment=None,
               existing_comment='True if admin sent offer despite availability mismatch',
               existing_nullable=False)
    op.alter_column('location_master_instructors', 'source_position_id',
               existing_type=sa.INTEGER(),
               comment=None,
               existing_comment='Links to job posting if hired via JOB_POSTING pathway',
               existing_nullable=True)
    op.alter_column('location_master_instructors', 'hiring_pathway',
               existing_type=sa.VARCHAR(length=20),
               comment=None,
               existing_comment='Hiring method: DIRECT or JOB_POSTING',
               existing_nullable=False)
    op.alter_column('location_master_instructors', 'declined_at',
               existing_type=postgresql.TIMESTAMP(timezone=True),
               comment=None,
               existing_comment='When instructor declined or offer expired',
               existing_nullable=True)
    op.alter_column('location_master_instructors', 'accepted_at',
               existing_type=postgresql.TIMESTAMP(timezone=True),
               comment=None,
               existing_comment='When instructor accepted the offer',
               existing_nullable=True)
    op.alter_column('location_master_instructors', 'offer_deadline',
               existing_type=postgresql.TIMESTAMP(timezone=True),
               comment=None,
               existing_comment='Deadline for instructor to accept/decline offer',
               existing_nullable=True)
    op.alter_column('location_master_instructors', 'offered_at',
               existing_type=postgresql.TIMESTAMP(timezone=True),
               comment=None,
               existing_comment='When offer was sent to instructor',
               existing_nullable=True)
    op.alter_column('location_master_instructors', 'offer_status',
               existing_type=postgresql.ENUM('OFFERED', 'ACCEPTED', 'DECLINED', 'EXPIRED', name='masterofferstatus'),
               comment=None,
               existing_comment='Offer workflow status: NULL=legacy, OFFERED=pending, ACCEPTED=active, DECLINED/EXPIRED=rejected',
               existing_nullable=True)
    op.alter_column('location_master_instructors', 'is_active',
               existing_type=sa.BOOLEAN(),
               comment=None,
               existing_comment='Only one active master per location',
               existing_nullable=False)
    op.alter_column('location_master_instructors', 'contract_end',
               existing_type=postgresql.TIMESTAMP(timezone=True),
               comment=None,
               existing_comment='Contract end date',
               existing_nullable=False)
    op.alter_column('location_master_instructors', 'contract_start',
               existing_type=postgresql.TIMESTAMP(timezone=True),
               comment=None,
               existing_comment='Contract start date',
               existing_nullable=False)
    op.alter_column('location_master_instructors', 'instructor_id',
               existing_type=sa.INTEGER(),
               comment=None,
               existing_comment='Master instructor user',
               existing_nullable=False)
    op.alter_column('location_master_instructors', 'location_id',
               existing_type=sa.INTEGER(),
               comment=None,
               existing_comment='Location for master instructor',
               existing_nullable=False)
    op.alter_column('invoice_requests', 'verified_at',
               existing_type=postgresql.TIMESTAMP(timezone=True),
               comment=None,
               existing_comment='When admin verified payment',
               existing_nullable=True)
    op.alter_column('invoice_requests', 'paid_at',
               existing_type=postgresql.TIMESTAMP(timezone=True),
               comment=None,
               existing_comment='When payment was made',
               existing_nullable=True)
    op.alter_column('invoice_requests', 'coupon_code',
               existing_type=sa.VARCHAR(length=50),
               comment=None,
               existing_comment='Applied coupon code (if any)',
               existing_nullable=True)
    op.alter_column('invoice_requests', 'specialization',
               existing_type=sa.VARCHAR(length=50),
               comment=None,
               existing_comment='Specialization type',
               existing_nullable=True)
    op.alter_column('invoice_requests', 'credit_amount',
               existing_type=sa.INTEGER(),
               comment=None,
               existing_comment='Credit amount',
               existing_nullable=False)
    op.alter_column('invoice_requests', 'amount_eur',
               existing_type=sa.DOUBLE_PRECISION(precision=53),
               comment=None,
               existing_comment='Amount in EUR',
               existing_nullable=False)
    op.alter_column('invoice_requests', 'payment_reference',
               existing_type=sa.VARCHAR(length=50),
               comment=None,
               existing_comment='Unique payment reference: LFA-YYYYMMDD-HHMMSS-ID-HASH (max 30 chars, SWIFT compatible)',
               existing_nullable=False)
    op.alter_column('invitation_codes', 'notes',
               existing_type=sa.TEXT(),
               comment=None,
               existing_comment='Admin notes about this invitation code',
               existing_nullable=True)
    op.alter_column('invitation_codes', 'expires_at',
               existing_type=postgresql.TIMESTAMP(timezone=True),
               comment=None,
               existing_comment='Optional expiration date',
               existing_nullable=True)
    op.alter_column('invitation_codes', 'created_by_admin_id',
               existing_type=sa.INTEGER(),
               comment=None,
               existing_comment='Admin who created this code',
               existing_nullable=True)
    op.alter_column('invitation_codes', 'used_at',
               existing_type=postgresql.TIMESTAMP(timezone=True),
               comment=None,
               existing_comment='When the code was redeemed',
               existing_nullable=True)
    op.alter_column('invitation_codes', 'used_by_user_id',
               existing_type=sa.INTEGER(),
               comment=None,
               existing_comment='User who redeemed this code',
               existing_nullable=True)
    op.alter_column('invitation_codes', 'is_used',
               existing_type=sa.BOOLEAN(),
               comment=None,
               existing_comment='Whether the code has been used',
               existing_nullable=False)
    op.alter_column('invitation_codes', 'bonus_credits',
               existing_type=sa.INTEGER(),
               comment=None,
               existing_comment='Bonus credits to grant when code is used',
               existing_nullable=False)
    op.alter_column('invitation_codes', 'invited_email',
               existing_type=sa.VARCHAR(length=200),
               comment=None,
               existing_comment='Optional: Email restriction - only this email can use the code',
               existing_nullable=True)
    op.alter_column('invitation_codes', 'invited_name',
               existing_type=sa.VARCHAR(length=200),
               comment=None,
               existing_comment='Name of the person/organization receiving the code',
               existing_nullable=False)
    op.alter_column('invitation_codes', 'code',
               existing_type=sa.VARCHAR(length=50),
               comment=None,
               existing_comment='Unique invitation code',
               existing_nullable=False)
    op.alter_column('instructor_specialization_availability', 'notes',
               existing_type=sa.VARCHAR(length=500),
               comment=None,
               existing_comment='Optional notes from instructor about this availability',
               existing_nullable=True)
    op.alter_column('instructor_specialization_availability', 'is_available',
               existing_type=sa.BOOLEAN(),
               comment=None,
               existing_comment='True if instructor is available for this specialization in this time period',
               existing_nullable=False)
    op.alter_column('instructor_specialization_availability', 'location_city',
               existing_type=sa.VARCHAR(length=100),
               comment=None,
               existing_comment='City where this availability applies (e.g., Budapest, Buda√∂rs)',
               existing_nullable=True)
    op.alter_column('instructor_specialization_availability', 'year',
               existing_type=sa.INTEGER(),
               comment=None,
               existing_comment='Year for which this availability applies (e.g., 2025)',
               existing_nullable=False)
    op.alter_column('instructor_specialization_availability', 'time_period_code',
               existing_type=sa.VARCHAR(length=10),
               comment=None,
               existing_comment='Q1-Q4 for quarterly, M01-M12 for monthly',
               existing_nullable=False)
    op.alter_column('instructor_specialization_availability', 'specialization_type',
               existing_type=sa.VARCHAR(length=50),
               comment=None,
               existing_comment='LFA_PLAYER_PRE, LFA_PLAYER_YOUTH, LFA_PLAYER_AMATEUR, LFA_PLAYER_PRO',
               existing_nullable=False)
    op.alter_column('instructor_specialization_availability', 'instructor_id',
               existing_type=sa.INTEGER(),
               comment=None,
               existing_comment='Instructor who sets this availability preference',
               existing_nullable=False)
    op.alter_column('instructor_positions', 'application_deadline',
               existing_type=postgresql.TIMESTAMP(timezone=True),
               comment=None,
               existing_comment='Application deadline',
               existing_nullable=False)
    op.alter_column('instructor_positions', 'status',
               existing_type=postgresql.ENUM('OPEN', 'FILLED', 'CLOSED', 'CANCELLED', name='positionstatus'),
               comment=None,
               existing_comment='OPEN, FILLED, CLOSED, CANCELLED',
               existing_nullable=False)
    op.alter_column('instructor_positions', 'priority',
               existing_type=sa.INTEGER(),
               comment=None,
               existing_comment='1=low, 5=medium, 10=high',
               existing_nullable=False)
    op.alter_column('instructor_positions', 'description',
               existing_type=sa.TEXT(),
               comment=None,
               existing_comment='Job description and requirements',
               existing_nullable=False)
    op.alter_column('instructor_positions', 'time_period_end',
               existing_type=sa.VARCHAR(length=10),
               comment=None,
               existing_comment='End period code (M06, Q2, etc.)',
               existing_nullable=False)
    op.alter_column('instructor_positions', 'time_period_start',
               existing_type=sa.VARCHAR(length=10),
               comment=None,
               existing_comment='Start period code (M01, Q1, etc.)',
               existing_nullable=False)
    op.alter_column('instructor_positions', 'year',
               existing_type=sa.INTEGER(),
               comment=None,
               existing_comment='Year (e.g., 2026)',
               existing_nullable=False)
    op.alter_column('instructor_positions', 'age_group',
               existing_type=sa.VARCHAR(length=20),
               comment=None,
               existing_comment='PRE, YOUTH, AMATEUR, PRO',
               existing_nullable=False)
    op.alter_column('instructor_positions', 'specialization_type',
               existing_type=sa.VARCHAR(length=50),
               comment=None,
               existing_comment='LFA_PLAYER, INTERNSHIP, etc.',
               existing_nullable=False)
    op.alter_column('instructor_positions', 'is_master_position',
               existing_type=sa.BOOLEAN(),
               comment=None,
               existing_comment='True if this is a master instructor opening, False for assistant positions',
               existing_nullable=False)
    op.alter_column('instructor_positions', 'posted_by',
               existing_type=sa.INTEGER(),
               comment=None,
               existing_comment='Admin or master instructor who posted',
               existing_nullable=False)
    op.alter_column('instructor_positions', 'location_id',
               existing_type=sa.INTEGER(),
               comment=None,
               existing_comment='Location for position',
               existing_nullable=False)
    op.alter_column('instructor_availability_windows', 'notes',
               existing_type=sa.TEXT(),
               comment=None,
               existing_comment='Optional notes from instructor',
               existing_nullable=True)
    op.alter_column('instructor_availability_windows', 'is_available',
               existing_type=sa.BOOLEAN(),
               comment=None,
               existing_comment='True if instructor is available for this window',
               existing_nullable=False)
    op.alter_column('instructor_availability_windows', 'time_period',
               existing_type=sa.VARCHAR(length=10),
               comment=None,
               existing_comment='Q1, Q2, Q3, Q4 or M01-M12',
               existing_nullable=False)
    op.alter_column('instructor_availability_windows', 'year',
               existing_type=sa.INTEGER(),
               comment=None,
               existing_comment='Year (e.g., 2026)',
               existing_nullable=False)
    op.alter_column('instructor_availability_windows', 'instructor_id',
               existing_type=sa.INTEGER(),
               comment=None,
               existing_comment='Instructor setting availability',
               existing_nullable=False)
    op.alter_column('instructor_assignments', 'deactivated_at',
               existing_type=postgresql.TIMESTAMP(timezone=True),
               comment=None,
               existing_comment='When assignment was deactivated',
               existing_nullable=True)
    op.alter_column('instructor_assignments', 'is_active',
               existing_type=sa.BOOLEAN(),
               comment=None,
               existing_comment='Active assignment',
               existing_nullable=False)
    op.alter_column('instructor_assignments', 'assigned_by',
               existing_type=sa.INTEGER(),
               comment=None,
               existing_comment='Master instructor who made assignment',
               existing_nullable=True)
    op.alter_column('instructor_assignments', 'is_master',
               existing_type=sa.BOOLEAN(),
               comment=None,
               existing_comment='True if this is the master instructor',
               existing_nullable=False)
    op.alter_column('instructor_assignments', 'time_period_end',
               existing_type=sa.VARCHAR(length=10),
               comment=None,
               existing_comment='End period code (M06, Q2, etc.)',
               existing_nullable=False)
    op.alter_column('instructor_assignments', 'time_period_start',
               existing_type=sa.VARCHAR(length=10),
               comment=None,
               existing_comment='Start period code (M01, Q1, etc.)',
               existing_nullable=False)
    op.alter_column('instructor_assignments', 'year',
               existing_type=sa.INTEGER(),
               comment=None,
               existing_comment='Year (e.g., 2026)',
               existing_nullable=False)
    op.alter_column('instructor_assignments', 'age_group',
               existing_type=sa.VARCHAR(length=20),
               comment=None,
               existing_comment='PRE, YOUTH, AMATEUR, PRO',
               existing_nullable=False)
    op.alter_column('instructor_assignments', 'specialization_type',
               existing_type=sa.VARCHAR(length=50),
               comment=None,
               existing_comment='LFA_PLAYER, INTERNSHIP, etc.',
               existing_nullable=False)
    op.alter_column('instructor_assignments', 'instructor_id',
               existing_type=sa.INTEGER(),
               comment=None,
               existing_comment='Assigned instructor',
               existing_nullable=False)
    op.alter_column('instructor_assignments', 'location_id',
               existing_type=sa.INTEGER(),
               comment=None,
               existing_comment='Assignment location',
               existing_nullable=False)
    op.alter_column('instructor_assignment_requests', 'priority',
               existing_type=sa.INTEGER(),
               comment=None,
               existing_comment='Higher number = higher priority (0-10)',
               existing_nullable=False)
    op.alter_column('instructor_assignment_requests', 'response_message',
               existing_type=sa.TEXT(),
               comment=None,
               existing_comment='Message from instructor (if declined, reason)',
               existing_nullable=True)
    op.alter_column('instructor_assignment_requests', 'request_message',
               existing_type=sa.TEXT(),
               comment=None,
               existing_comment='Message from admin to instructor',
               existing_nullable=True)
    op.alter_column('instructor_assignment_requests', 'expires_at',
               existing_type=postgresql.TIMESTAMP(timezone=True),
               comment=None,
               existing_comment='Request expiration (optional)',
               existing_nullable=True)
    op.alter_column('instructor_assignment_requests', 'responded_at',
               existing_type=postgresql.TIMESTAMP(timezone=True),
               comment=None,
               existing_comment='When instructor responded',
               existing_nullable=True)
    op.alter_column('instructor_assignment_requests', 'status',
               existing_type=postgresql.ENUM('PENDING', 'ACCEPTED', 'DECLINED', 'CANCELLED', 'EXPIRED', name='assignmentrequeststatus'),
               comment=None,
               existing_comment='PENDING, ACCEPTED, DECLINED, CANCELLED, EXPIRED',
               existing_nullable=False)
    op.alter_column('instructor_assignment_requests', 'location_id',
               existing_type=sa.INTEGER(),
               comment=None,
               existing_comment='Location for the assignment',
               existing_nullable=True)
    op.alter_column('instructor_assignment_requests', 'requested_by',
               existing_type=sa.INTEGER(),
               comment=None,
               existing_comment='Admin who sent the request',
               existing_nullable=True)
    op.alter_column('instructor_assignment_requests', 'instructor_id',
               existing_type=sa.INTEGER(),
               comment=None,
               existing_comment='Instructor receiving the request',
               existing_nullable=False)
    op.alter_column('instructor_assignment_requests', 'semester_id',
               existing_type=sa.INTEGER(),
               comment=None,
               existing_comment='Semester needing an instructor',
               existing_nullable=False)
    op.alter_column('game_presets', 'created_by',
               existing_type=sa.INTEGER(),
               comment=None,
               existing_comment='Admin user who created this preset',
               existing_nullable=True)
    op.alter_column('game_presets', 'updated_at',
               existing_type=postgresql.TIMESTAMP(timezone=True),
               comment=None,
               existing_comment='When this preset was last updated',
               existing_nullable=False,
               existing_server_default=sa.text('now()'))
    op.alter_column('game_presets', 'created_at',
               existing_type=postgresql.TIMESTAMP(timezone=True),
               comment=None,
               existing_comment='When this preset was created',
               existing_nullable=False,
               existing_server_default=sa.text('now()'))
    op.alter_column('game_presets', 'is_locked',
               existing_type=sa.BOOLEAN(),
               comment=None,
               existing_comment="Whether this preset's configuration is locked (cannot be overridden)",
               existing_nullable=False)
    op.alter_column('game_presets', 'is_recommended',
               existing_type=sa.BOOLEAN(),
               comment=None,
               existing_comment='Whether this preset is recommended as default choice',
               existing_nullable=False)
    op.alter_column('game_presets', 'is_active',
               existing_type=sa.BOOLEAN(),
               comment=None,
               existing_comment='Whether this preset is available for selection',
               existing_nullable=False)
    op.alter_column('game_presets', 'game_config',
               existing_type=postgresql.JSONB(astext_type=sa.Text()),
               comment=None,
               existing_comment='Complete game configuration including: format_config (match simulation, ranking rules), skill_config (skills tested, weights), simulation_config (variation, distribution), metadata (category, player count, difficulty)',
               existing_nullable=False)
    op.alter_column('game_presets', 'description',
               existing_type=sa.TEXT(),
               comment=None,
               existing_comment='Description of the game type and its characteristics',
               existing_nullable=True)
    op.alter_column('game_presets', 'name',
               existing_type=sa.VARCHAR(length=100),
               comment=None,
               existing_comment="Display name (e.g., 'GanFootvolley', 'Stole My Goal')",
               existing_nullable=False)
    op.alter_column('game_presets', 'code',
               existing_type=sa.VARCHAR(length=50),
               comment=None,
               existing_comment="Unique code identifier (e.g., 'gan_footvolley', 'stole_my_goal')",
               existing_nullable=False)
    op.alter_column('game_configurations', 'updated_at',
               existing_type=postgresql.TIMESTAMP(),
               comment=None,
               existing_comment='When this game configuration was last updated',
               existing_nullable=False)
    op.alter_column('game_configurations', 'created_at',
               existing_type=postgresql.TIMESTAMP(),
               comment=None,
               existing_comment='When this game configuration was created',
               existing_nullable=False)
    op.alter_column('game_configurations', 'game_config_overrides',
               existing_type=postgresql.JSONB(astext_type=sa.Text()),
               comment=None,
               existing_comment='Custom overrides applied to preset configuration. Tracks what was customized from the base preset. NULL if using preset defaults.',
               existing_nullable=True)
    op.alter_column('game_configurations', 'game_config',
               existing_type=postgresql.JSONB(astext_type=sa.Text()),
               comment=None,
               existing_comment='Merged game configuration (preset + overrides). Final configuration used for tournament simulation. Includes match probabilities, ranking rules, skill weights, and simulation options.',
               existing_nullable=True)
    op.alter_column('game_configurations', 'game_preset_id',
               existing_type=sa.INTEGER(),
               comment=None,
               existing_comment='Reference to pre-configured game type (e.g., GanFootvolley, Stole My Goal). Preset defines default skills, weights, and match rules.',
               existing_nullable=True)
    op.alter_column('game_configurations', 'semester_id',
               existing_type=sa.INTEGER(),
               comment=None,
               existing_comment='Tournament this game configuration belongs to (1:1 relationship)',
               existing_nullable=False)
    op.alter_column('coupons', 'requires_admin_approval',
               existing_type=sa.BOOLEAN(),
               comment=None,
               existing_comment='True if coupon requires admin approval after purchase',
               existing_nullable=False)
    op.alter_column('coupons', 'requires_purchase',
               existing_type=sa.BOOLEAN(),
               comment=None,
               existing_comment='True if coupon can only be used during credit purchase',
               existing_nullable=False)
    op.alter_column('coupon_usages', 'credits_awarded',
               existing_type=sa.INTEGER(),
               comment=None,
               existing_comment='Amount of credits awarded from this coupon',
               existing_nullable=False)
    op.alter_column('attendance', 'xp_earned',
               existing_type=sa.INTEGER(),
               comment=None,
               existing_comment='XP earned for this attendance',
               existing_nullable=True)
    # ### end Alembic commands ###