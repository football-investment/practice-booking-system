"""add_coupon_management_system

Revision ID: 574791caded6
Revises: b12e6da58167
Create Date: 2025-12-04 18:24:03.579213

"""
from alembic import op
import sqlalchemy as sa
from sqlalchemy.dialects import postgresql

# revision identifiers, used by Alembic.
revision = '574791caded6'
down_revision = 'b12e6da58167'
branch_labels = None
depends_on = None


def upgrade() -> None:
    # ### commands auto generated by Alembic - please adjust! ###
    op.create_table('coupons',
    sa.Column('id', sa.Integer(), nullable=False),
    sa.Column('code', sa.String(length=50), nullable=False),
    sa.Column('type', sa.Enum('PERCENT', 'FIXED', 'CREDITS', name='coupontype'), nullable=False),
    sa.Column('discount_value', sa.Float(), nullable=False),
    sa.Column('description', sa.String(length=200), nullable=False),
    sa.Column('is_active', sa.Boolean(), nullable=False),
    sa.Column('expires_at', sa.DateTime(timezone=True), nullable=True),
    sa.Column('max_uses', sa.Integer(), nullable=True),
    sa.Column('current_uses', sa.Integer(), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index(op.f('ix_coupons_code'), 'coupons', ['code'], unique=True)
    op.create_index(op.f('ix_coupons_id'), 'coupons', ['id'], unique=False)
    op.drop_table('audit_logs')
    op.alter_column('attendance', 'xp_earned',
               existing_type=sa.INTEGER(),
               comment='XP earned for this attendance',
               existing_nullable=True,
               existing_server_default=sa.text('0'))
    op.create_index(op.f('ix_belt_promotions_id'), 'belt_promotions', ['id'], unique=False)
    op.alter_column('credit_transactions', 'created_at',
               existing_type=postgresql.TIMESTAMP(timezone=True),
               type_=sa.DateTime(),
               existing_nullable=False,
               existing_server_default=sa.text('now()'))
    op.create_index(op.f('ix_credit_transactions_id'), 'credit_transactions', ['id'], unique=False)
    op.alter_column('football_skill_assessments', 'user_license_id',
               existing_type=sa.INTEGER(),
               comment=None,
               existing_comment='Reference to user_licenses (LFA Player specializations)',
               existing_nullable=False)
    op.alter_column('football_skill_assessments', 'skill_name',
               existing_type=sa.VARCHAR(length=50),
               comment=None,
               existing_comment='Skill name: heading, shooting, crossing, passing, dribbling, ball_control',
               existing_nullable=False)
    op.alter_column('football_skill_assessments', 'points_earned',
               existing_type=sa.INTEGER(),
               comment=None,
               existing_comment='Points earned in this assessment (e.g., 7)',
               existing_nullable=False)
    op.alter_column('football_skill_assessments', 'points_total',
               existing_type=sa.INTEGER(),
               comment=None,
               existing_comment='Total points possible (e.g., 10)',
               existing_nullable=False)
    op.alter_column('football_skill_assessments', 'percentage',
               existing_type=sa.DOUBLE_PRECISION(precision=53),
               comment=None,
               existing_comment='Calculated percentage: (points_earned / points_total) * 100',
               existing_nullable=False)
    op.alter_column('football_skill_assessments', 'assessed_by',
               existing_type=sa.INTEGER(),
               comment=None,
               existing_comment='Instructor who made this assessment',
               existing_nullable=False)
    op.alter_column('football_skill_assessments', 'assessed_at',
               existing_type=postgresql.TIMESTAMP(),
               comment=None,
               existing_comment='When this assessment was made',
               existing_nullable=False,
               existing_server_default=sa.text('now()'))
    op.alter_column('football_skill_assessments', 'notes',
               existing_type=sa.TEXT(),
               comment=None,
               existing_comment='Optional notes from instructor about this assessment',
               existing_nullable=True)
    op.drop_index(op.f('idx_skill_assessments_license'), table_name='football_skill_assessments')
    op.drop_index(op.f('idx_skill_assessments_skill'), table_name='football_skill_assessments')
    op.create_index(op.f('ix_football_skill_assessments_id'), 'football_skill_assessments', ['id'], unique=False)
    op.alter_column('invoice_requests', 'payment_reference',
               existing_type=sa.VARCHAR(length=100),
               type_=sa.String(length=50),
               comment='Unique payment reference: LFA-YYYYMMDD-HHMMSS-ID-HASH (max 30 chars, SWIFT compatible)',
               existing_comment='Unique payment reference: INV-YYYYMMDD-HHMMSS-ID-HASH',
               existing_nullable=False)
    op.alter_column('invoice_requests', 'status',
               existing_type=postgresql.ENUM('pending', 'paid', 'verified', 'cancelled', name='invoicerequeststatus'),
               type_=sa.String(length=20),
               existing_nullable=False,
               existing_server_default=sa.text("'pending'::invoicerequeststatus"))
    op.drop_constraint(op.f('invoice_requests_payment_reference_key'), 'invoice_requests', type_='unique')
    op.alter_column('semester_enrollments', 'user_license_id',
               existing_type=sa.INTEGER(),
               comment='Link to UserLicense (tracks progress/levels)',
               existing_comment='Link to the UserLicense (tracks progress/levels)',
               existing_nullable=False)
    op.alter_column('semester_enrollments', 'request_status',
               existing_type=postgresql.ENUM('PENDING', 'APPROVED', 'REJECTED', 'WITHDRAWN', name='enrollmentstatus'),
               comment='Enrollment request status: PENDING/APPROVED/REJECTED/WITHDRAWN',
               existing_nullable=False,
               existing_server_default=sa.text("'PENDING'::enrollmentstatus"))
    op.alter_column('semester_enrollments', 'requested_at',
               existing_type=postgresql.TIMESTAMP(timezone=True),
               comment='When student requested enrollment',
               existing_nullable=False,
               existing_server_default=sa.text('now()'))
    op.alter_column('semester_enrollments', 'approved_at',
               existing_type=postgresql.TIMESTAMP(timezone=True),
               comment='When admin approved/rejected the request',
               existing_nullable=True)
    op.alter_column('semester_enrollments', 'approved_by',
               existing_type=sa.INTEGER(),
               comment='Admin who approved/rejected',
               existing_nullable=True)
    op.alter_column('semester_enrollments', 'rejection_reason',
               existing_type=sa.VARCHAR(),
               comment='Reason for rejection (if rejected)',
               existing_nullable=True)
    op.alter_column('semester_enrollments', 'payment_reference_code',
               existing_type=sa.VARCHAR(length=50),
               comment='Unique payment reference code for bank transfer (e.g., LFA-INT-2024S1-042-A7B9)',
               existing_nullable=True)
    op.alter_column('semester_enrollments', 'is_active',
               existing_type=sa.BOOLEAN(),
               comment='Whether this enrollment is currently active (auto-set when approved)',
               existing_comment='Whether this enrollment is currently active',
               existing_nullable=False,
               existing_server_default=sa.text('false'))
    op.create_index(op.f('ix_semester_enrollments_id'), 'semester_enrollments', ['id'], unique=False)
    op.alter_column('semesters', 'enrollment_cost',
               existing_type=sa.INTEGER(),
               comment='Credit cost to enroll in this semester (admin adjustable)',
               existing_nullable=False,
               existing_server_default=sa.text('500'))
    op.alter_column('session_quizzes', 'created_at',
               existing_type=postgresql.TIMESTAMP(),
               type_=sa.DateTime(timezone=True),
               existing_nullable=True,
               existing_server_default=sa.text('now()'))
    op.drop_index(op.f('idx_session_quizzes_quiz'), table_name='session_quizzes')
    op.drop_index(op.f('idx_session_quizzes_session'), table_name='session_quizzes')
    op.drop_constraint(op.f('session_quizzes_session_id_quiz_id_key'), 'session_quizzes', type_='unique')
    op.create_index(op.f('ix_session_quizzes_id'), 'session_quizzes', ['id'], unique=False)
    op.create_unique_constraint('uq_session_quiz', 'session_quizzes', ['session_id', 'quiz_id'])
    op.alter_column('sessions', 'quiz_unlocked',
               existing_type=sa.BOOLEAN(),
               comment='Whether the quiz is unlocked for students (HYBRID sessions)',
               existing_nullable=True,
               existing_server_default=sa.text('false'))
    op.alter_column('sessions', 'base_xp',
               existing_type=sa.INTEGER(),
               comment='Base XP awarded for completing this session (HYBRID=100, ON-SITE=75, VIRTUAL=50)',
               existing_nullable=True,
               existing_server_default=sa.text('50'))
    op.drop_index(op.f('ix_sessions_session_id_code'), table_name='sessions')
    op.drop_column('sessions', 'location_venue')
    op.drop_column('sessions', 'duration_minutes')
    op.drop_column('sessions', 'location_city')
    op.drop_column('sessions', 'module_name')
    op.drop_column('sessions', 'session_id_code')
    op.drop_column('sessions', 'location_address')
    op.drop_column('sessions', 'instructor_permissions')
    op.drop_column('sessions', 'instructor_materials')
    op.drop_column('sessions', 'session_number')
    op.drop_column('sessions', 'location_type')
    op.drop_column('sessions', 'module_number')
    op.drop_column('sessions', 'student_description')
    op.drop_column('sessions', 'instructor_role')
    op.alter_column('user_licenses', 'payment_reference_code',
               existing_type=sa.VARCHAR(length=50),
               comment='Unique payment reference for bank transfer (e.g., INT-2025-002-X7K9)',
               existing_nullable=True)
    op.alter_column('user_licenses', 'payment_verified',
               existing_type=sa.BOOLEAN(),
               comment='Whether admin verified payment received for this license',
               existing_nullable=False,
               existing_server_default=sa.text('false'))
    op.alter_column('user_licenses', 'payment_verified_at',
               existing_type=postgresql.TIMESTAMP(),
               comment='When admin verified the payment',
               existing_nullable=True)
    op.alter_column('user_licenses', 'onboarding_completed',
               existing_type=sa.BOOLEAN(),
               comment='Whether student completed basic onboarding for this specialization',
               existing_nullable=False,
               existing_server_default=sa.text('false'))
    op.alter_column('user_licenses', 'onboarding_completed_at',
               existing_type=postgresql.TIMESTAMP(),
               comment='When student completed onboarding',
               existing_nullable=True)
    op.alter_column('user_licenses', 'motivation_scores',
               existing_type=postgresql.JSON(astext_type=sa.Text()),
               comment='Motivation assessment scores (1-5 scale) - filled by admin/instructor',
               existing_nullable=True)
    op.alter_column('user_licenses', 'average_motivation_score',
               existing_type=sa.DOUBLE_PRECISION(precision=53),
               comment='Calculated average motivation score (1.0-5.0)',
               existing_nullable=True)
    op.alter_column('user_licenses', 'motivation_last_assessed_at',
               existing_type=postgresql.TIMESTAMP(),
               comment='When motivation was last assessed',
               existing_nullable=True)
    op.alter_column('user_licenses', 'motivation_assessed_by',
               existing_type=sa.INTEGER(),
               comment='Admin/instructor who assessed motivation',
               existing_nullable=True)
    op.alter_column('user_licenses', 'credit_balance',
               existing_type=sa.INTEGER(),
               comment='Current credit balance available for enrollments',
               existing_nullable=False,
               existing_server_default=sa.text('0'))
    op.alter_column('user_licenses', 'credit_purchased',
               existing_type=sa.INTEGER(),
               comment='Total credits purchased (lifetime)',
               existing_nullable=False,
               existing_server_default=sa.text('0'))
    op.alter_column('user_licenses', 'credit_expires_at',
               existing_type=postgresql.TIMESTAMP(timezone=True),
               type_=sa.DateTime(),
               comment='Credit expiration date (2 years from purchase)',
               existing_nullable=True)
    op.drop_constraint(op.f('fk_user_licenses_skills_updated_by'), 'user_licenses', type_='foreignkey')
    op.create_foreign_key(None, 'user_licenses', 'users', ['skills_updated_by'], ['id'])
    op.alter_column('users', 'onboarding_completed',
               existing_type=sa.BOOLEAN(),
               comment='Set to True when student completes FIRST license onboarding (motivation questionnaire). Note: UserLicense.onboarding_completed tracks EACH specialization separately.',
               existing_nullable=True)
    # ### end Alembic commands ###


def downgrade() -> None:
    # ### commands auto generated by Alembic - please adjust! ###
    op.alter_column('users', 'onboarding_completed',
               existing_type=sa.BOOLEAN(),
               comment=None,
               existing_comment='Set to True when student completes FIRST license onboarding (motivation questionnaire). Note: UserLicense.onboarding_completed tracks EACH specialization separately.',
               existing_nullable=True)
    op.drop_constraint(None, 'user_licenses', type_='foreignkey')
    op.create_foreign_key(op.f('fk_user_licenses_skills_updated_by'), 'user_licenses', 'users', ['skills_updated_by'], ['id'], ondelete='SET NULL')
    op.alter_column('user_licenses', 'credit_expires_at',
               existing_type=sa.DateTime(),
               type_=postgresql.TIMESTAMP(timezone=True),
               comment=None,
               existing_comment='Credit expiration date (2 years from purchase)',
               existing_nullable=True)
    op.alter_column('user_licenses', 'credit_purchased',
               existing_type=sa.INTEGER(),
               comment=None,
               existing_comment='Total credits purchased (lifetime)',
               existing_nullable=False,
               existing_server_default=sa.text('0'))
    op.alter_column('user_licenses', 'credit_balance',
               existing_type=sa.INTEGER(),
               comment=None,
               existing_comment='Current credit balance available for enrollments',
               existing_nullable=False,
               existing_server_default=sa.text('0'))
    op.alter_column('user_licenses', 'motivation_assessed_by',
               existing_type=sa.INTEGER(),
               comment=None,
               existing_comment='Admin/instructor who assessed motivation',
               existing_nullable=True)
    op.alter_column('user_licenses', 'motivation_last_assessed_at',
               existing_type=postgresql.TIMESTAMP(),
               comment=None,
               existing_comment='When motivation was last assessed',
               existing_nullable=True)
    op.alter_column('user_licenses', 'average_motivation_score',
               existing_type=sa.DOUBLE_PRECISION(precision=53),
               comment=None,
               existing_comment='Calculated average motivation score (1.0-5.0)',
               existing_nullable=True)
    op.alter_column('user_licenses', 'motivation_scores',
               existing_type=postgresql.JSON(astext_type=sa.Text()),
               comment=None,
               existing_comment='Motivation assessment scores (1-5 scale) - filled by admin/instructor',
               existing_nullable=True)
    op.alter_column('user_licenses', 'onboarding_completed_at',
               existing_type=postgresql.TIMESTAMP(),
               comment=None,
               existing_comment='When student completed onboarding',
               existing_nullable=True)
    op.alter_column('user_licenses', 'onboarding_completed',
               existing_type=sa.BOOLEAN(),
               comment=None,
               existing_comment='Whether student completed basic onboarding for this specialization',
               existing_nullable=False,
               existing_server_default=sa.text('false'))
    op.alter_column('user_licenses', 'payment_verified_at',
               existing_type=postgresql.TIMESTAMP(),
               comment=None,
               existing_comment='When admin verified the payment',
               existing_nullable=True)
    op.alter_column('user_licenses', 'payment_verified',
               existing_type=sa.BOOLEAN(),
               comment=None,
               existing_comment='Whether admin verified payment received for this license',
               existing_nullable=False,
               existing_server_default=sa.text('false'))
    op.alter_column('user_licenses', 'payment_reference_code',
               existing_type=sa.VARCHAR(length=50),
               comment=None,
               existing_comment='Unique payment reference for bank transfer (e.g., INT-2025-002-X7K9)',
               existing_nullable=True)
    op.add_column('sessions', sa.Column('instructor_role', sa.VARCHAR(length=50), autoincrement=False, nullable=True))
    op.add_column('sessions', sa.Column('student_description', sa.TEXT(), autoincrement=False, nullable=True))
    op.add_column('sessions', sa.Column('module_number', sa.INTEGER(), autoincrement=False, nullable=True))
    op.add_column('sessions', sa.Column('location_type', sa.VARCHAR(length=20), autoincrement=False, nullable=True))
    op.add_column('sessions', sa.Column('session_number', sa.INTEGER(), autoincrement=False, nullable=True))
    op.add_column('sessions', sa.Column('instructor_materials', postgresql.JSONB(astext_type=sa.Text()), autoincrement=False, nullable=True))
    op.add_column('sessions', sa.Column('instructor_permissions', sa.VARCHAR(length=50), autoincrement=False, nullable=True))
    op.add_column('sessions', sa.Column('location_address', sa.TEXT(), autoincrement=False, nullable=True))
    op.add_column('sessions', sa.Column('session_id_code', sa.VARCHAR(length=50), autoincrement=False, nullable=True))
    op.add_column('sessions', sa.Column('module_name', sa.VARCHAR(length=200), autoincrement=False, nullable=True))
    op.add_column('sessions', sa.Column('location_city', sa.VARCHAR(length=100), autoincrement=False, nullable=True))
    op.add_column('sessions', sa.Column('duration_minutes', sa.INTEGER(), autoincrement=False, nullable=True))
    op.add_column('sessions', sa.Column('location_venue', sa.VARCHAR(length=200), autoincrement=False, nullable=True))
    op.create_index(op.f('ix_sessions_session_id_code'), 'sessions', ['session_id_code'], unique=False)
    op.alter_column('sessions', 'base_xp',
               existing_type=sa.INTEGER(),
               comment=None,
               existing_comment='Base XP awarded for completing this session (HYBRID=100, ON-SITE=75, VIRTUAL=50)',
               existing_nullable=True,
               existing_server_default=sa.text('50'))
    op.alter_column('sessions', 'quiz_unlocked',
               existing_type=sa.BOOLEAN(),
               comment=None,
               existing_comment='Whether the quiz is unlocked for students (HYBRID sessions)',
               existing_nullable=True,
               existing_server_default=sa.text('false'))
    op.drop_constraint('uq_session_quiz', 'session_quizzes', type_='unique')
    op.drop_index(op.f('ix_session_quizzes_id'), table_name='session_quizzes')
    op.create_unique_constraint(op.f('session_quizzes_session_id_quiz_id_key'), 'session_quizzes', ['session_id', 'quiz_id'], postgresql_nulls_not_distinct=False)
    op.create_index(op.f('idx_session_quizzes_session'), 'session_quizzes', ['session_id'], unique=False)
    op.create_index(op.f('idx_session_quizzes_quiz'), 'session_quizzes', ['quiz_id'], unique=False)
    op.alter_column('session_quizzes', 'created_at',
               existing_type=sa.DateTime(timezone=True),
               type_=postgresql.TIMESTAMP(),
               existing_nullable=True,
               existing_server_default=sa.text('now()'))
    op.alter_column('semesters', 'enrollment_cost',
               existing_type=sa.INTEGER(),
               comment=None,
               existing_comment='Credit cost to enroll in this semester (admin adjustable)',
               existing_nullable=False,
               existing_server_default=sa.text('500'))
    op.drop_index(op.f('ix_semester_enrollments_id'), table_name='semester_enrollments')
    op.alter_column('semester_enrollments', 'is_active',
               existing_type=sa.BOOLEAN(),
               comment='Whether this enrollment is currently active',
               existing_comment='Whether this enrollment is currently active (auto-set when approved)',
               existing_nullable=False,
               existing_server_default=sa.text('false'))
    op.alter_column('semester_enrollments', 'payment_reference_code',
               existing_type=sa.VARCHAR(length=50),
               comment=None,
               existing_comment='Unique payment reference code for bank transfer (e.g., LFA-INT-2024S1-042-A7B9)',
               existing_nullable=True)
    op.alter_column('semester_enrollments', 'rejection_reason',
               existing_type=sa.VARCHAR(),
               comment=None,
               existing_comment='Reason for rejection (if rejected)',
               existing_nullable=True)
    op.alter_column('semester_enrollments', 'approved_by',
               existing_type=sa.INTEGER(),
               comment=None,
               existing_comment='Admin who approved/rejected',
               existing_nullable=True)
    op.alter_column('semester_enrollments', 'approved_at',
               existing_type=postgresql.TIMESTAMP(timezone=True),
               comment=None,
               existing_comment='When admin approved/rejected the request',
               existing_nullable=True)
    op.alter_column('semester_enrollments', 'requested_at',
               existing_type=postgresql.TIMESTAMP(timezone=True),
               comment=None,
               existing_comment='When student requested enrollment',
               existing_nullable=False,
               existing_server_default=sa.text('now()'))
    op.alter_column('semester_enrollments', 'request_status',
               existing_type=postgresql.ENUM('PENDING', 'APPROVED', 'REJECTED', 'WITHDRAWN', name='enrollmentstatus'),
               comment=None,
               existing_comment='Enrollment request status: PENDING/APPROVED/REJECTED/WITHDRAWN',
               existing_nullable=False,
               existing_server_default=sa.text("'PENDING'::enrollmentstatus"))
    op.alter_column('semester_enrollments', 'user_license_id',
               existing_type=sa.INTEGER(),
               comment='Link to the UserLicense (tracks progress/levels)',
               existing_comment='Link to UserLicense (tracks progress/levels)',
               existing_nullable=False)
    op.create_unique_constraint(op.f('invoice_requests_payment_reference_key'), 'invoice_requests', ['payment_reference'], postgresql_nulls_not_distinct=False)
    op.alter_column('invoice_requests', 'status',
               existing_type=sa.String(length=20),
               type_=postgresql.ENUM('pending', 'paid', 'verified', 'cancelled', name='invoicerequeststatus'),
               existing_nullable=False,
               existing_server_default=sa.text("'pending'::invoicerequeststatus"))
    op.alter_column('invoice_requests', 'payment_reference',
               existing_type=sa.String(length=50),
               type_=sa.VARCHAR(length=100),
               comment='Unique payment reference: INV-YYYYMMDD-HHMMSS-ID-HASH',
               existing_comment='Unique payment reference: LFA-YYYYMMDD-HHMMSS-ID-HASH (max 30 chars, SWIFT compatible)',
               existing_nullable=False)
    op.drop_index(op.f('ix_football_skill_assessments_id'), table_name='football_skill_assessments')
    op.create_index(op.f('idx_skill_assessments_skill'), 'football_skill_assessments', ['user_license_id', 'skill_name'], unique=False)
    op.create_index(op.f('idx_skill_assessments_license'), 'football_skill_assessments', ['user_license_id'], unique=False)
    op.alter_column('football_skill_assessments', 'notes',
               existing_type=sa.TEXT(),
               comment='Optional notes from instructor about this assessment',
               existing_nullable=True)
    op.alter_column('football_skill_assessments', 'assessed_at',
               existing_type=postgresql.TIMESTAMP(),
               comment='When this assessment was made',
               existing_nullable=False,
               existing_server_default=sa.text('now()'))
    op.alter_column('football_skill_assessments', 'assessed_by',
               existing_type=sa.INTEGER(),
               comment='Instructor who made this assessment',
               existing_nullable=False)
    op.alter_column('football_skill_assessments', 'percentage',
               existing_type=sa.DOUBLE_PRECISION(precision=53),
               comment='Calculated percentage: (points_earned / points_total) * 100',
               existing_nullable=False)
    op.alter_column('football_skill_assessments', 'points_total',
               existing_type=sa.INTEGER(),
               comment='Total points possible (e.g., 10)',
               existing_nullable=False)
    op.alter_column('football_skill_assessments', 'points_earned',
               existing_type=sa.INTEGER(),
               comment='Points earned in this assessment (e.g., 7)',
               existing_nullable=False)
    op.alter_column('football_skill_assessments', 'skill_name',
               existing_type=sa.VARCHAR(length=50),
               comment='Skill name: heading, shooting, crossing, passing, dribbling, ball_control',
               existing_nullable=False)
    op.alter_column('football_skill_assessments', 'user_license_id',
               existing_type=sa.INTEGER(),
               comment='Reference to user_licenses (LFA Player specializations)',
               existing_nullable=False)
    op.drop_index(op.f('ix_credit_transactions_id'), table_name='credit_transactions')
    op.alter_column('credit_transactions', 'created_at',
               existing_type=sa.DateTime(),
               type_=postgresql.TIMESTAMP(timezone=True),
               existing_nullable=False,
               existing_server_default=sa.text('now()'))
    op.drop_index(op.f('ix_belt_promotions_id'), table_name='belt_promotions')
    op.alter_column('attendance', 'xp_earned',
               existing_type=sa.INTEGER(),
               comment=None,
               existing_comment='XP earned for this attendance',
               existing_nullable=True,
               existing_server_default=sa.text('0'))
    op.create_table('audit_logs',
    sa.Column('id', sa.INTEGER(), autoincrement=True, nullable=False),
    sa.Column('user_id', sa.INTEGER(), autoincrement=False, nullable=True),
    sa.Column('action', sa.VARCHAR(length=255), autoincrement=False, nullable=False),
    sa.Column('resource_type', sa.VARCHAR(length=100), autoincrement=False, nullable=True),
    sa.Column('resource_id', sa.INTEGER(), autoincrement=False, nullable=True),
    sa.Column('details', postgresql.JSONB(astext_type=sa.Text()), autoincrement=False, nullable=True),
    sa.Column('ip_address', sa.VARCHAR(length=45), autoincrement=False, nullable=True),
    sa.Column('user_agent', sa.TEXT(), autoincrement=False, nullable=True),
    sa.Column('request_method', sa.VARCHAR(length=10), autoincrement=False, nullable=True),
    sa.Column('request_path', sa.VARCHAR(length=500), autoincrement=False, nullable=True),
    sa.Column('status_code', sa.INTEGER(), autoincrement=False, nullable=True),
    sa.Column('timestamp', postgresql.TIMESTAMP(), server_default=sa.text('CURRENT_TIMESTAMP'), autoincrement=False, nullable=True),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], name=op.f('audit_logs_user_id_fkey'), ondelete='SET NULL'),
    sa.PrimaryKeyConstraint('id', name=op.f('audit_logs_pkey'))
    )
    op.drop_index(op.f('ix_coupons_id'), table_name='coupons')
    op.drop_index(op.f('ix_coupons_code'), table_name='coupons')
    op.drop_table('coupons')
    # ### end Alembic commands ###