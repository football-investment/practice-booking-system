"""Add INTERNSHIP specialization type

Revision ID: aae67fe19f8d
Revises: add_payment_verification
Create Date: 2025-09-20 15:09:19.251907

"""
from alembic import op
import sqlalchemy as sa
from sqlalchemy.dialects import postgresql

# revision identifiers, used by Alembic.
revision = 'aae67fe19f8d'
down_revision = 'add_payment_verification'
branch_labels = None
depends_on = None


def upgrade() -> None:
    # Add INTERNSHIP to specialization enum
    op.execute("ALTER TYPE specializationtype ADD VALUE 'INTERNSHIP'")
    
    # ### commands auto generated by Alembic - please adjust! ###
    op.alter_column('projects', 'target_specialization',
               existing_type=postgresql.ENUM('PLAYER', 'COACH', name='specializationtype'),
               comment='Target specialization for this project (null = all specializations)',
               existing_comment='Target specialization for this project. NULL = accessible to all specializations',
               existing_nullable=True)
    op.alter_column('sessions', 'target_specialization',
               existing_type=postgresql.ENUM('PLAYER', 'COACH', name='specializationtype'),
               comment='Target specialization for this session (null = all specializations)',
               existing_comment='Target specialization for this session. NULL = accessible to all specializations',
               existing_nullable=True)
    op.alter_column('sessions', 'mixed_specialization',
               existing_type=sa.BOOLEAN(),
               comment='Whether this session is open to all specializations',
               existing_comment='Whether this session welcomes both Player and Coach specializations together',
               existing_nullable=True,
               existing_server_default=sa.text('false'))
    op.alter_column('users', 'specialization',
               existing_type=postgresql.ENUM('PLAYER', 'COACH', name='specializationtype'),
               comment="User's chosen specialization track (Player/Coach)",
               existing_comment='User chosen specialization track (Player/Coach). NULL = not yet selected for backward compatibility',
               existing_nullable=True)
    op.alter_column('users', 'payment_verified',
               existing_type=sa.BOOLEAN(),
               comment='Whether student has paid semester fees',
               existing_nullable=False)
    op.alter_column('users', 'payment_verified_at',
               existing_type=postgresql.TIMESTAMP(),
               comment='Timestamp when payment was verified',
               existing_nullable=True)
    op.alter_column('users', 'payment_verified_by',
               existing_type=sa.INTEGER(),
               comment='Admin who verified the payment',
               existing_nullable=True)
    # ### end Alembic commands ###


def downgrade() -> None:
    # ### commands auto generated by Alembic - please adjust! ###
    op.alter_column('users', 'payment_verified_by',
               existing_type=sa.INTEGER(),
               comment=None,
               existing_comment='Admin who verified the payment',
               existing_nullable=True)
    op.alter_column('users', 'payment_verified_at',
               existing_type=postgresql.TIMESTAMP(),
               comment=None,
               existing_comment='Timestamp when payment was verified',
               existing_nullable=True)
    op.alter_column('users', 'payment_verified',
               existing_type=sa.BOOLEAN(),
               comment=None,
               existing_comment='Whether student has paid semester fees',
               existing_nullable=False)
    op.alter_column('users', 'specialization',
               existing_type=postgresql.ENUM('PLAYER', 'COACH', name='specializationtype'),
               comment='User chosen specialization track (Player/Coach). NULL = not yet selected for backward compatibility',
               existing_comment="User's chosen specialization track (Player/Coach)",
               existing_nullable=True)
    op.alter_column('sessions', 'mixed_specialization',
               existing_type=sa.BOOLEAN(),
               comment='Whether this session welcomes both Player and Coach specializations together',
               existing_comment='Whether this session is open to all specializations',
               existing_nullable=True,
               existing_server_default=sa.text('false'))
    op.alter_column('sessions', 'target_specialization',
               existing_type=postgresql.ENUM('PLAYER', 'COACH', name='specializationtype'),
               comment='Target specialization for this session. NULL = accessible to all specializations',
               existing_comment='Target specialization for this session (null = all specializations)',
               existing_nullable=True)
    op.alter_column('projects', 'target_specialization',
               existing_type=postgresql.ENUM('PLAYER', 'COACH', name='specializationtype'),
               comment='Target specialization for this project. NULL = accessible to all specializations',
               existing_comment='Target specialization for this project (null = all specializations)',
               existing_nullable=True)
    # ### end Alembic commands ###