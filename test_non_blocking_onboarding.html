<!DOCTYPE html>
<html lang="hu">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Non-Blocking Onboarding Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-card {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .test-results {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            padding: 15px;
            margin: 10px 0;
        }
        .status-success { color: #28a745; }
        .status-warning { color: #ffc107; }
        .status-error { color: #dc3545; }
        .button {
            background: #007bff;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        .button:hover { background: #0056b3; }
        .iframe-container {
            border: 2px solid #dee2e6;
            border-radius: 8px;
            overflow: hidden;
            margin: 20px 0;
        }
        iframe {
            width: 100%;
            height: 600px;
            border: none;
        }
        .token-display {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            padding: 10px;
            font-family: monospace;
            font-size: 12px;
            word-break: break-all;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <h1>üß™ Non-Blocking Onboarding Test</h1>
    
    <div class="test-card">
        <h2>üìã Test Details</h2>
        <p><strong>User:</strong> Cristiano Ronaldo (ronaldo@lfa.com)</p>
        <p><strong>Expected Behavior:</strong></p>
        <ul>
            <li>‚úÖ <strong>Dashboard accessible immediately</strong> - No automatic redirect to onboarding</li>
            <li>üì¢ <strong>Onboarding suggestion banner</strong> - Should appear but not block access</li>
            <li>üéØ <strong>Full navigation available</strong> - All menu items and features accessible</li>
            <li>‚öôÔ∏è <strong>Optional onboarding links</strong> - Banner should offer onboarding options</li>
        </ul>
        
        <div class="token-display">
            <strong>Test Token:</strong><br>
            eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJyb25hbGRvQGxmYS5jb20iLCJleHAiOjE3NTg0NDM1NDQsInR5cGUiOiJhY2Nlc3MifQ.nrDRgRoU1O8B6xWV3RYEfO47UCxGrA-cuA4692Lomq8
        </div>
    </div>

    <div class="test-card">
        <h2>üîó Test Actions</h2>
        <button class="button" onclick="openDashboard()">Open Student Dashboard</button>
        <button class="button" onclick="openProjects()">Test Projects Page</button>
        <button class="button" onclick="openSessions()">Test Sessions Page</button>
        <button class="button" onclick="openOnboarding()">Test Onboarding Access</button>
        <button class="button" onclick="checkConsole()">Check Browser Console</button>
    </div>

    <div class="test-card">
        <h2>üìä Test Results</h2>
        <div id="test-results" class="test-results">
            <p>Click the test buttons above to validate the non-blocking onboarding behavior.</p>
            <p><strong>What to look for:</strong></p>
            <ul>
                <li>Dashboard loads immediately without redirects</li>
                <li>Blue onboarding suggestion banner appears at top</li>
                <li>Banner offers two options: "Profil be√°ll√≠t√°s" and "Szemeszter-centrikus be√°ll√≠t√°s"</li>
                <li>All navigation menu items are clickable and functional</li>
                <li>No automatic redirects to onboarding pages</li>
            </ul>
        </div>
    </div>

    <div class="test-card">
        <h2>üñ•Ô∏è Live Dashboard Test</h2>
        <div class="iframe-container">
            <iframe id="dashboard-frame" src="about:blank"></iframe>
        </div>
    </div>

    <script>
        const baseUrl = 'http://localhost:3000';
        const token = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJyb25hbGRvQGxmYS5jb20iLCJleHAiOjE3NTg0NDM1NDQsInR5cGUiOiJhY2Nlc3MifQ.nrDRgRoU1O8B6xWV3RYEfO47UCxGrA-cuA4692Lomq8';

        function setAuthToken() {
            // Set token in localStorage for the React app
            localStorage.setItem('auth_token', token);
            localStorage.setItem('user_email', 'ronaldo@lfa.com');
            localStorage.setItem('user_role', 'student');
        }

        function updateResults(message, status = 'info') {
            const results = document.getElementById('test-results');
            const statusClass = status === 'success' ? 'status-success' : 
                               status === 'error' ? 'status-error' : 
                               status === 'warning' ? 'status-warning' : '';
            
            results.innerHTML += `<p class="${statusClass}">‚è∞ ${new Date().toLocaleTimeString()}: ${message}</p>`;
            results.scrollTop = results.scrollHeight;
        }

        function openDashboard() {
            setAuthToken();
            updateResults('üîÑ Opening student dashboard...', 'info');
            const iframe = document.getElementById('dashboard-frame');
            iframe.src = `${baseUrl}/student/dashboard`;
            
            iframe.onload = function() {
                updateResults('‚úÖ Dashboard loaded successfully - checking for onboarding banner...', 'success');
                
                setTimeout(() => {
                    try {
                        const iframeDoc = iframe.contentDocument || iframe.contentWindow.document;
                        const banner = iframeDoc.querySelector('.onboarding-suggestion-banner');
                        
                        if (banner) {
                            updateResults('üì¢ SUCCESS: Onboarding suggestion banner is visible!', 'success');
                        } else {
                            updateResults('‚ö†Ô∏è WARNING: Onboarding banner not found (might be hidden or not rendered yet)', 'warning');
                        }
                    } catch (e) {
                        updateResults('‚ÑπÔ∏è Cannot access iframe content due to CORS, but dashboard loaded', 'info');
                    }
                }, 2000);
            };
        }

        function openProjects() {
            setAuthToken();
            updateResults('üîÑ Testing projects page navigation...', 'info');
            window.open(`${baseUrl}/student/projects`, '_blank');
            updateResults('‚úÖ Projects page opened in new tab', 'success');
        }

        function openSessions() {
            setAuthToken();
            updateResults('üîÑ Testing sessions page navigation...', 'info');
            window.open(`${baseUrl}/student/sessions`, '_blank');
            updateResults('‚úÖ Sessions page opened in new tab', 'success');
        }

        function openOnboarding() {
            setAuthToken();
            updateResults('üîÑ Testing onboarding page access...', 'info');
            window.open(`${baseUrl}/student/onboarding`, '_blank');
            updateResults('‚úÖ Onboarding page accessible (should be optional)', 'success');
        }

        function checkConsole() {
            updateResults('üîç Check browser console for onboarding status logs', 'info');
            updateResults('Look for: "üîç Non-blocking onboarding check:" messages', 'info');
            console.log('üß™ Non-blocking onboarding test running');
            console.log('üìß User: ronaldo@lfa.com');
            console.log('üîë Token set in localStorage');
        }

        // Auto-load dashboard on page load
        window.addEventListener('load', function() {
            updateResults('üöÄ Non-blocking onboarding test initialized', 'info');
            updateResults('üìù User data: Missing phone, emergency_contact, and nickname', 'info');
            updateResults('üéØ Expected: Banner should suggest onboarding but not block access', 'info');
        });
    </script>
</body>
</html>