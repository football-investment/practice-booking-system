<!DOCTYPE html>
<html>
<head>
    <title>Semester Names Test</title>
</head>
<body>
    <h1>Semester Names Logic Test</h1>
    <div id="result"></div>

    <script>
        // Mock the API response data (same as what the backend returns)
        const mockApiResponse = {
            "stats": {
                "semesters_participated": 0,
                "total_bookings": 0,
                "total_attended": 0,
                "attendance_rate": 0.0,
                "feedback_given": 0,
                "total_xp": 25,
                "level": 1,
                "first_semester_date": null
            },
            "achievements": [],
            "status": {
                "title": "ğŸ“š New Student",
                "icon": "ğŸ“š",
                "is_returning": false
            },
            "next_level": {
                "current_xp": 25,
                "next_level_xp": 2000,
                "progress_percentage": 2.5
            },
            "semesters": [],
            "current_semester": {
                "id": 19,
                "name": "Test Semester 2025",
                "start_date": "2025-09-15",
                "end_date": "2025-12-15"
            }
        };

        // Extract data same way as the frontend
        const stats = mockApiResponse.stats;
        const userSemesters = mockApiResponse.semesters || [];
        const currentSemester = mockApiResponse.current_semester;

        console.log("ğŸ” Test Data:", { stats, userSemesters, currentSemester });

        // Test the semester timeline logic for the first semester (i = 0)
        const i = 0;
        let status, marker, text, semesterName, semesterTitle;

        const isCompleted = i < stats.semesters_participated;
        const isCurrentWithActivity = i === stats.semesters_participated && (stats.total_bookings > 0 || stats.total_attended > 0 || stats.total_xp > 0);

        // Determine semester name and title - separate index from name (same logic as frontend)
        let semesterIndex = `Semester ${i + 1}`;
        
        if (i < userSemesters.length) {
            // User has participated in this semester
            semesterName = userSemesters[i].name;
            semesterTitle = userSemesters[i].name;
        } else if (i === stats.semesters_participated && currentSemester) {
            // Current semester (user is participating now)
            semesterName = currentSemester.name;
            semesterTitle = currentSemester.name;
        } else {
            // Future/unknown semester
            semesterName = `Semester ${i + 1}`;
            semesterTitle = `Semester ${i + 1}`;
        }

        if (i < stats.semesters_participated) {
            // Past semesters - completed
            status = 'completed';
            marker = 'âœ…';
            text = 'Completed';
        } else if (i === stats.semesters_participated && (stats.total_bookings > 0 || stats.total_attended > 0 || stats.total_xp > 0)) {
            // Current semester with activity - active (including XP from quizzes)
            status = 'current';
            marker = 'ğŸ”„';
            text = 'Current';
        } else {
            // Future semesters - upcoming
            status = 'upcoming';
            marker = 'â³';
            text = 'Upcoming';
        }

        console.log("ğŸ“… Semester Test Result:", {
            index: i,
            semesterName,
            semesterTitle,
            status,
            marker,
            text,
            isCompleted,
            isCurrentWithActivity,
            condition1: i < stats.semesters_participated,
            condition2: i === stats.semesters_participated,
            condition3: stats.total_xp > 0
        });

        // Display results
        const resultDiv = document.getElementById('result');
        resultDiv.innerHTML = `
            <h2>Results:</h2>
            <p><strong>Semester Title:</strong> ${semesterTitle}</p>
            <p><strong>Status:</strong> ${status} ${marker} ${text}</p>
            <p><strong>Expected:</strong> Index: "Semester 1", Title: "Test Semester 2025" with "Current ğŸ”„" status</p>
            <p><strong>Test Result:</strong> ${semesterIndex === 'Semester 1' && semesterTitle === 'Test Semester 2025' && status === 'current' ? 'âœ… PASS' : 'âŒ FAIL'}</p>
            <details>
                <summary>Debug Info</summary>
                <pre>${JSON.stringify({
                    index: i,
                    semesterIndex,
                    semesterName,
                    semesterTitle,
                    status,
                    marker,
                    text,
                    isCompleted,
                    isCurrentWithActivity,
                    'i < userSemesters.length': i < userSemesters.length,
                    'i === stats.semesters_participated && currentSemester': i === stats.semesters_participated && currentSemester,
                    'currentSemester?.name': currentSemester?.name
                }, null, 2)}</pre>
            </details>
        `;
    </script>
</body>
</html>