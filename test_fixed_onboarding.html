<!DOCTYPE html>
<html lang="hu">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ”§ Fixed Non-Blocking Onboarding Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-card {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .status {
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
        }
        .status.success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .status.error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .status.warning { background: #fff3cd; color: #856404; border: 1px solid #ffeeba; }
        .status.info { background: #d1ecf1; color: #0c5460; border: 1px solid #bee5eb; }
        .button {
            background: #007bff;
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin: 10px 5px;
            font-size: 16px;
        }
        .button:hover { background: #0056b3; }
        .button.danger { background: #dc3545; }
        .button.danger:hover { background: #c82333; }
        .credentials {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            padding: 15px;
            font-family: monospace;
            margin: 10px 0;
        }
        .test-results {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            padding: 15px;
            margin: 10px 0;
            max-height: 400px;
            overflow-y: auto;
        }
        .iframe-container {
            border: 2px solid #dee2e6;
            border-radius: 8px;
            overflow: hidden;
            margin: 20px 0;
        }
        iframe {
            width: 100%;
            height: 600px;
            border: none;
        }
    </style>
</head>
<body>
    <h1>ğŸ”§ FIXED: Non-Blocking Onboarding Test</h1>
    
    <div class="test-card">
        <h2>ğŸ¯ A ProblÃ©ma Megoldva</h2>
        <div class="status success">
            <strong>âœ… StudentRouter.js javÃ­tva:</strong> EltÃ¡volÃ­tottuk a blokkolÃ³ onboarding logikÃ¡t
        </div>
        <div class="status success">
            <strong>âœ… ProtectedStudentRoute.js mÅ±kÃ¶dik:</strong> Suggestion banner megjelenÃ­tÃ©s
        </div>
        <div class="status info">
            <strong>ğŸ“¢ VÃ¡rt eredmÃ©ny:</strong> Ronaldo kÃ¶zvetlenÃ¼l a dashboard-ra kerÃ¼l, Ã©s megjelenik a suggestion banner
        </div>
    </div>

    <div class="test-card">
        <h2>ğŸ§ª Teszt Adatok</h2>
        <div class="credentials">
            <strong>Teszt FelhasznÃ¡lÃ³:</strong><br>
            ğŸ“§ Email: ronaldo@lfa.com<br>
            ğŸ”‘ JelszÃ³: lfa123<br>
            ğŸ‘¤ NÃ©v: Cristiano Ronaldo<br><br>
            
            <strong>HiÃ¡nyzÃ³ Adatok (banner okozÃ³i):</strong><br>
            ğŸ“± Telefon: HIÃNYZIK<br>
            ğŸš¨ VÃ©szhelyzeti kontakt: HIÃNYZIK<br>
            ğŸ·ï¸ BecenÃ©v: HIÃNYZIK<br>
            âœ… Onboarding befejezve: False<br><br>
            
            <strong>VÃ¡rt ViselkedÃ©s:</strong><br>
            ğŸ¯ Dashboard azonnali hozzÃ¡fÃ©rÃ©s<br>
            ğŸ“¢ Onboarding suggestion banner megjelenik<br>
            ğŸš€ Teljes navigÃ¡ciÃ³ elÃ©rhetÅ‘
        </div>
    </div>

    <div class="test-card">
        <h2>ğŸ§ª Automatikus Teszt</h2>
        <button class="button" onclick="runAutoTest()">ğŸš€ Automatikus BejelentkezÃ©s Teszt</button>
        <button class="button" onclick="openManualLogin()">ğŸ‘¤ ManuÃ¡lis BejelentkezÃ©s</button>
        <button class="button" onclick="openDashboardDirect()">ğŸ“Š Dashboard KÃ¶zvetlen</button>
        <button class="button danger" onclick="clearResults()">ğŸ—‘ï¸ TÃ¶rlÃ©s</button>
        
        <div id="test-results" class="test-results">
            <p><strong>Teszt eredmÃ©nyek megjelennek itt...</strong></p>
        </div>
    </div>

    <div class="test-card">
        <h2>ğŸ–¥ï¸ Live Dashboard</h2>
        <div class="iframe-container">
            <iframe id="dashboard-frame" src="about:blank"></iframe>
        </div>
    </div>

    <script>
        const API_BASE = 'http://localhost:8000/api/v1';
        const FRONTEND_BASE = 'http://localhost:3000';
        
        function log(message, type = 'info') {
            const results = document.getElementById('test-results');
            const timestamp = new Date().toLocaleTimeString();
            const statusClass = type === 'success' ? 'success' : 
                               type === 'error' ? 'error' : 
                               type === 'warning' ? 'warning' : 'info';
            
            results.innerHTML += `<div class="status ${statusClass}">â° ${timestamp}: ${message}</div>`;
            results.scrollTop = results.scrollHeight;
        }
        
        function clearResults() {
            document.getElementById('test-results').innerHTML = '<p><strong>Teszt eredmÃ©nyek tÃ¶rÃ¶lve...</strong></p>';
        }
        
        async function runAutoTest() {
            log('ğŸš€ Automatikus bejelentkezÃ©s teszt indÃ­tÃ¡sa...', 'info');
            
            try {
                // 1. BejelentkezÃ©s
                log('ğŸ“ BejelentkezÃ©s RonaldÃ³val...', 'info');
                const loginResponse = await fetch(`${API_BASE}/auth/login`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        email: 'ronaldo@lfa.com',
                        password: 'lfa123'
                    })
                });
                
                if (loginResponse.ok) {
                    const loginData = await loginResponse.json();
                    log('âœ… BejelentkezÃ©s sikeres!', 'success');
                    
                    // Token tÃ¡rolÃ¡sa
                    localStorage.setItem('auth_token', loginData.access_token);
                    localStorage.setItem('user_email', 'ronaldo@lfa.com');
                    localStorage.setItem('user_role', 'student');
                    
                    // 2. Dashboard megnyitÃ¡sa iframe-ben
                    log('ğŸ“Š Dashboard betÃ¶ltÃ©se...', 'info');
                    const iframe = document.getElementById('dashboard-frame');
                    iframe.src = `${FRONTEND_BASE}/student/dashboard`;
                    
                    iframe.onload = function() {
                        log('âœ… Dashboard sikeresen betÃ¶ltve!', 'success');
                        log('ğŸ” Onboarding banner ellenÅ‘rzÃ©se...', 'info');
                        
                        // Banner ellenÅ‘rzÃ©se
                        setTimeout(() => {
                            try {
                                const iframeDoc = iframe.contentDocument || iframe.contentWindow.document;
                                const banner = iframeDoc.querySelector('.onboarding-suggestion-banner');
                                
                                if (banner) {
                                    log('ğŸ‰ SIKER: Onboarding suggestion banner megtalÃ¡lva!', 'success');
                                    log('ğŸ“¢ Banner szÃ¶veg: "' + banner.textContent.substring(0, 50) + '..."', 'info');
                                } else {
                                    log('âš ï¸ Figyelem: Onboarding banner nem talÃ¡lhatÃ³', 'warning');
                                }
                                
                                // Navigation linkek ellenÅ‘rzÃ©se
                                const navLinks = iframeDoc.querySelectorAll('nav a');
                                if (navLinks.length > 0) {
                                    log(`âœ… NavigÃ¡ciÃ³ elÃ©rhetÅ‘: ${navLinks.length} menÃ¼pont`, 'success');
                                } else {
                                    log('âŒ NavigÃ¡ciÃ³s linkek nem talÃ¡lhatÃ³k', 'error');
                                }
                            } catch (e) {
                                log('â„¹ï¸ CORS miatt nem lehet iframe tartalmat ellenÅ‘rizni, de a dashboard betÃ¶ltÃ¶tt', 'info');
                            }
                        }, 3000);
                    };
                    
                    iframe.onerror = function() {
                        log('âŒ Dashboard betÃ¶ltÃ©si hiba', 'error');
                    };
                    
                } else {
                    const errorData = await loginResponse.text();
                    log(`âŒ BejelentkezÃ©si hiba: ${loginResponse.status} - ${errorData}`, 'error');
                }
                
            } catch (error) {
                log(`âŒ Teszt hiba: ${error.message}`, 'error');
            }
        }
        
        function openManualLogin() {
            log('ğŸ‘¤ ManuÃ¡lis bejelentkezÃ©s megnyitÃ¡sa...', 'info');
            window.open(`${FRONTEND_BASE}/login`, '_blank');
        }
        
        function openDashboardDirect() {
            log('ğŸ“Š Dashboard kÃ¶zvetlen megnyitÃ¡s...', 'info');
            window.open(`${FRONTEND_BASE}/student/dashboard`, '_blank');
        }
        
        // Auto-start
        window.addEventListener('load', function() {
            log('ğŸ”§ FIXED Non-blocking onboarding teszt kÃ©sz', 'success');
            log('ğŸ“ StudentRouter.js blokkolÃ³ logika eltÃ¡volÃ­tva', 'success');
            log('ğŸ¯ Kattints az "Automatikus BejelentkezÃ©s Teszt" gombra', 'info');
        });
    </script>
</body>
</html>