{% extends "base.html" %}

{% block title %}Dashboard - LFA Education Center{% endblock %}

{% block content %}
{% include 'dashboard_student_switcher.html' %}

<!-- COLORED TOP BANNER with INLINE SWITCHER -->
{% if user.role.value == 'student' and specialization_color and user.specialization %}
<div style="background: {{ specialization_color }}; color: white; padding: 1.5rem; box-shadow: 0 4px 8px rgba(0,0,0,0.2); margin-bottom: 1rem; border-radius: 12px;">
    <div style="display: flex; align-items: center; justify-content: space-between; flex-wrap: wrap; gap: 1rem;">
        <!-- Current Specialization Display -->
        <div style="font-size: 1.4rem; font-weight: 700; flex: 1; min-width: 250px;">
            {% if user.specialization.value == 'GANCUJU_PLAYER' %}
                ğŸ¥‹ ACTIVE: GÄnCuju Player
            {% elif user.specialization.value == 'LFA_PLAYER_PRE' %}
                âš½ ACTIVE: LFA Player PRE
            {% elif user.specialization.value == 'LFA_PLAYER_YOUTH' %}
                âš½ ACTIVE: LFA Player Youth
            {% elif user.specialization.value == 'LFA_PLAYER_AMATEUR' %}
                âš½ ACTIVE: LFA Player Amateur
            {% elif user.specialization.value == 'LFA_PLAYER_PRO' %}
                âš½ ACTIVE: LFA Player PRO
            {% elif user.specialization.value == 'LFA_FOOTBALL_PLAYER' %}
                âš½ ACTIVE: LFA Football Player (Legacy)
            {% elif user.specialization.value == 'LFA_COACH' %}
                ğŸ‘¨â€ğŸ« ACTIVE: LFA Coach
            {% elif user.specialization.value == 'INTERNSHIP' %}
                ğŸ’¼ ACTIVE: Internship
            {% endif %}
        </div>

        <!-- Quick Switch Dropdown (if multiple licenses) -->
        {% if user_licenses|length > 1 %}
        <div style="display: flex; align-items: center; gap: 0.8rem;">
            <select id="specSwitcher" onchange="switchSpec()" style="padding: 0.7rem 1.2rem; border: 3px solid white; border-radius: 8px; font-size: 1rem; font-weight: 600; background-color: white; color: #2c3e50; min-width: 200px; cursor: pointer;">
                {% for license in user_licenses %}
                    {% if license.specialization_type == 'GANCUJU_PLAYER' %}
                        <option value="GANCUJU_PLAYER" {% if user.specialization.value == 'GANCUJU_PLAYER' %}selected{% endif %}>ğŸ¥‹ GÄnCuju Player</option>
                    {% elif license.specialization_type == 'LFA_PLAYER_PRE' %}
                        <option value="LFA_PLAYER_PRE" {% if user.specialization.value == 'LFA_PLAYER_PRE' %}selected{% endif %}>âš½ LFA Player PRE</option>
                    {% elif license.specialization_type == 'LFA_PLAYER_YOUTH' %}
                        <option value="LFA_PLAYER_YOUTH" {% if user.specialization.value == 'LFA_PLAYER_YOUTH' %}selected{% endif %}>âš½ LFA Player Youth</option>
                    {% elif license.specialization_type == 'LFA_PLAYER_AMATEUR' %}
                        <option value="LFA_PLAYER_AMATEUR" {% if user.specialization.value == 'LFA_PLAYER_AMATEUR' %}selected{% endif %}>âš½ LFA Player Amateur</option>
                    {% elif license.specialization_type == 'LFA_PLAYER_PRO' %}
                        <option value="LFA_PLAYER_PRO" {% if user.specialization.value == 'LFA_PLAYER_PRO' %}selected{% endif %}>âš½ LFA Player PRO</option>
                    {% elif license.specialization_type == 'LFA_FOOTBALL_PLAYER' %}
                        <option value="LFA_FOOTBALL_PLAYER" {% if user.specialization.value == 'LFA_FOOTBALL_PLAYER' %}selected{% endif %}>âš½ LFA Football Player</option>
                    {% elif license.specialization_type == 'LFA_COACH' %}
                        <option value="LFA_COACH" {% if user.specialization.value == 'LFA_COACH' %}selected{% endif %}>ğŸ‘¨â€ğŸ« LFA Coach</option>
                    {% elif license.specialization_type == 'INTERNSHIP' %}
                        <option value="INTERNSHIP" {% if user.specialization.value == 'INTERNSHIP' %}selected{% endif %}>ğŸ’¼ Internship</option>
                    {% endif %}
                {% endfor %}
            </select>
        </div>
        <script>
        function switchSpec() {
            const spec = document.getElementById('specSwitcher').value;
            window.location.href = '/dashboard?spec=' + spec;
        }
        </script>
        {% endif %}
    </div>

    <!-- License count and add button -->
    <div style="margin-top: 0.8rem; display: flex; align-items: center; justify-content: center; gap: 1rem; flex-wrap: wrap;">
        {% if user_licenses|length > 1 %}
        <div style="font-size: 0.9rem; opacity: 0.9;">
            ğŸ’¡ You have {{ user_licenses|length }} specializations - switch instantly above!
        </div>
        {% endif %}

        <!-- Add New Specialization Button -->
        {% if user_licenses|length < 4 %}
        <a href="/onboarding/start" style="padding: 0.5rem 1.2rem; background: rgba(255,255,255,0.3); color: white; border: 2px solid white; border-radius: 8px; font-size: 0.9rem; font-weight: 600; text-decoration: none; display: inline-flex; align-items: center; gap: 0.5rem; transition: all 0.2s; cursor: pointer;">
            â• Add Another Specialization
        </a>
        {% endif %}
    </div>
</div>
{% endif %}

<!-- COLORED SIDEBAR INDICATOR for Specialization -->
{% if user.role.value == 'student' and specialization_color %}
<div style="position: fixed; left: 0; top: 0; width: 8px; height: 100%; background: {{ specialization_color }}; z-index: 9999; box-shadow: 2px 0 10px rgba(0,0,0,0.3);"></div>
{% endif %}

<div class="welcome-section" {% if user.role.value == 'student' and specialization_color %}style="background: linear-gradient(135deg, {{ specialization_color }} 0%, #ffffff 100%); border-left: 8px solid {{ specialization_color }};"{% endif %}>
    <h1>Welcome, {{ user.name }}!</h1>
    <p>{{ user.email }}</p>
    {% if user.role.value == 'ADMIN' %}
        <span class="badge" style="background-color: #e74c3c; color: white; padding: 0.3rem 0.8rem; border-radius: 4px; font-size: 0.9rem;">ğŸ‘‘ ADMIN</span>
    {% elif user.role.value == 'INSTRUCTOR' %}
        <span class="badge" style="background-color: #3498db; color: white; padding: 0.3rem 0.8rem; border-radius: 4px; font-size: 0.9rem;">ğŸ‘¨â€ğŸ« INSTRUCTOR</span>
    {% elif user.role.value == 'STUDENT' %}
        <span class="badge" style="background-color: #27ae60; color: white; padding: 0.3rem 0.8rem; border-radius: 4px; font-size: 0.9rem;">ğŸ“ STUDENT</span>

        <!-- CURRENT SPECIALIZATION BADGE - Large and Visible -->
        {% if user.specialization %}
        <div style="display: inline-block; margin-left: 1rem; padding: 0.6rem 1.5rem; border-radius: 8px; font-size: 1.1rem; font-weight: 700; color: white; background: {{ specialization_color or '#3498db' }}; box-shadow: 0 4px 6px rgba(0,0,0,0.2); border: 3px solid white;">
            {% if user.specialization.value == 'GANCUJU_PLAYER' %}
                ğŸ¥‹ GÄnCuju Player
            {% elif user.specialization.value == 'LFA_FOOTBALL_PLAYER' %}
                âš½ LFA Football Player
            {% elif user.specialization.value == 'LFA_COACH' %}
                ğŸ‘¨â€ğŸ« LFA Coach
            {% elif user.specialization.value == 'INTERNSHIP' %}
                ğŸ’¼ Internship
            {% else %}
                ğŸ“š {{ user.specialization.value }}
            {% endif %}
        </div>
        {% endif %}
    {% endif %}
</div>

{% if is_instructor %}
    <!-- ========================================== -->
    <!-- INSTRUCTOR DASHBOARD                       -->
    <!-- ========================================== -->
    <div class="cards-grid">
        <!-- Teaching Qualifications Card - TOGGLE ACTIVE/INACTIVE -->
        <div class="card">
            <h2>ğŸ‘¨â€ğŸ« Teaching Qualifications</h2>
            <p style="color: #7f8c8d; font-size: 0.9rem; margin-bottom: 1rem;">Manage your teaching specializations:</p>
            {% if all_teaching_specializations %}
                <div style="display: flex; flex-direction: column; gap: 0.5rem;">
                {% for spec_data in all_teaching_specializations %}
                    {% set spec = spec_data.specialization %}
                    {% set is_active = spec_data.is_active %}

                    {% if spec == 'GANCUJU_PLAYER' %}
                        <div style="padding: 0.75rem; background-color: {{ 'rgba(52, 152, 219, 0.1)' if is_active else 'rgba(189, 195, 199, 0.1)' }}; border-radius: 6px; border-left: 3px solid {{ '#3498db' if is_active else '#bdc3c7' }}; display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <strong>ğŸ¥‹ GÄnCuju Player</strong>
                                {% if is_active %}
                                    <span style="color: #3498db; font-size: 0.85rem;"> â— ACTIVE</span>
                                {% else %}
                                    <span style="color: #95a5a6; font-size: 0.85rem;"> â—‹ INACTIVE</span>
                                {% endif %}
                                <p style="color: #7f8c8d; font-size: 0.85rem; margin-top: 0.25rem; margin-bottom: 0;">4000-year-old Cuju tradition</p>
                            </div>
                            {% if is_active %}
                                <button onclick="toggleSpecialization('GANCUJU_PLAYER', false)" class="btn btn-secondary" style="padding: 0.4rem 0.8rem; font-size: 0.85rem; background-color: #95a5a6;">Deactivate</button>
                            {% else %}
                                <button onclick="toggleSpecialization('GANCUJU_PLAYER', true)" class="btn btn-primary" style="padding: 0.4rem 0.8rem; font-size: 0.85rem;">Activate</button>
                            {% endif %}
                        </div>
                    {% elif spec == 'LFA_FOOTBALL_PLAYER' %}
                        <div style="padding: 0.75rem; background-color: {{ 'rgba(52, 152, 219, 0.1)' if is_active else 'rgba(189, 195, 199, 0.1)' }}; border-radius: 6px; border-left: 3px solid {{ '#3498db' if is_active else '#bdc3c7' }}; display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <strong>âš½ LFA Football Player</strong>
                                {% if is_active %}
                                    <span style="color: #3498db; font-size: 0.85rem;"> â— ACTIVE</span>
                                {% else %}
                                    <span style="color: #95a5a6; font-size: 0.85rem;"> â—‹ INACTIVE</span>
                                {% endif %}
                                <p style="color: #7f8c8d; font-size: 0.85rem; margin-top: 0.25rem; margin-bottom: 0;">Modern football training</p>
                            </div>
                            {% if is_active %}
                                <button onclick="toggleSpecialization('LFA_FOOTBALL_PLAYER', false)" class="btn btn-secondary" style="padding: 0.4rem 0.8rem; font-size: 0.85rem; background-color: #95a5a6;">Deactivate</button>
                            {% else %}
                                <button onclick="toggleSpecialization('LFA_FOOTBALL_PLAYER', true)" class="btn btn-primary" style="padding: 0.4rem 0.8rem; font-size: 0.85rem;">Activate</button>
                            {% endif %}
                        </div>
                    {% elif spec == 'LFA_COACH' %}
                        <div style="padding: 0.75rem; background-color: {{ 'rgba(52, 152, 219, 0.1)' if is_active else 'rgba(189, 195, 199, 0.1)' }}; border-radius: 6px; border-left: 3px solid {{ '#3498db' if is_active else '#bdc3c7' }}; display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <strong>ğŸ‘¨â€ğŸ« LFA Coach</strong>
                                {% if is_active %}
                                    <span style="color: #3498db; font-size: 0.85rem;"> â— ACTIVE</span>
                                {% else %}
                                    <span style="color: #95a5a6; font-size: 0.85rem;"> â—‹ INACTIVE</span>
                                {% endif %}
                                <p style="color: #7f8c8d; font-size: 0.85rem; margin-top: 0.25rem; margin-bottom: 0;">Coaching certification program</p>
                            </div>
                            {% if is_active %}
                                <button onclick="toggleSpecialization('LFA_COACH', false)" class="btn btn-secondary" style="padding: 0.4rem 0.8rem; font-size: 0.85rem; background-color: #95a5a6;">Deactivate</button>
                            {% else %}
                                <button onclick="toggleSpecialization('LFA_COACH', true)" class="btn btn-primary" style="padding: 0.4rem 0.8rem; font-size: 0.85rem;">Activate</button>
                            {% endif %}
                        </div>
                    {% elif spec == 'INTERNSHIP' %}
                        <div style="padding: 0.75rem; background-color: {{ 'rgba(52, 152, 219, 0.1)' if is_active else 'rgba(189, 195, 199, 0.1)' }}; border-radius: 6px; border-left: 3px solid {{ '#3498db' if is_active else '#bdc3c7' }}; display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <strong>ğŸ’¼ Internship</strong>
                                {% if is_active %}
                                    <span style="color: #3498db; font-size: 0.85rem;"> â— ACTIVE</span>
                                {% else %}
                                    <span style="color: #95a5a6; font-size: 0.85rem;"> â—‹ INACTIVE</span>
                                {% endif %}
                                <p style="color: #7f8c8d; font-size: 0.85rem; margin-top: 0.25rem; margin-bottom: 0;">Startup experience program</p>
                            </div>
                            {% if is_active %}
                                <button onclick="toggleSpecialization('INTERNSHIP', false)" class="btn btn-secondary" style="padding: 0.4rem 0.8rem; font-size: 0.85rem; background-color: #95a5a6;">Deactivate</button>
                            {% else %}
                                <button onclick="toggleSpecialization('INTERNSHIP', true)" class="btn btn-primary" style="padding: 0.4rem 0.8rem; font-size: 0.85rem;">Activate</button>
                            {% endif %}
                        </div>
                    {% endif %}
                {% endfor %}
                </div>
            {% else %}
                <p style="color: #e74c3c;">âŒ No teaching qualifications found</p>
                <p style="font-size: 0.85rem; color: #7f8c8d;">Contact admin to add qualifications</p>
            {% endif %}
        </div>

        <script>
        async function toggleSpecialization(spec, activate) {
            try {
                const response = await fetch('/instructor/specialization/toggle', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        specialization: spec,
                        is_active: activate
                    })
                });

                if (response.ok) {
                    window.location.reload();
                } else {
                    alert('Failed to toggle specialization');
                }
            } catch (error) {
                console.error('Error:', error);
                alert('Error toggling specialization');
            }
        }
        </script>

        <!-- My Teaching Sessions Card -->
        <div class="card">
            <h2>ğŸ“… My Teaching Sessions</h2>
            <p style="color: #7f8c8d;">No upcoming sessions</p>
            <a href="/sessions" class="btn btn-primary mt-2">
                View All Sessions
            </a>
        </div>
    </div>

    <!-- Instructor Quick Actions -->
    <div class="mt-3">
        <h2>Quick Actions</h2>
        <div class="cards-grid">
            <a href="/instructor/enrollments" class="card" style="text-decoration: none; color: inherit; border-left: 4px solid #f39c12;">
                <h3>ğŸ¥‹ Enrollment Requests</h3>
                <p>Approve enrollment requests for your semesters</p>
            </a>

            <a href="/sessions/create" class="card" style="text-decoration: none; color: inherit; border-left: 4px solid #3498db;">
                <h3>â• Create Session</h3>
                <p>Schedule a new training session</p>
            </a>

            <a href="/profile" class="card" style="text-decoration: none; color: inherit;">
                <h3>ğŸ‘¤ View Profile</h3>
                <p>See your instructor profile</p>
            </a>

            <a href="/sessions" class="card" style="text-decoration: none; color: inherit;">
                <h3>ğŸ“š My Sessions</h3>
                <p>Manage your teaching sessions</p>
            </a>
        </div>
    </div>

{% elif user.role.name == 'ADMIN' %}
    <!-- ========================================== -->
    <!-- ADMIN DASHBOARD                            -->
    <!-- ========================================== -->

    <!-- Active Semesters Card (ADMIN ONLY) -->
    {% if active_semesters and active_semesters|length > 0 %}
    <div class="card" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; margin-bottom: 1.5rem;">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem; flex-wrap: wrap; gap: 1rem;">
            <h2 style="color: white; margin: 0;">ğŸ“… Active Semesters ({{ active_semesters|length }})</h2>

            <!-- Filter Dropdown (Category-based) -->
            <select id="semester-filter" onchange="filterSemesters()" style="padding: 0.5rem 1rem; border-radius: 6px; border: 2px solid white; background: rgba(255,255,255,0.2); color: white; font-weight: 600; cursor: pointer;">
                <option value="all" style="color: #2c3e50;">All Categories</option>
                <option value="LFA_PLAYER" style="color: #2c3e50;">âš½ LFA Player (All Levels)</option>
                <option value="GANCUJU" style="color: #2c3e50;">ğŸ¥‹ GÄnCuju Player</option>
                <option value="LFA_COACH" style="color: #2c3e50;">ğŸ‘¨â€ğŸ« LFA Coach</option>
                <option value="INTERNSHIP" style="color: #2c3e50;">ğŸ’¼ Internship</option>
            </select>
        </div>

        <!-- All semesters in one container -->
        <div id="semesters-container">
        {% for semester in active_semesters %}
        <div class="semester-item" data-spec="{{ semester.specialization_type }}" data-category="{% if semester.specialization_type and 'LFA_PLAYER' in semester.specialization_type %}LFA_PLAYER{% elif semester.specialization_type and 'GANCUJU' in semester.specialization_type %}GANCUJU{% elif semester.specialization_type == 'LFA_COACH' %}LFA_COACH{% elif semester.specialization_type == 'INTERNSHIP' %}INTERNSHIP{% else %}OTHER{% endif %}" style="background: rgba(255,255,255,0.1); padding: 0.8rem; border-radius: 6px; margin-bottom: 0.5rem; {% if loop.index > 4 %}display: none;{% endif %}" data-index="{{ loop.index }}">
            <p style="color: white; margin: 0; font-size: 0.95rem;">
                <strong style="color: white;">{{ semester.name }}</strong>
                {% if semester.specialization_type %}
                    <span style="background: rgba(255,255,255,0.2); color: white; padding: 0.2rem 0.5rem; border-radius: 4px; font-size: 0.85rem; margin-left: 0.5rem;">
                        {{ semester.specialization_type.replace('_', ' ').title() }}
                    </span>
                {% endif %}
                {% if semester.location_venue %}
                    <span style="background: rgba(255,165,0,0.3); color: white; padding: 0.2rem 0.5rem; border-radius: 4px; font-size: 0.85rem; margin-left: 0.5rem;">
                        ğŸ“ {{ semester.location_venue }}
                    </span>
                {% endif %}
                <br>
                <span style="color: white; font-size: 0.85rem; opacity: 0.9;">
                    Code: <strong style="color: white;">{{ semester.code }}</strong> |
                    {{ semester.start_date.strftime('%b %d, %Y') }} â†’ {{ semester.end_date.strftime('%b %d, %Y') }}
                    {% if semester.location_address %}
                        <br>ğŸ“® {{ semester.location_address }}
                    {% endif %}
                </span>
            </p>
        </div>
        {% endfor %}
        </div>

        <!-- Show More/Less Button -->
        {% if active_semesters|length > 4 %}
        <button id="toggle-semesters" onclick="toggleSemesters()" style="margin-top: 0.5rem; padding: 0.6rem 1.5rem; background: rgba(255,255,255,0.2); color: white; border: 2px solid white; border-radius: 6px; font-weight: 700; cursor: pointer; width: 100%; transition: all 0.3s;">
            â–¼ Show More ({{ active_semesters|length - 4 }} more)
        </button>
        {% endif %}
    </div>

    <script>
    let isExpanded = false;

    // Toggle Show More/Less
    function toggleSemesters() {
        isExpanded = !isExpanded;
        updateDisplay();
    }

    // Filter semesters by category
    function filterSemesters() {
        // Reset expansion when filtering
        isExpanded = false;
        updateDisplay();
    }

    // Update display based on filter and expansion state
    function updateDisplay() {
        const filterValue = document.getElementById('semester-filter').value;
        const allItems = document.querySelectorAll('.semester-item');
        const toggleBtn = document.getElementById('toggle-semesters');

        let visibleItems = [];

        // First, filter by category
        allItems.forEach(item => {
            const itemCategory = item.getAttribute('data-category');
            const matchesFilter = filterValue === 'all' || itemCategory === filterValue;

            if (matchesFilter) {
                visibleItems.push(item);
            }
        });

        // Now apply visibility based on expansion state
        visibleItems.forEach((item, index) => {
            if (isExpanded || index < 4) {
                item.style.display = 'block';
            } else {
                item.style.display = 'none';
            }
        });

        // Hide non-matching items
        allItems.forEach(item => {
            const itemCategory = item.getAttribute('data-category');
            const matchesFilter = filterValue === 'all' || itemCategory === filterValue;
            if (!matchesFilter) {
                item.style.display = 'none';
            }
        });

        // Update button
        const hiddenCount = Math.max(0, visibleItems.length - 4);

        if (toggleBtn) {
            if (hiddenCount > 0) {
                toggleBtn.style.display = 'block';
                if (isExpanded) {
                    toggleBtn.innerHTML = 'â–² Show Less';
                } else {
                    toggleBtn.innerHTML = `â–¼ Show More (${hiddenCount} more)`;
                }
            } else {
                toggleBtn.style.display = 'none';
            }
        }
    }
    </script>
    {% endif %}

    <div class="cards-grid">
        <div class="card">
            <h2>ğŸ‘‘ User Management</h2>
            <p style="color: #7f8c8d;">Manage students, instructors, and admin accounts</p>
            <a href="/admin/users" class="btn btn-primary mt-2">
                Manage Users
            </a>
        </div>

        <div class="card">
            <h2>ğŸ“ Enrollment Management</h2>
            <p style="color: #7f8c8d;">Approve enrollment requests and manage semester enrollments</p>
            <a href="/admin/enrollments" class="btn btn-primary mt-2">
                Manage Enrollments
            </a>
        </div>

        <div class="card">
            <h2>ğŸ’³ Payment Management</h2>
            <p style="color: #7f8c8d;">Manage invoice requests, verify payments, and approve licenses</p>
            <a href="/admin/payments" class="btn btn-primary mt-2" style="background-color: #f39c12; border-color: #f39c12;">
                Manage Payments
            </a>
        </div>

        <div class="card">
            <h2>ğŸ“… Semester Management</h2>
            <p style="color: #7f8c8d;">Manage semesters and specialization availability</p>
            <a href="/admin/semesters" class="btn btn-primary mt-2">
                Manage Semesters
            </a>
        </div>

        <div class="card">
            <h2>ğŸ“Š Analytics & Reports</h2>
            <p style="color: #7f8c8d;">Platform statistics and performance metrics</p>
            <a href="/admin/analytics" class="btn btn-primary mt-2">
                View Analytics
            </a>
        </div>
    </div>

{% elif user.role.name == 'STUDENT' %}
    <!-- ========================================== -->
    <!-- STUDENT DASHBOARD                          -->
    <!-- ========================================== -->

    {% if not specialization %}
        <!-- ========================================== -->
        <!-- ONBOARDING NOT COMPLETED - Show Specialization Selection -->
        <!-- ========================================== -->
        <div class="card" style="max-width: 800px; margin: 2rem auto; text-align: center;">
            <h2 style="color: #3498db; font-size: 2rem; margin-bottom: 1rem;">ğŸ‘‹ Welcome to LFA!</h2>
            <p style="font-size: 1.1rem; color: #2c3e50; margin-bottom: 2rem;">
                Before you can start your journey, you need to choose your specialization path.
            </p>

            <div style="background-color: #ecf0f1; padding: 1.5rem; border-radius: 8px; margin-bottom: 2rem;">
                <h3 style="color: #2c3e50; margin-bottom: 1rem;">ğŸ¯ Available Specializations</h3>

                <div style="display: grid; gap: 1.5rem; margin-top: 1rem;">
                    <!-- INTERNSHIP -->
                    <div style="background: white; padding: 1.5rem; border-radius: 6px; text-align: left; border-left: 4px solid #e74c3c;">
                        <h4 style="color: #e74c3c; margin: 0 0 0.5rem 0;">ğŸ’¼ Internship</h4>
                        <p style="color: #7f8c8d; font-size: 0.9rem; margin: 0 0 1rem 0;">Build your startup career from zero to co-founder</p>

                        <div style="background: #fef5f5; padding: 0.75rem; border-radius: 4px; margin-top: 0.75rem;">
                            <p style="color: #2c3e50; font-weight: 600; font-size: 0.85rem; margin: 0 0 0.5rem 0;">ğŸ“ˆ 5-Semester Journey (8 Levels):</p>
                            <div style="color: #555; font-size: 0.8rem; line-height: 1.6;">
                                <div>ğŸ”° <strong>Semester 1:</strong> INTERN JUNIOR (Foundation & Culture)</div>
                                <div>ğŸ“ˆ <strong>Semester 2:</strong> INTERN MID-LEVEL (Core Skills)</div>
                                <div>ğŸ¯ <strong>Semester 3:</strong> INTERN SENIOR (Mastery & Strategy)</div>
                                <div>ğŸ‘‘ <strong>Semester 4:</strong> INTERN LEAD (Leadership & Team)</div>
                                <div>ğŸš€ <strong>Semester 5:</strong> INTERN PRINCIPAL (Executive & Co-Founder)</div>
                            </div>
                        </div>
                    </div>

                    <!-- GANCUJU PLAYER -->
                    <div style="background: white; padding: 1.5rem; border-radius: 6px; text-align: left; border-left: 4px solid #f39c12;">
                        <h4 style="color: #f39c12; margin: 0 0 0.5rem 0;">ğŸ¥‹ GÄnCuju Player</h4>
                        <p style="color: #7f8c8d; font-size: 0.9rem; margin: 0 0 1rem 0;">Master the 4000-year-old Chinese football art with authentic Ganballâ„¢ equipment</p>

                        <div style="background: #fef9f3; padding: 0.75rem; border-radius: 4px; margin-top: 0.75rem;">
                            <p style="color: #2c3e50; font-weight: 600; font-size: 0.85rem; margin: 0 0 0.5rem 0;">ğŸ¥‹ Ancient Belt Journey (8 Levels):</p>
                            <div style="color: #555; font-size: 0.8rem; line-height: 1.6;">
                                <div>âšª <strong>L1:</strong> Bamboo Disciple (White) - Foundation</div>
                                <div>ğŸŸ¡ <strong>L2:</strong> Dawn Dew (Yellow) - Awakening</div>
                                <div>ğŸŸ¢ <strong>L3:</strong> Flexible Reed (Green) - Growth</div>
                                <div>ğŸ”µ <strong>L4:</strong> Celestial River (Blue) - Flow</div>
                                <div>ğŸŸ¤ <strong>L5:</strong> Strong Root (Brown) - Mastery</div>
                                <div style="color: #666;">âš« <strong>L6:</strong> Winter Moon (Grey) - Teaching</div>
                                <div>âš« <strong>L7:</strong> Midnight Guardian (Black) - Expert</div>
                                <div>ğŸ”´ <strong>L8:</strong> Dragon Wisdom (Red) - Grand Master</div>
                            </div>
                        </div>
                    </div>

                    <!-- LFA FOOTBALL PLAYER -->
                    <div style="background: white; padding: 1.5rem; border-radius: 6px; text-align: left; border-left: 4px solid #3498db;">
                        <h4 style="color: #3498db; margin: 0 0 0.5rem 0;">âš½ LFA Football Player</h4>
                        <p style="color: #7f8c8d; font-size: 0.9rem; margin: 0 0 1rem 0;">Modern football training and professional player development</p>

                        <div style="background: #f0f7fc; padding: 0.75rem; border-radius: 4px; margin-top: 0.75rem;">
                            <p style="color: #2c3e50; font-weight: 600; font-size: 0.85rem; margin: 0 0 0.5rem 0;">âš½ Age Groups & Licenses:</p>
                            <div style="color: #555; font-size: 0.8rem; line-height: 1.6;">
                                <div>ğŸ¯ <strong>Pre (5-8 years):</strong> Level 1-2 - Foundation Skills</div>
                                <div>ğŸ¯ <strong>Youth (9-14 years):</strong> Level 3-4 - Technique Development</div>
                                <div>ğŸ¯ <strong>Amateur (14+ years):</strong> Level 5-6 - Competitive Play</div>
                                <div>ğŸ¯ <strong>Pro (16+ years):</strong> Level 7-8 - Professional Track</div>
                            </div>
                        </div>
                    </div>

                    <!-- LFA COACH -->
                    <div style="background: white; padding: 1.5rem; border-radius: 6px; text-align: left; border-left: 4px solid #27ae60;">
                        <h4 style="color: #27ae60; margin: 0 0 0.5rem 0;">ğŸ‘¨â€ğŸ« LFA Coach</h4>
                        <p style="color: #7f8c8d; font-size: 0.9rem; margin: 0 0 1rem 0;">Become a certified football coach with LFA methodology</p>

                        <div style="background: #f0f8f4; padding: 0.75rem; border-radius: 4px; margin-top: 0.75rem;">
                            <p style="color: #2c3e50; font-weight: 600; font-size: 0.85rem; margin: 0 0 0.5rem 0;">ğŸ‘¨â€ğŸ« Coaching Levels (Entry: 14+ years, 8 Levels):</p>
                            <div style="color: #555; font-size: 0.8rem; line-height: 1.6;">
                                <div>ğŸ“‹ <strong>L1:</strong> LFA Pre Football Assistant Coach</div>
                                <div>ğŸ“‹ <strong>L2:</strong> LFA Pre Football Head Coach</div>
                                <div>ğŸ“‹ <strong>L3:</strong> LFA Youth Football Assistant Coach</div>
                                <div>ğŸ“‹ <strong>L4:</strong> LFA Youth Football Head Coach</div>
                                <div>ğŸ“‹ <strong>L5:</strong> LFA Amateur Football Assistant Coach</div>
                                <div>ğŸ“‹ <strong>L6:</strong> LFA Amateur Football Head Coach</div>
                                <div>ğŸ“‹ <strong>L7:</strong> LFA PRO Football Assistant Coach</div>
                                <div>ğŸ“‹ <strong>L8:</strong> LFA PRO Football Head Coach</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <a href="/onboarding/start" class="btn btn-primary" style="font-size: 1.2rem; padding: 1rem 2rem;">
                ğŸš€ Start Onboarding - Choose Your Path
            </a>

            <p style="color: #95a5a6; font-size: 0.85rem; margin-top: 1.5rem;">
                â„¹ï¸ You can only access sessions, progress, and other features after completing onboarding
            </p>
        </div>

    {% else %}
        <!-- ========================================== -->
        <!-- ONBOARDING COMPLETED - Full Dashboard -->
        <!-- ========================================== -->


        <!-- PENDING ENROLLMENT REQUESTS - Show ONLY pending requests on dashboard -->
        {% set truly_pending = pending_enrollments|selectattr('request_status.value', 'equalto', 'pending')|list %}

        <!-- Create a set of semester IDs that have pending enrollments -->
        {% set pending_semester_ids = [] %}
        {% for enrollment in truly_pending %}
            {% set _ = pending_semester_ids.append(enrollment.semester.id) %}
        {% endfor %}

        {% if truly_pending and truly_pending|length > 0 %}
        <div class="card" style="border: 3px solid #ff9800; background: linear-gradient(135deg, #fff3e0 0%, #ffffff 100%); margin-bottom: 2rem;">
            <h2 style="color: #e65100; margin-bottom: 0.8rem;">â³ Pending Enrollment Requests</h2>
            <p style="color: #2c3e50; margin-bottom: 1.5rem;">
                Your enrollment requests are awaiting instructor approval.
            </p>

            {% for enrollment in truly_pending %}
            <div style="background: white; border: 2px solid
                {% if enrollment.request_status.value == 'pending' %}#ff9800
                {% elif enrollment.request_status.value == 'approved' %}#4caf50
                {% elif enrollment.request_status.value == 'rejected' %}#f44336
                {% else %}#9e9e9e{% endif %};
                border-radius: 8px; padding: 1.2rem; margin-bottom: 1rem; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">

                <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 1rem;">
                    <div style="flex: 1; min-width: 250px;">
                        <div style="font-size: 1.1rem; font-weight: 700; color: #2c3e50; margin-bottom: 0.5rem;">
                            {{ enrollment.semester.name }}
                        </div>
                        <div style="color: #555; font-size: 0.9rem; margin-bottom: 0.3rem;">
                            ğŸ“… {{ enrollment.semester.start_date.strftime('%b %d, %Y') }} - {{ enrollment.semester.end_date.strftime('%b %d, %Y') }}
                        </div>
                        <div style="color: #777; font-size: 0.85rem;">
                            â° Requested: {{ enrollment.requested_at.strftime('%Y-%m-%d %H:%M') if enrollment.requested_at else 'N/A' }}
                        </div>
                    </div>

                    <div style="text-align: center;">
                        {% if enrollment.request_status.value == 'pending' %}
                        <div style="background: linear-gradient(135deg, #ff9800 0%, #f57c00 100%); color: white; padding: 0.8rem 1.5rem; border-radius: 8px; font-weight: 700; font-size: 1rem; box-shadow: 0 3px 8px rgba(255,152,0,0.3);">
                            â³ PENDING
                        </div>
                        <div style="margin-top: 0.5rem; color: #666; font-size: 0.85rem;">
                            Waiting for admin approval
                        </div>
                        {% elif enrollment.request_status.value == 'approved' %}
                        <div style="background: linear-gradient(135deg, #4caf50 0%, #45a049 100%); color: white; padding: 0.8rem 1.5rem; border-radius: 8px; font-weight: 700; font-size: 1rem; box-shadow: 0 3px 8px rgba(76,175,80,0.3);">
                            âœ… APPROVED
                        </div>
                        <div style="margin-top: 0.5rem; color: #2e7d32; font-size: 0.85rem; font-weight: 600;">
                            You're enrolled!
                        </div>
                        {% elif enrollment.request_status.value == 'rejected' %}
                        <div style="background: linear-gradient(135deg, #f44336 0%, #e53935 100%); color: white; padding: 0.8rem 1.5rem; border-radius: 8px; font-weight: 700; font-size: 1rem; box-shadow: 0 3px 8px rgba(244,67,54,0.3);">
                            âŒ REJECTED
                        </div>
                        <div style="margin-top: 0.5rem; color: #c62828; font-size: 0.85rem;">
                            Contact admin for details
                        </div>
                        {% else %}
                        <div style="background: #9e9e9e; color: white; padding: 0.8rem 1.5rem; border-radius: 8px; font-weight: 700; font-size: 1rem;">
                            {{ enrollment.request_status.value }}
                        </div>
                        {% endif %}
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
        {% endif %}

        <!-- AVAILABLE SEMESTERS - Show if no active enrollment (greyed out if payment not verified) -->
        {% if not has_active_enrollment and available_semesters and available_semesters|length > 0 %}
        <div class="card" style="border: 3px solid {% if current_license and not current_license.payment_verified %}#95a5a6{% else %}{{ specialization_color }}{% endif %}; background: linear-gradient(135deg, {% if current_license and not current_license.payment_verified %}#f5f5f5{% else %}#f0f8ff{% endif %} 0%, #ffffff 100%); margin-bottom: 2rem; {% if current_license and not current_license.payment_verified %}opacity: 0.6;{% endif %}">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                <h2 style="color: {% if current_license and not current_license.payment_verified %}#95a5a6{% else %}{{ specialization_color }}{% endif %}; margin: 0;">ğŸ“… Available Semesters for Enrollment</h2>
                <div style="background: {% if credit_balance > 0 %}#4caf50{% else %}#f44336{% endif %}; color: white; padding: 0.5rem 1rem; border-radius: 20px; font-weight: 700; font-size: 0.9rem;">
                    ğŸ’° {{ credit_balance }} Credits Available
                </div>
            </div>

            {% if current_license and not current_license.payment_verified %}
            <!-- PAYMENT NOT VERIFIED WARNING -->
            <div style="background: #fff3cd; border-left: 4px solid #ffc107; padding: 1rem; border-radius: 4px; margin-bottom: 1.5rem;">
                <strong style="color: #856404;">âš ï¸ Credit Purchase Payment Not Verified</strong>
                <p style="margin: 0.5rem 0 0 0; color: #856404; font-size: 0.9rem;">
                    Your credit purchase payment is awaiting admin verification. You cannot enroll in semesters until the payment is verified. Check your <a href="/profile" style="color: #856404; text-decoration: underline; font-weight: 600;">profile</a> for payment details.
                </p>
            </div>
            {% endif %}

            <p style="color: #2c3e50; margin-bottom: 1.5rem;">
                {% if credit_balance <= 0 %}
                    âš ï¸ <strong>Insufficient credits!</strong> You need to purchase more credits to enroll in semesters. Contact admin to purchase credit packages.
                {% else %}
                    Select a semester to request enrollment. Each semester has a different credit cost. You have <strong>{{ credit_balance }}</strong> credit(s) available.
                {% endif %}
            </p>

            {% if current_semester and current_semester.id not in pending_semester_ids %}
            <div style="background: #e8f5e9; border: 2px solid #4caf50; border-radius: 8px; padding: 1rem; margin-bottom: 1rem;">
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <div>
                        <h3 style="margin: 0; color: #2e7d32;">ğŸŸ¢ Current Semester</h3>
                        <p style="margin: 0.3rem 0 0 0; color: #555; font-size: 0.95rem;">
                            <strong>{{ current_semester.name }}</strong>
                        </p>
                        <p style="margin: 0.3rem 0 0 0; color: #777; font-size: 0.85rem;">
                            {{ current_semester.start_date.strftime('%b %d, %Y') }} - {{ current_semester.end_date.strftime('%b %d, %Y') }}
                        </p>
                        <p style="margin: 0.5rem 0 0 0; color: #ff9800; font-weight: 600; font-size: 0.9rem;">
                            ğŸ’° Cost: {{ current_semester.enrollment_cost }} credits
                        </p>
                    </div>
                    {% if current_license and not current_license.payment_verified %}
                    <button disabled style="padding: 0.7rem 1.5rem; background: #ccc; color: #666; border: none; border-radius: 6px; font-weight: 600; cursor: not-allowed;">
                        Payment Not Verified
                    </button>
                    {% elif credit_balance >= current_semester.enrollment_cost %}
                    <button onclick="requestEnrollment({{ current_semester.id }})" style="padding: 0.7rem 1.5rem; background: #4caf50; color: white; border: none; border-radius: 6px; font-weight: 600; cursor: pointer;">
                        âœ… Enroll Now
                    </button>
                    {% else %}
                    <button disabled style="padding: 0.7rem 1.5rem; background: #ccc; color: #666; border: none; border-radius: 6px; font-weight: 600; cursor: not-allowed;">
                        Insufficient Credits
                    </button>
                    {% endif %}
                </div>
            </div>
            {% endif %}

            {% if next_semester and next_semester.id not in pending_semester_ids %}
            <div style="background: #fff3e0; border: 2px solid #ff9800; border-radius: 8px; padding: 1rem; margin-bottom: 1rem;">
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <div>
                        <h3 style="margin: 0; color: #e65100;">ğŸ”œ Next Semester</h3>
                        <p style="margin: 0.3rem 0 0 0; color: #555; font-size: 0.95rem;">
                            <strong>{{ next_semester.name }}</strong>
                        </p>
                        <p style="margin: 0.3rem 0 0 0; color: #777; font-size: 0.85rem;">
                            Starts: {{ next_semester.start_date.strftime('%b %d, %Y') }}
                        </p>
                        <p style="margin: 0.5rem 0 0 0; color: #ff9800; font-weight: 600; font-size: 0.9rem;">
                            ğŸ’° Cost: {{ next_semester.enrollment_cost }} credits
                        </p>
                    </div>
                    {% if current_license and not current_license.payment_verified %}
                    <button disabled style="padding: 0.7rem 1.5rem; background: #ccc; color: #666; border: none; border-radius: 6px; font-weight: 600; cursor: not-allowed;">
                        Payment Not Verified
                    </button>
                    {% elif credit_balance >= next_semester.enrollment_cost %}
                    <button onclick="requestEnrollment({{ next_semester.id }})" style="padding: 0.7rem 1.5rem; background: #ff9800; color: white; border: none; border-radius: 6px; font-weight: 600; cursor: pointer;">
                        ğŸ“ Pre-Enroll
                    </button>
                    {% else %}
                    <button disabled style="padding: 0.7rem 1.5rem; background: #ccc; color: #666; border: none; border-radius: 6px; font-weight: 600; cursor: not-allowed;">
                        Insufficient Credits
                    </button>
                    {% endif %}
                </div>
            </div>
            {% endif %}

            {% if available_semesters|length > 2 %}
            <details style="margin-top: 1rem;">
                <summary style="cursor: pointer; font-weight: 600; color: {{ specialization_color }}; padding: 0.5rem;">
                    â• Show More Semesters ({{ available_semesters|length - 2 }} more)
                </summary>
                <div style="margin-top: 1rem; display: flex; flex-direction: column; gap: 0.8rem;">
                    {% for semester in available_semesters[2:] %}
                    {% if semester.id not in pending_semester_ids %}
                    <div style="background: #f8f9fa; border: 1px solid #dee2e6; border-radius: 6px; padding: 0.8rem; display: flex; justify-content: space-between; align-items: center;">
                        <div>
                            <strong>{{ semester.name }}</strong>
                            <p style="margin: 0.2rem 0 0 0; color: #777; font-size: 0.85rem;">
                                {{ semester.start_date.strftime('%b %d, %Y') }} - {{ semester.end_date.strftime('%b %d, %Y') }}
                            </p>
                            <p style="margin: 0.3rem 0 0 0; color: #ff9800; font-weight: 600; font-size: 0.85rem;">
                                ğŸ’° Cost: {{ semester.enrollment_cost }} credits
                            </p>
                        </div>
                        {% if current_license and not current_license.payment_verified %}
                        <button disabled style="padding: 0.5rem 1rem; background: #ccc; color: #666; border: none; border-radius: 4px; font-size: 0.9rem; cursor: not-allowed;">
                            Payment Not Verified
                        </button>
                        {% elif credit_balance >= semester.enrollment_cost %}
                        <button onclick="requestEnrollment({{ semester.id }})" style="padding: 0.5rem 1rem; background: {{ specialization_color }}; color: white; border: none; border-radius: 4px; font-size: 0.9rem; cursor: pointer;">
                            ğŸ“ Pre-Enroll ({{ semester.enrollment_cost }} cr)
                        </button>
                        {% else %}
                        <button disabled style="padding: 0.5rem 1rem; background: #ccc; color: #666; border: none; border-radius: 4px; font-size: 0.9rem; cursor: not-allowed;">
                            Insufficient Credits
                        </button>
                        {% endif %}
                    </div>
                    {% endif %}
                    {% endfor %}
                </div>
            </details>
            {% endif %}
        </div>

        <script>
        async function requestEnrollment(semesterId) {
            if (!confirm('Request enrollment for this semester?')) {
                return;
            }

            // Show loading state
            const statusDiv = document.getElementById('enrollment-status');
            if (statusDiv) statusDiv.remove();

            const loadingDiv = document.createElement('div');
            loadingDiv.id = 'enrollment-status';
            loadingDiv.style.cssText = 'position: fixed; top: 20px; right: 20px; padding: 1rem 1.5rem; background: #2196F3; color: white; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.3); z-index: 10000; font-weight: 600; animation: slideIn 0.3s ease;';
            loadingDiv.innerHTML = 'â³ Submitting enrollment request...';
            document.body.appendChild(loadingDiv);

            try {
                const response = await fetch('/enrollment/request', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    credentials: 'include',
                    body: JSON.stringify({
                        semester_id: semesterId
                    })
                });

                const data = await response.json();

                // Remove loading
                loadingDiv.remove();

                // Show result with animation
                const resultDiv = document.createElement('div');
                resultDiv.id = 'enrollment-status';
                resultDiv.style.cssText = 'position: fixed; top: 20px; right: 20px; padding: 1.5rem 2rem; border-radius: 12px; box-shadow: 0 6px 20px rgba(0,0,0,0.4); z-index: 10000; font-weight: 600; animation: slideIn 0.3s ease; max-width: 400px;';

                if (response.ok) {
                    resultDiv.style.background = 'linear-gradient(135deg, #4caf50 0%, #45a049 100%)';
                    resultDiv.style.color = 'white';
                    resultDiv.innerHTML = `
                        <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 0.8rem;">
                            <div style="font-size: 2.5rem;">âœ…</div>
                            <div>
                                <div style="font-size: 1.2rem; font-weight: 700;">Enrollment Requested!</div>
                                <div style="font-size: 0.9rem; opacity: 0.95; margin-top: 0.3rem;">Status: PENDING APPROVAL</div>
                            </div>
                        </div>
                        <div style="background: rgba(255,255,255,0.2); padding: 0.8rem; border-radius: 6px; margin-top: 0.8rem;">
                            <div style="font-size: 0.9rem; line-height: 1.5;">
                                ğŸ“‹ Your enrollment request has been submitted to the admin for review.<br>
                                â° You will be notified once approved.
                            </div>
                        </div>
                    `;

                    // Auto reload after 3 seconds
                    setTimeout(() => {
                        location.reload();
                    }, 3000);
                } else {
                    resultDiv.style.background = 'linear-gradient(135deg, #f44336 0%, #e53935 100%)';
                    resultDiv.style.color = 'white';
                    resultDiv.innerHTML = `
                        <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 0.8rem;">
                            <div style="font-size: 2.5rem;">âŒ</div>
                            <div>
                                <div style="font-size: 1.2rem; font-weight: 700;">Enrollment Failed</div>
                                <div style="font-size: 0.9rem; opacity: 0.95; margin-top: 0.3rem;">Status: ERROR</div>
                            </div>
                        </div>
                        <div style="background: rgba(255,255,255,0.2); padding: 0.8rem; border-radius: 6px; margin-top: 0.8rem;">
                            <div style="font-size: 0.9rem; line-height: 1.5;">
                                ${data.detail || data.message || 'Failed to request enrollment'}
                            </div>
                        </div>
                        <button onclick="this.parentElement.remove()" style="margin-top: 0.8rem; padding: 0.5rem 1rem; background: white; color: #f44336; border: none; border-radius: 4px; cursor: pointer; font-weight: 600;">Close</button>
                    `;
                }

                document.body.appendChild(resultDiv);

            } catch (error) {
                console.error('Error:', error);

                // Remove loading
                if (loadingDiv) loadingDiv.remove();

                // Show network error
                const errorDiv = document.createElement('div');
                errorDiv.id = 'enrollment-status';
                errorDiv.style.cssText = 'position: fixed; top: 20px; right: 20px; padding: 1.5rem 2rem; background: linear-gradient(135deg, #ff9800 0%, #f57c00 100%); color: white; border-radius: 12px; box-shadow: 0 6px 20px rgba(0,0,0,0.4); z-index: 10000; font-weight: 600; max-width: 400px;';
                errorDiv.innerHTML = `
                    <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 0.8rem;">
                        <div style="font-size: 2.5rem;">âš ï¸</div>
                        <div>
                            <div style="font-size: 1.2rem; font-weight: 700;">Network Error</div>
                            <div style="font-size: 0.9rem; opacity: 0.95; margin-top: 0.3rem;">Status: CONNECTION FAILED</div>
                        </div>
                    </div>
                    <div style="background: rgba(255,255,255,0.2); padding: 0.8rem; border-radius: 6px; margin-top: 0.8rem;">
                        <div style="font-size: 0.9rem;">Unable to connect to server. Please check your internet connection and try again.</div>
                    </div>
                    <button onclick="this.parentElement.remove()" style="margin-top: 0.8rem; padding: 0.5rem 1rem; background: white; color: #ff9800; border: none; border-radius: 4px; cursor: pointer; font-weight: 600;">Close</button>
                `;
                document.body.appendChild(errorDiv);
            }
        }

        // Add CSS animation
        const style = document.createElement('style');
        style.textContent = `
            @keyframes slideIn {
                from {
                    transform: translateX(400px);
                    opacity: 0;
                }
                to {
                    transform: translateX(0);
                    opacity: 1;
                }
            }
        `;
        document.head.appendChild(style);
        </script>
        {% endif %}

        {% if has_active_enrollment %}
        <!-- CONTENT VISIBLE ONLY AFTER ENROLLMENT APPROVED -->
        <div class="cards-grid">
            <!-- Specialization Card -->
            <div class="card">
                <h2>ğŸ“ Specialization</h2>
                {% if specialization.value == 'GANCUJU_PLAYER' %}
                    <h3>ğŸ¥‹ GÄnCuju Player</h3>
                    <p style="color: #7f8c8d; font-size: 0.9rem;">4000-year-old football tradition</p>
                {% elif specialization.value == 'LFA_FOOTBALL_PLAYER' %}
                    <h3>âš½ LFA Football Player</h3>
                    <p style="color: #7f8c8d; font-size: 0.9rem;">Modern football training</p>
                {% elif specialization.value == 'LFA_COACH' %}
                    <h3>ğŸ‘¨â€ğŸ« LFA Coach</h3>
                    <p style="color: #7f8c8d; font-size: 0.9rem;">Certified coaching program</p>
                {% elif specialization.value == 'INTERNSHIP' %}
                    <h3>ğŸ’¼ Internship</h3>
                    <p style="color: #7f8c8d; font-size: 0.9rem;">Startup experience</p>
                {% else %}
                    <h3>{{ specialization.value.replace('_', ' ').title() }}</h3>
                {% endif %}
                <div class="progress-container">
                    <div class="progress-label">
                        <span>Progress</span>
                        <span>0%</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: 0%"></div>
                    </div>
                </div>
            </div>

            <!-- XP / Level Card OR Football Skills Card (for LFA Player) -->
            {% if football_skills %}
            <!-- âš½ FOOTBALL SKILLS CARD (LFA Player Specializations) -->
            <div class="card" style="border-left: 4px solid {{ specialization_color or '#f1c40f' }};">
                <h2>âš½ Football Skills</h2>
                <p style="font-size: 0.85rem; color: #777; margin-bottom: 1.2rem;">Your current skill assessment</p>

                <div style="display: grid; gap: 0.8rem;">
                    <!-- Heading -->
                    <div>
                        <div style="display: flex; justify-content: space-between; margin-bottom: 0.3rem;">
                            <span style="font-weight: 600; color: #2c3e50;">ğŸ¯ Heading</span>
                            <span style="font-weight: 700; color: {{ specialization_color or '#f1c40f' }};">{{ football_skills.heading }}%</span>
                        </div>
                        <div style="background: #e0e0e0; height: 8px; border-radius: 4px; overflow: hidden;">
                            <div style="background: {{ specialization_color or '#f1c40f' }}; height: 100%; width: {{ football_skills.heading }}%; transition: width 0.3s;"></div>
                        </div>
                    </div>

                    <!-- Shooting -->
                    <div>
                        <div style="display: flex; justify-content: space-between; margin-bottom: 0.3rem;">
                            <span style="font-weight: 600; color: #2c3e50;">ğŸ¥… Shooting</span>
                            <span style="font-weight: 700; color: {{ specialization_color or '#f1c40f' }};">{{ football_skills.shooting }}%</span>
                        </div>
                        <div style="background: #e0e0e0; height: 8px; border-radius: 4px; overflow: hidden;">
                            <div style="background: {{ specialization_color or '#f1c40f' }}; height: 100%; width: {{ football_skills.shooting }}%; transition: width 0.3s;"></div>
                        </div>
                    </div>

                    <!-- Crossing -->
                    <div>
                        <div style="display: flex; justify-content: space-between; margin-bottom: 0.3rem;">
                            <span style="font-weight: 600; color: #2c3e50;">â†—ï¸ Crossing</span>
                            <span style="font-weight: 700; color: {{ specialization_color or '#f1c40f' }};">{{ football_skills.crossing }}%</span>
                        </div>
                        <div style="background: #e0e0e0; height: 8px; border-radius: 4px; overflow: hidden;">
                            <div style="background: {{ specialization_color or '#f1c40f' }}; height: 100%; width: {{ football_skills.crossing }}%; transition: width 0.3s;"></div>
                        </div>
                    </div>

                    <!-- Passing -->
                    <div>
                        <div style="display: flex; justify-content: space-between; margin-bottom: 0.3rem;">
                            <span style="font-weight: 600; color: #2c3e50;">ğŸ¯ Passing</span>
                            <span style="font-weight: 700; color: {{ specialization_color or '#f1c40f' }};">{{ football_skills.passing }}%</span>
                        </div>
                        <div style="background: #e0e0e0; height: 8px; border-radius: 4px; overflow: hidden;">
                            <div style="background: {{ specialization_color or '#f1c40f' }}; height: 100%; width: {{ football_skills.passing }}%; transition: width 0.3s;"></div>
                        </div>
                    </div>

                    <!-- Dribbling -->
                    <div>
                        <div style="display: flex; justify-content: space-between; margin-bottom: 0.3rem;">
                            <span style="font-weight: 600; color: #2c3e50;">ğŸƒ Dribbling</span>
                            <span style="font-weight: 700; color: {{ specialization_color or '#f1c40f' }};">{{ football_skills.dribbling }}%</span>
                        </div>
                        <div style="background: #e0e0e0; height: 8px; border-radius: 4px; overflow: hidden;">
                            <div style="background: {{ specialization_color or '#f1c40f' }}; height: 100%; width: {{ football_skills.dribbling }}%; transition: width 0.3s;"></div>
                        </div>
                    </div>

                    <!-- Ball Control -->
                    <div>
                        <div style="display: flex; justify-content: space-between; margin-bottom: 0.3rem;">
                            <span style="font-weight: 600; color: #2c3e50;">âš½ Ball Control</span>
                            <span style="font-weight: 700; color: {{ specialization_color or '#f1c40f' }};">{{ football_skills.ball_control }}%</span>
                        </div>
                        <div style="background: #e0e0e0; height: 8px; border-radius: 4px; overflow: hidden;">
                            <div style="background: {{ specialization_color or '#f1c40f' }}; height: 100%; width: {{ football_skills.ball_control }}%; transition: width 0.3s;"></div>
                        </div>
                    </div>
                </div>

                {% if skills_updated_by_name %}
                <p style="font-size: 0.75rem; color: #999; margin-top: 1rem; text-align: center;">
                    Assessed by {{ skills_updated_by_name }}
                </p>
                {% else %}
                <p style="font-size: 0.75rem; color: #999; margin-top: 1rem; text-align: center;">
                    â„¹ï¸ Skills not yet assessed by instructor
                </p>
                {% endif %}
            </div>
            {% else %}
            <!-- XP / Level Card (non-LFA Player specializations) -->
            <div class="card">
                <h2>âš¡ Progress</h2>
                <h3>Level {{ xp_data.level }}</h3>
                <p>{{ xp_data.total_xp }} Total XP</p>
                <div class="progress-container">
                    <div class="progress-label">
                        <span>Level Progress</span>
                        <span>{{ xp_data.level_progress }}%</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: {{ xp_data.level_progress }}%"></div>
                    </div>
                </div>
            </div>
            {% endif %}

            <!-- Next Session Card -->
            <div class="card">
                <h2>ğŸ“… Next Session</h2>
                {% if upcoming_sessions and upcoming_sessions|length > 0 %}
                    {% set next_session = upcoming_sessions[0] %}
                    <div style="margin-bottom: 1rem;">
                        <h3 style="margin-bottom: 0.5rem;">{{ next_session.title }}</h3>
                        <p style="color: #555; margin: 0.3rem 0;">
                            ğŸ“… {{ next_session.date_start.strftime('%B %d, %Y at %H:%M') }}
                        </p>
                        <p style="color: #777; margin: 0.3rem 0; font-size: 0.9rem;">
                            ğŸ“ {{ next_session.location or 'Online' }}
                        </p>
                        <p style="color: #999; margin: 0.3rem 0; font-size: 0.85rem;">
                            â±ï¸ {{ ((next_session.date_end - next_session.date_start).seconds // 60) }} minutes
                        </p>
                    </div>
                {% else %}
                    <p style="color: #7f8c8d;">No upcoming sessions</p>
                {% endif %}
                <a href="/sessions" class="btn btn-primary mt-2">
                    View All Sessions
                </a>
            </div>
        </div>

        <!-- Student Quick Actions -->
        <div class="mt-3">
            <h2>Quick Actions</h2>
            <div class="cards-grid">
                <a href="/profile" class="card" style="text-decoration: none; color: inherit;">
                    <h3>ğŸ‘¤ View Profile</h3>
                    <p>See your learning profile and progress</p>
                </a>

                <a href="/progress" class="card" style="text-decoration: none; color: inherit; border-left: 4px solid #27ae60;">
                    <h3>ğŸ“Š Academic Progress</h3>
                    <p>View your XP, level, and semester results</p>
                </a>

                <a href="/achievements" class="card" style="text-decoration: none; color: inherit;">
                    <h3>ğŸ† Achievements</h3>
                    <p>View your badges and accomplishments</p>
                </a>

                <a href="/sessions" class="card" style="text-decoration: none; color: inherit;">
                    <h3>ğŸ“š Sessions</h3>
                    <p>Browse and book training sessions</p>
                </a>
            </div>
        </div>
        {% endif %}
        <!-- END: Content visible only after enrollment approved -->

    {% endif %}
{% endif %}
{% endblock %}

{% block extra_scripts %}
<script>
// Universal copy function using data attributes
document.addEventListener('DOMContentLoaded', function() {
    // Handle all copy buttons with data-copy-text attribute
    document.querySelectorAll('.copy-btn').forEach(button => {
        button.addEventListener('click', function() {
            const textToCopy = this.getAttribute('data-copy-text');
            console.log('Copying:', textToCopy);

            if (!navigator.clipboard) {
                // Fallback for older browsers
                const textarea = document.createElement('textarea');
                textarea.value = textToCopy;
                textarea.style.position = 'fixed';
                textarea.style.opacity = '0';
                document.body.appendChild(textarea);
                textarea.select();
                try {
                    document.execCommand('copy');
                    this.innerHTML = 'âœ… Copied!';
                    this.style.background = '#2ecc71';
                    setTimeout(() => {
                        this.innerHTML = 'ğŸ“‹ Copy';
                        this.style.background = '#3498db';
                    }, 2000);
                } catch (err) {
                    alert('Copy failed: ' + err);
                }
                document.body.removeChild(textarea);
            } else {
                navigator.clipboard.writeText(textToCopy).then(() => {
                    this.innerHTML = 'âœ… Copied!';
                    this.style.background = '#2ecc71';
                    setTimeout(() => {
                        this.innerHTML = 'ğŸ“‹ Copy';
                        this.style.background = '#3498db';
                    }, 2000);
                }).catch(err => {
                    alert('Copy failed: ' + err);
                });
            }
        });
    });
});

// Copy function for payment code (inline onclick)
function copyCodeStudent(code, button) {
    console.log('Copying payment code:', code);
    if (!navigator.clipboard) {
        const textarea = document.createElement('textarea');
        textarea.value = code;
        textarea.style.position = 'fixed';
        textarea.style.opacity = '0';
        document.body.appendChild(textarea);
        textarea.select();
        try {
            document.execCommand('copy');
            button.innerHTML = 'âœ… Copied!';
            button.style.background = '#2ecc71';
            setTimeout(() => {
                button.innerHTML = 'ğŸ“‹ Copy';
                button.style.background = '#27ae60';
            }, 2000);
        } catch (err) {
            alert('Copy failed: ' + err);
        }
        document.body.removeChild(textarea);
    } else {
        navigator.clipboard.writeText(code).then(() => {
            button.innerHTML = 'âœ… Copied!';
            button.style.background = '#2ecc71';
            setTimeout(() => {
                button.innerHTML = 'ğŸ“‹ Copy';
                button.style.background = '#27ae60';
            }, 2000);
        }).catch(err => {
            alert('Copy failed: ' + err);
        });
    }
}
</script>
{% endblock %}
