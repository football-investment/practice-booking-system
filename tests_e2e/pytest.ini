[pytest]
# E2E Test Configuration for Playwright Tests
# ===========================================

testpaths = .
python_files = test_*.py
python_classes = Test*
python_functions = test_*

# Markers for test filtering
markers =
    golden_path: Production critical tests that block deployment (DO NOT SKIP)
    e2e: End-to-end tests with Playwright
    smoke: Fast smoke tests for CI regression checks
    regression: Regression protection tests for known bugs
    critical: Build blocker tests - must pass before deployment
    requires_worker: Tests requiring background worker (async/celery)
    skip: Tests to skip (for debugging/manual runs only)
    lifecycle: Lifecycle phase tests (ordered, state-dependent)
    phase_0: Phase 0 — Clean DB setup
    phase_1: Phase 1 — User registration
    phase_2: Phase 2 — Onboarding
    phase_3: Phase 3 — Enrollment/license
    phase_4: Phase 4 — Tournament lifecycle
    phase_5: Phase 5 — Skill progression coverage
    phase_6: Phase 6 — Edge cardinality system-safety tests (HIGH PRIORITY)
    skill_progression: Skill-level assertions (delta ordering, EMA state, clamp)
    edge_cardinality: Edge player-count tests (odd, dynamic distribution, large brackets)
    nondestructive: Tests that do not modify any state (pure read/in-process computation only)
    scale_structural: In-process structural tests for large-cardinality tournament engine validation (no DB/server)
    production_flow: Live server + real DB + Celery worker required — full operator lifecycle validation (production readiness)
    concurrency: Parallel tournament generation stress test — validates queue behaviour, worker utilisation, and DB write serialisation under concurrent load
    large_field_monitor: 1024-player knockout + dual-mode Playwright browser validation of Tournament Monitor with event propagation latency measurement
    tournament_monitor: Headless Playwright tests for OPS Tournament Monitor UI, wizard flow, and live tracking panel
    ops_seed: Tests requiring 64 @lfa-seed.hu seed players (Fast Suite boundary tests 2-64)
    scale_suite: Tests requiring 128-1024 players (Scale Suite - optional execution, capacity validation)
    integration_critical: Critical multi-role integration flows (NON-BLOCKING, nightly run)
    slow: Tests with long runtime (>30s)

# Logging
log_cli = true
log_cli_level = INFO
log_cli_format = %(asctime)s [%(levelname)8s] %(message)s
log_cli_date_format = %Y-%m-%d %H:%M:%S

# pytest-selenium: only treat production domains as sensitive, not localhost.
# Default (.*) blocks all destructive tests against localhost — wrong for a
# local dev/CI environment where localhost IS the intended test target.
sensitive_url = (https?://(www\.)?lfa\.(com|hu|io))

# Failure behavior
addopts =
    --strict-markers
    --tb=short
    --maxfail=1
    -ra
